<!DOCTYPE html>

<html lang="ja" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="What's New In Python 3.2" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://docs.python.org/3/whatsnew/3.2.html" />
<meta property="og:site_name" content="Python documentation" />
<meta property="og:description" content="著者, Raymond Hettinger,. This article explains the new features in Python 3.2 as compared to 3.1. Python 3.2 was released on February 20, 2011. It focuses on a few highlights and gives a few example..." />
<meta property="og:image" content="https://docs.python.org/3/_static/og-image.png" />
<meta property="og:image:alt" content="Python documentation" />
<meta name="description" content="著者, Raymond Hettinger,. This article explains the new features in Python 3.2 as compared to 3.1. Python 3.2 was released on February 20, 2011. It focuses on a few highlights and gives a few example..." />
<meta property="og:image:width" content="200" />
<meta property="og:image:height" content="200" />
<meta name="theme-color" content="#3776ab" />

    <title>What&#39;s New In Python 3.2 &#8212; Python 3.12.4 ドキュメント</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../_static/pydoctheme.css?v=bb723527" />
    <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../_static/pygments_dark.css?v=b20cc3f5" />
    
    <script src="../_static/documentation_options.js?v=7e11ab17"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=4dbe4bdc"></script>
    
    <script src="../_static/sidebar.js"></script>
    
    <link rel="search" type="application/opensearchdescription+xml"
          title="Python 3.12.4 ドキュメント 内を検索"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="このドキュメントについて" href="../about.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="What&#39;s New In Python 3.1" href="3.1.html" />
    <link rel="prev" title="What&#39;s New In Python 3.3" href="3.3.html" />
    
      <script defer data-domain="docs.python.org" src="https://plausible.io/js/script.js"></script>
    
    <link rel="canonical" href="https://docs.python.org/3/whatsnew/3.2.html" />
    
      
    

    
    <style>
      @media only screen {
        table.full-width-table {
            width: 100%;
        }
      }
    </style>
<link rel="stylesheet" href="../_static/pydoctheme_dark.css" media="(prefers-color-scheme: dark)" id="pydoctheme_dark_css">
    <link rel="shortcut icon" type="image/png" href="../_static/py.svg" />
            <script type="text/javascript" src="../_static/copybutton.js"></script>
            <script type="text/javascript" src="../_static/menu.js"></script>
            <script type="text/javascript" src="../_static/search-focus.js"></script>
            <script type="text/javascript" src="../_static/themetoggle.js"></script> 
<meta name="readthedocs-addons-api-version" content="1">
<script type="text/javascript">
 function onSwitch(event) {
     const option = event.target.selectedIndex;
     const item = event.target.options[option];
     window.location.href = item.dataset.url;
 }

 document.addEventListener("readthedocs-addons-data-ready", function(event) {
   const config = event.detail.data()

   // Add some mocked hardcoded versions pointing to the official
   // documentation while migrating to Read the Docs.
   // These are only for testing purposes.
   // TODO: remove them when managing all the versions on Read the Docs,
   // since all the "active, built and not hidden" versions will be shown automatically.
   let versions = config.versions.active.concat([
       {
           slug: "dev (3.13)",
           urls: {
               documentation: "https://docs.python.org/3.13/",
           }
       },
       {
           slug: "3.12",
           urls: {
               documentation: "https://docs.python.org/3.12/",
           }
       },
       {
           slug: "3.11",
           urls: {
               documentation: "https://docs.python.org/3.11/",
           }
       },
   ]);

   const versionSelect = `
   <select id="version_select">
   ${ versions.map(
       (version) => `
       <option
           value="${ version.slug }"
           ${ config.versions.current.slug === version.slug ? 'selected="selected"' : '' }
           data-url="${ version.urls.documentation }">
           ${ version.slug }
       </option>`
   ).join("\n") }
   </select>
   `;

   // Prepend the current language to the options on the selector
   let languages = config.projects.translations.concat(config.projects.current);
   languages = languages.sort((a, b) => a.language.name.localeCompare(b.language.name));

   const languageSelect = `
   <select id="language_select">
   ${ languages.map(
       (translation) => `
       <option
           value="${ translation.slug }"
           ${ config.projects.current.slug === translation.slug ? 'selected="selected"' : '' }
           data-url="${ translation.urls.documentation }">
           ${ translation.language.name }
       </option>`
   ).join("\n") }
   </select>
   `;

   // Query all the placeholders because there are different ones for Desktop/Mobile
   const versionPlaceholders = document.querySelectorAll(".version_switcher_placeholder");
   for (placeholder of versionPlaceholders) {
       placeholder.innerHTML = versionSelect;
       let selectElement = placeholder.querySelector("select");
       selectElement.addEventListener("change", onSwitch);
   }

   const languagePlaceholders = document.querySelectorAll(".language_switcher_placeholder");
   for (placeholder of languagePlaceholders) {
       placeholder.innerHTML = languageSelect;
       let selectElement = placeholder.querySelector("select");
       selectElement.addEventListener("change", onSwitch);
   }
 });
</script>

  </head>
<body>
<div class="mobile-nav">
    <input type="checkbox" id="menuToggler" class="toggler__input" aria-controls="navigation"
           aria-pressed="false" aria-expanded="false" role="button" aria-label="Menu" />
    <nav class="nav-content" role="navigation">
        <label for="menuToggler" class="toggler__label">
            <span></span>
        </label>
        <span class="nav-items-wrapper">
            <a href="https://www.python.org/" class="nav-logo">
                <img src="../_static/py.svg" alt="Python logo"/>
            </a>
            <span class="version_switcher_placeholder"></span>
            <form role="search" class="search" action="../search.html" method="get">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="search-icon">
                    <path fill-rule="nonzero" fill="currentColor" d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 001.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 00-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 005.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
                </svg>
                <input placeholder="クイック検索" aria-label="クイック検索" type="search" name="q" />
                <input type="submit" value="検索"/>
            </form>
        </span>
    </nav>
    <div class="menu-wrapper">
        <nav class="menu" role="navigation" aria-label="main navigation">
            <div class="language_switcher_placeholder"></div>
            
<label class="theme-selector-label">
    Theme
    <select class="theme-selector" oninput="activateTheme(this.value)">
        <option value="auto" selected>Auto</option>
        <option value="light">Light</option>
        <option value="dark">Dark</option>
    </select>
</label>
  <div>
    <h3><a href="../contents.html">目次</a></h3>
    <ul>
<li><a class="reference internal" href="#">What's New In Python 3.2</a><ul>
<li><a class="reference internal" href="#pep-384-defining-a-stable-abi">PEP 384: 安定 ABI の定義</a></li>
<li><a class="reference internal" href="#pep-389-argparse-command-line-parsing-module">PEP 389: argparse コマンドライン解析モジュール</a></li>
<li><a class="reference internal" href="#pep-391-dictionary-based-configuration-for-logging">PEP 391:  logging の辞書ベースの設定</a></li>
<li><a class="reference internal" href="#pep-3148-the-concurrent-futures-module">PEP 3148:  <code class="docutils literal notranslate"><span class="pre">concurrent.futures</span></code> モジュール</a></li>
<li><a class="reference internal" href="#pep-3147-pyc-repository-directories">PEP 3147:  PYC リポジトリーディレクトリ</a></li>
<li><a class="reference internal" href="#pep-3149-abi-version-tagged-so-files">PEP 3149: ABI バージョンでタグ付けされた .so ファイル</a></li>
<li><a class="reference internal" href="#pep-3333-python-web-server-gateway-interface-v1-0-1">PEP 3333: Python Web Server Gateway Interface v1.0.1</a></li>
<li><a class="reference internal" href="#other-language-changes">その他の言語変更</a></li>
<li><a class="reference internal" href="#new-improved-and-deprecated-modules">新たなモジュール、改良されたモジュール、非推奨のモジュール</a><ul>
<li><a class="reference internal" href="#email">email</a></li>
<li><a class="reference internal" href="#elementtree">elementtree</a></li>
<li><a class="reference internal" href="#functools">functools</a></li>
<li><a class="reference internal" href="#itertools">itertools</a></li>
<li><a class="reference internal" href="#collections">collections</a></li>
<li><a class="reference internal" href="#threading">threading</a></li>
<li><a class="reference internal" href="#datetime-and-time">datetime と time</a></li>
<li><a class="reference internal" href="#math">math</a></li>
<li><a class="reference internal" href="#abc">abc</a></li>
<li><a class="reference internal" href="#io">io</a></li>
<li><a class="reference internal" href="#reprlib">reprlib</a></li>
<li><a class="reference internal" href="#logging">logging</a></li>
<li><a class="reference internal" href="#csv">csv</a></li>
<li><a class="reference internal" href="#contextlib">contextlib</a></li>
<li><a class="reference internal" href="#decimal-and-fractions">decimal と fractions</a></li>
<li><a class="reference internal" href="#ftp">ftp</a></li>
<li><a class="reference internal" href="#popen">popen</a></li>
<li><a class="reference internal" href="#select">select</a></li>
<li><a class="reference internal" href="#gzip-and-zipfile">gzip と zipfile</a></li>
<li><a class="reference internal" href="#tarfile">tarfile</a></li>
<li><a class="reference internal" href="#hashlib">hashlib</a></li>
<li><a class="reference internal" href="#ast">ast</a></li>
<li><a class="reference internal" href="#os">os</a></li>
<li><a class="reference internal" href="#shutil">shutil</a></li>
<li><a class="reference internal" href="#sqlite3">sqlite3</a></li>
<li><a class="reference internal" href="#html">html</a></li>
<li><a class="reference internal" href="#socket">socket</a></li>
<li><a class="reference internal" href="#ssl">ssl</a></li>
<li><a class="reference internal" href="#nntp">nntp</a></li>
<li><a class="reference internal" href="#certificates">certificates</a></li>
<li><a class="reference internal" href="#imaplib">imaplib</a></li>
<li><a class="reference internal" href="#http-client">http.client</a></li>
<li><a class="reference internal" href="#unittest">unittest</a></li>
<li><a class="reference internal" href="#random">random</a></li>
<li><a class="reference internal" href="#poplib">poplib</a></li>
<li><a class="reference internal" href="#asyncore">asyncore</a></li>
<li><a class="reference internal" href="#tempfile">tempfile</a></li>
<li><a class="reference internal" href="#inspect">inspect</a></li>
<li><a class="reference internal" href="#pydoc">pydoc</a></li>
<li><a class="reference internal" href="#dis">dis</a></li>
<li><a class="reference internal" href="#dbm">dbm</a></li>
<li><a class="reference internal" href="#ctypes">ctypes</a></li>
<li><a class="reference internal" href="#site">site</a></li>
<li><a class="reference internal" href="#sysconfig">sysconfig</a></li>
<li><a class="reference internal" href="#pdb">pdb</a></li>
<li><a class="reference internal" href="#configparser">configparser</a></li>
<li><a class="reference internal" href="#urllib-parse">urllib.parse</a></li>
<li><a class="reference internal" href="#mailbox">mailbox</a></li>
<li><a class="reference internal" href="#turtledemo">turtledemo</a></li>
</ul>
</li>
<li><a class="reference internal" href="#multi-threading">マルチスレッディング</a></li>
<li><a class="reference internal" href="#optimizations">最適化</a></li>
<li><a class="reference internal" href="#unicode">Unicode 文字列型</a></li>
<li><a class="reference internal" href="#codecs">Codecs</a></li>
<li><a class="reference internal" href="#documentation">ドキュメント</a></li>
<li><a class="reference internal" href="#idle">IDLE</a></li>
<li><a class="reference internal" href="#code-repository">コードリポジトリ</a></li>
<li><a class="reference internal" href="#build-and-c-api-changes">ビルドならびに C API の変更</a></li>
<li><a class="reference internal" href="#porting-to-python-3-2">Python 3.2 への移植</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>前のトピックへ</h4>
    <p class="topless"><a href="3.3.html"
                          title="前の章へ">What's New In Python 3.3</a></p>
  </div>
  <div>
    <h4>次のトピックへ</h4>
    <p class="topless"><a href="3.1.html"
                          title="次の章へ">What's New In Python 3.1</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">バグ報告</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/main/Doc/whatsnew/3.2.rst"
            rel="nofollow">ソースの表示
        </a>
      </li>
    </ul>
  </div>
        </nav>
    </div>
</div>

  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="3.1.html" title="What&#39;s New In Python 3.1"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="3.3.html" title="What&#39;s New In Python 3.3"
             accesskey="P">前へ</a> |</li>

          <li><img src="../_static/py.svg" alt="Python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
    <li id="cpython-language-and-version">
      <a href="../index.html">3.12.4 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">What's New in Python</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">What's New In Python 3.2</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="クイック検索" aria-label="クイック検索" type="search" name="q" id="search-box" />
          <input type="submit" value="検索" />
        </form>
    </div>
                     |
                </li>
            <li class="right">
<label class="theme-selector-label">
    Theme
    <select class="theme-selector" oninput="activateTheme(this.value)">
        <option value="auto" selected>Auto</option>
        <option value="light">Light</option>
        <option value="dark">Dark</option>
    </select>
</label> |</li>
            
      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="what-s-new-in-python-3-2">
<h1>What's New In Python 3.2<a class="headerlink" href="#what-s-new-in-python-3-2" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">著者<span class="colon">:</span></dt>
<dd class="field-odd"><p>Raymond Hettinger</p>
</dd>
</dl>
<p>This article explains the new features in Python 3.2 as compared to 3.1.
Python 3.2 was released on February 20, 2011. It
focuses on a few highlights and gives a few examples.  For full details, see the
<a class="reference external" href="https://github.com/python/cpython/blob/076ca6c3c8df3030307e548d9be792ce3c1c6eea/Misc/NEWS">Misc/NEWS</a>
file.</p>
<div class="admonition seealso">
<p class="admonition-title">参考</p>
<p><span class="target" id="index-27"></span><a class="pep reference external" href="https://peps.python.org/pep-0392/"><strong>PEP 392</strong></a> - Python 3.2 リリーススケジュール</p>
</div>
<section id="pep-384-defining-a-stable-abi">
<h2>PEP 384: 安定 ABI の定義<a class="headerlink" href="#pep-384-defining-a-stable-abi" title="Link to this heading">¶</a></h2>
<p>かつて、ある Python バージョンでビルドされた拡張モジュールは、ほかの Python バージョンでは使えないことがありました。特に Windows では、全ての Python 公式リリースごとに、使いたい全ての拡張モジュールを再ビルドする必要がありました。これは、拡張モジュールが Python インタプリタの内部実装に自由にアクセス出来たことからの結果でした。</p>
<p>Python 3.2 より、このことに関する別のアプローチが利用可能になりました。(<a class="reference internal" href="../c-api/stable.html#c.Py_LIMITED_API" title="Py_LIMITED_API"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_LIMITED_API</span></code></a> を定義することで) 制限された API のみ使うようにする拡張モジュールは、数多くの内部実装を利用出来ない代わりに将来のいくつものリリースで安定であることを約束された API 集合だけ使うことになります。結果として、このモードで 3.2 のためにビルドされた拡張モジュールは 3.3、3.4、…でも動作するでしょう。なお、メモリ構造の詳細を曝すような拡張モジュールでは、相変わらず全ての Python 公式リリースごとに再ビルドする必要があるでしょう。</p>
<div class="admonition seealso">
<p class="admonition-title">参考</p>
<dl class="simple">
<dt><span class="target" id="index-28"></span><a class="pep reference external" href="https://peps.python.org/pep-0384/"><strong>PEP 384</strong></a> - 安定 ABI の定義</dt><dd><p>PEP written by Martin von Löwis.</p>
</dd>
</dl>
</div>
</section>
<section id="pep-389-argparse-command-line-parsing-module">
<h2>PEP 389: argparse コマンドライン解析モジュール<a class="headerlink" href="#pep-389-argparse-command-line-parsing-module" title="Link to this heading">¶</a></h2>
<p>コマンドライン解析のために、新たに <a class="reference internal" href="../library/argparse.html#module-argparse" title="argparse: Command-line option and argument parsing library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a> モジュールが <a class="reference internal" href="../library/optparse.html#module-optparse" title="optparse: Command-line option parsing library. (非推奨)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">optparse</span></code></a> の制限を克服するものとして導入されました。optparse には (オプションだけでなく) 位置引数のサポートはなく、サブコマンドも作れず、必須のオプションやその他オプション指定と検証に共通するパターンについてのサポートもありませんでした。</p>
<p>このモジュールはコミュニティにおいて既に広く行き渡っていたサードパーティのモジュールでした。その先駆者たちよりももっと完全な機能性を持ったことで、 <a class="reference internal" href="../library/argparse.html#module-argparse" title="argparse: Command-line option and argument parsing library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a> モジュールは今ではコマンドライン解析での推奨モジュールとなりました。古いモジュールは、それに依存しているレガシーなコードが大量にあるため、今後も利用可能なまま保たれます。</p>
<p>以下に注釈付きで示したパーサは、有限個の選択肢から選ばせ、 <em>metavar</em> でヘルプ表示を指定し、一つ以上の位置引数があるかを検証し、必須オプションを設けている実例になっています:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
            <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Manage servers&#39;</span><span class="p">,</span>         <span class="c1"># main description for help</span>
            <span class="n">epilog</span> <span class="o">=</span> <span class="s1">&#39;Tested on Solaris and Linux&#39;</span><span class="p">)</span> <span class="c1"># displayed after help</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">,</span>                       <span class="c1"># argument name</span>
            <span class="n">choices</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="s1">&#39;stop&#39;</span><span class="p">],</span>  <span class="c1"># three allowed values</span>
            <span class="n">help</span> <span class="o">=</span> <span class="s1">&#39;action on each target&#39;</span><span class="p">)</span>         <span class="c1"># help msg</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;targets&#39;</span><span class="p">,</span>
            <span class="n">metavar</span> <span class="o">=</span> <span class="s1">&#39;HOSTNAME&#39;</span><span class="p">,</span>                   <span class="c1"># var name used in help msg</span>
            <span class="n">nargs</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span>                            <span class="c1"># require one or more targets</span>
            <span class="n">help</span> <span class="o">=</span> <span class="s1">&#39;url for target machines&#39;</span><span class="p">)</span>       <span class="c1"># help msg explanation</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-u&#39;</span><span class="p">,</span> <span class="s1">&#39;--user&#39;</span><span class="p">,</span>                 <span class="c1"># -u or --user option</span>
            <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>                        <span class="c1"># make it a required argument</span>
            <span class="n">help</span> <span class="o">=</span> <span class="s1">&#39;login as user&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>コマンド文字列とともにこのパーサを呼び出してみます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;deploy sneezy.example.com sleepy.example.com -u skycaptain&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">action</span>
<span class="go">&#39;deploy&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">targets</span>
<span class="go">[&#39;sneezy.example.com&#39;, &#39;sleepy.example.com&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">user</span>
<span class="go">&#39;skycaptain&#39;</span>
</pre></div>
</div>
<p>このパーサが自動的に作り出したヘルプはこのようになります:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="s1">&#39;-h&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

<span class="go">usage: manage_cloud.py [-h] -u USER</span>
<span class="go">                       {deploy,start,stop} HOSTNAME [HOSTNAME ...]</span>

<span class="go">Manage servers</span>

<span class="go">positional arguments:</span>
<span class="go">  {deploy,start,stop}   action on each target</span>
<span class="go">  HOSTNAME              url for target machines</span>

<span class="go">optional arguments:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  -u USER, --user USER  login as user</span>

<span class="go">Tested on Solaris and Linux</span>
</pre></div>
</div>
<p><a class="reference internal" href="../library/argparse.html#module-argparse" title="argparse: Command-line option and argument parsing library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a> 機能でとりわけ素晴らしいのはサブパーサを定義出来ることです。それらはそれぞれ自身固有の引数パターンを持ち、ヘルプ表示をします:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="s1">&#39;HELM&#39;</span><span class="p">)</span>
<span class="n">subparsers</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_subparsers</span><span class="p">()</span>

<span class="n">parser_l</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">&#39;launch&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Launch Control&#39;</span><span class="p">)</span>   <span class="c1"># first subgroup</span>
<span class="n">parser_l</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;--missiles&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
<span class="n">parser_l</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="s1">&#39;--torpedos&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>

<span class="n">parser_m</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">&#39;move&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Move Vessel&#39;</span><span class="p">,</span>        <span class="c1"># second subgroup</span>
                                 <span class="n">aliases</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;steer&#39;</span><span class="p">,</span> <span class="s1">&#39;turn&#39;</span><span class="p">))</span>         <span class="c1"># equivalent names</span>
<span class="n">parser_m</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;--course&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">parser_m</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-s&#39;</span><span class="p">,</span> <span class="s1">&#39;--speed&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./helm.py<span class="w"> </span>--help<span class="w">                         </span><span class="c1"># top level help (launch and move)</span>
<span class="gp">$ </span>./helm.py<span class="w"> </span>launch<span class="w"> </span>--help<span class="w">                  </span><span class="c1"># help for launch options</span>
<span class="gp">$ </span>./helm.py<span class="w"> </span>launch<span class="w"> </span>--missiles<span class="w">              </span><span class="c1"># set missiles=True and torpedos=False</span>
<span class="gp">$ </span>./helm.py<span class="w"> </span>steer<span class="w"> </span>--course<span class="w"> </span><span class="m">180</span><span class="w"> </span>--speed<span class="w"> </span><span class="m">5</span><span class="w">   </span><span class="c1"># set movement parameters</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参考</p>
<dl class="simple">
<dt><span class="target" id="index-29"></span><a class="pep reference external" href="https://peps.python.org/pep-0389/"><strong>PEP 389</strong></a> - 新しいコマンドライン解析モジュール</dt><dd><p>PEP written by Steven Bethard.</p>
</dd>
</dl>
<p><a class="reference internal" href="../library/argparse.html#upgrading-optparse-code"><span class="std std-ref">optparse からのアップグレード</span></a> に <a class="reference internal" href="../library/optparse.html#module-optparse" title="optparse: Command-line option parsing library. (非推奨)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">optparse</span></code></a> との違いが詳しく書かれています。</p>
</div>
</section>
<section id="pep-391-dictionary-based-configuration-for-logging">
<h2>PEP 391:  logging の辞書ベースの設定<a class="headerlink" href="#pep-391-dictionary-based-configuration-for-logging" title="Link to this heading">¶</a></h2>
<p>The <a class="reference internal" href="../library/logging.html#module-logging" title="logging: Flexible event logging system for applications."><code class="xref py py-mod docutils literal notranslate"><span class="pre">logging</span></code></a> module provided two kinds of configuration, one style with
function calls for each option or another style driven by an external file saved
in a <a class="reference internal" href="../library/configparser.html#module-configparser" title="configparser: Configuration file parser."><code class="xref py py-mod docutils literal notranslate"><span class="pre">configparser</span></code></a> format.  Those options did not provide the flexibility
to create configurations from JSON or YAML files, nor did they support
incremental configuration, which is needed for specifying logger options from a
command line.</p>
<p>もっと柔軟な設定をサポートするために、新たに <a class="reference internal" href="../library/logging.config.html#logging.config.dictConfig" title="logging.config.dictConfig"><code class="xref py py-func docutils literal notranslate"><span class="pre">logging.config.dictConfig()</span></code></a> が追加されました。これはロギングの設定を通常の Python 辞書で指定します。設定オプションにはフォーマッタ、ハンドラ、フィルタ、そしてロガーが含まれます。以下は設定辞書の動作する実例です:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s2">&quot;formatters&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;brief&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%(levelname)-8s</span><span class="s2">: </span><span class="si">%(name)-15s</span><span class="s2">: </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">},</span>
                <span class="s2">&quot;full&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(name)-15s</span><span class="s2"> </span><span class="si">%(levelname)-8s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">}</span>
                <span class="p">},</span>
 <span class="s2">&quot;handlers&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;console&quot;</span><span class="p">:</span> <span class="p">{</span>
                   <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;logging.StreamHandler&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;formatter&quot;</span><span class="p">:</span> <span class="s2">&quot;brief&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;stream&quot;</span><span class="p">:</span> <span class="s2">&quot;ext://sys.stdout&quot;</span><span class="p">},</span>
              <span class="s2">&quot;console_priority&quot;</span><span class="p">:</span> <span class="p">{</span>
                   <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;logging.StreamHandler&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;formatter&quot;</span><span class="p">:</span> <span class="s2">&quot;full&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;stream&quot;</span><span class="p">:</span> <span class="s2">&quot;ext://sys.stderr&quot;</span><span class="p">}</span>
              <span class="p">},</span>
 <span class="s2">&quot;root&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;handlers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;console&quot;</span><span class="p">,</span> <span class="s2">&quot;console_priority&quot;</span><span class="p">]}}</span>
</pre></div>
</div>
<p>その辞書が <code class="file docutils literal notranslate"><span class="pre">conf.json</span></code> ファイルに格納されているのであれば、コードからこのように呼び出してロード出来ます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">logging.config</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;conf.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">conf</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logging</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dictConfig</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Transaction completed normally&quot;</span><span class="p">)</span>
<span class="go">INFO    : root           : Transaction completed normally</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logging</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Abnormal termination&quot;</span><span class="p">)</span>
<span class="go">2011-02-17 11:14:36,694 root            CRITICAL Abnormal termination</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参考</p>
<dl class="simple">
<dt><span class="target" id="index-30"></span><a class="pep reference external" href="https://peps.python.org/pep-0391/"><strong>PEP 391</strong></a> - logging の辞書ベースの設定</dt><dd><p>PEP written by Vinay Sajip.</p>
</dd>
</dl>
</div>
</section>
<section id="pep-3148-the-concurrent-futures-module">
<h2>PEP 3148:  <code class="docutils literal notranslate"><span class="pre">concurrent.futures</span></code> モジュール<a class="headerlink" href="#pep-3148-the-concurrent-futures-module" title="Link to this heading">¶</a></h2>
<p>同時並行性 (concurrency) を生成・管理するコードはトップレベルの新しい名前空間 <em>concurrent</em> に集められることになりました。その最初のメンバーが <em>futures</em> パッケージです。これはスレッドとプロセス管理の統一的な高水準インターフェイスを提供します。</p>
<p><a class="reference internal" href="../library/concurrent.futures.html#module-concurrent.futures" title="concurrent.futures: Execute computations concurrently using threads or processes."><code class="xref py py-mod docutils literal notranslate"><span class="pre">concurrent.futures</span></code></a> の設計は Java の <em>java.util.concurrent</em> パッケージに触発されました。そのモデルでは、実行する呼び出しとその結果は <a class="reference internal" href="../library/concurrent.futures.html#concurrent.futures.Future" title="concurrent.futures.Future"><code class="xref py py-class docutils literal notranslate"><span class="pre">Future</span></code></a> オブジェクトで表現され、これはスレッド、プロセス、遠隔手続呼び出しの共通的な側面を抽象化しています。そのオブジェクトはステータスのチェック (実行中あるいは完了かどうか)、タイムアウト、キャンセル、コールバックの追加、そして結果や例外へのアクセスをサポートします。</p>
<p>この新モジュールで提供される最も基本となるのが、呼び出しの実行と管理のための 2 つの executor クラスです。これら executor の目標は、これまでにもあった道具立てでの並列呼び出しを、もっと簡単にすることです。リソースプールをお膳立てしたり呼び出しを実行したり、結果のキューを作ったり、あるいはタイムアウトのハンドラを追加したり、スレッドやプロセスや遠隔手続呼び出しの総数を制限したり、といったことを、これらを使えば、その労力を小さく出来ます。</p>
<p>理想的にはそれぞれのアプリケーションは、プロセスとスレッドの制限が確実に管理されるように、複数コンポーネントをまたがって単一の executor を共有すべきです。そうしておけば、個々のコンポーネントがリソース管理についての競合する戦略を持つ場合に起こる設計の難題は解決出来ます。</p>
<p>どちらの executor クラスとも 3 つのメソッドを持つ共通インターフェイスを持ちます。 <a class="reference internal" href="../library/concurrent.futures.html#concurrent.futures.Executor.submit" title="concurrent.futures.Executor.submit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">submit()</span></code></a> メソッドは呼び出し可能オブジェクトをスケジュールし、 <a class="reference internal" href="../library/concurrent.futures.html#concurrent.futures.Future" title="concurrent.futures.Future"><code class="xref py py-class docutils literal notranslate"><span class="pre">Future</span></code></a> オブジェクトを返します。 <a class="reference internal" href="../library/concurrent.futures.html#concurrent.futures.Executor.map" title="concurrent.futures.Executor.map"><code class="xref py py-meth docutils literal notranslate"><span class="pre">map()</span></code></a> メソッドは一気に複数の非同期呼び出しをスケジュールします。 <a class="reference internal" href="../library/concurrent.futures.html#concurrent.futures.Executor.shutdown" title="concurrent.futures.Executor.shutdown"><code class="xref py py-meth docutils literal notranslate"><span class="pre">shutdown()</span></code></a> メソッドはリソースを解放します。これらクラスは <a class="reference internal" href="../glossary.html#term-context-manager"><span class="xref std std-term">context manager</span></a> なので <a class="reference internal" href="../reference/compound_stmts.html#with"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">with</span></code></a> 文とともに使うことが出来、現時点で保留中の future が実行を終えた際にリソースが自動的に解放されることを保障出来ます。</p>
<p>以下はファイルコピーを行う 4 つの並列スレッドを実行する、 <a class="reference internal" href="../library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor" title="concurrent.futures.ThreadPoolExecutor"><code class="xref py py-class docutils literal notranslate"><span class="pre">ThreadPoolExecutor</span></code></a> の単純な使用例です:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">concurrent.futures</span><span class="o">,</span> <span class="nn">shutil</span>
<span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">e</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">,</span> <span class="s1">&#39;src1.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;dest1.txt&#39;</span><span class="p">)</span>
    <span class="n">e</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">,</span> <span class="s1">&#39;src2.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;dest2.txt&#39;</span><span class="p">)</span>
    <span class="n">e</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">,</span> <span class="s1">&#39;src3.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;dest3.txt&#39;</span><span class="p">)</span>
    <span class="n">e</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">,</span> <span class="s1">&#39;src3.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;dest4.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参考</p>
<dl class="simple">
<dt><span class="target" id="index-31"></span><a class="pep reference external" href="https://peps.python.org/pep-3148/"><strong>PEP 3148</strong></a> - Futures -- 計算の非同期な実行</dt><dd><p>PEP written by Brian Quinlan.</p>
</dd>
</dl>
<p><a class="reference internal" href="../library/concurrent.futures.html#threadpoolexecutor-example"><span class="std std-ref">ThreadPoolExecutor の例</span></a> はスレッド並列でウェブページを取得する実例コードです。</p>
<p><a class="reference internal" href="../library/concurrent.futures.html#concurrent.futures.ProcessPoolExecutor" title="concurrent.futures.ProcessPoolExecutor"><code class="xref py py-class docutils literal notranslate"><span class="pre">ProcessPoolExecutor</span></code></a> の実例を <a class="reference internal" href="../library/concurrent.futures.html#processpoolexecutor-example"><span class="std std-ref">並列で素数計算するコード例</span></a> として挙げています。</p>
</div>
</section>
<section id="pep-3147-pyc-repository-directories">
<h2>PEP 3147:  PYC リポジトリーディレクトリ<a class="headerlink" href="#pep-3147-pyc-repository-directories" title="Link to this heading">¶</a></h2>
<p>バイトコードを <em>.pyc</em> ファイルとしてキャッシュする Python の方法は、複数の Python インタプリタ環境ではうまく働きませんでした。一つのインタプリタがもう一つのインタプリタによって作られたキャッシュファイルに出会うと、そのインタプリタはソースを再コンパイルしてキャッシュファイルを上書きするわけですから、これではキャッシュの価値は台無しです。</p>
<p>「pyc ファイト」問題は、複数バージョンの Python を載せる Linux ディストリビューションにありふれたこととなったよりももっと表立って来ました。これら衝突は <a class="reference external" href="https://en.wikipedia.org/wiki/Unladen_Swallow#Project_activity">Unladen Swallow</a> のような CPython 以外の実装でも起こります。</p>
<p>この問題を解決するために、Python のインポート機構はそれぞれのインタプリタごとに区別された名前を使うように拡張されました。Python 3.2、Python 3.3、 Unladen Swallow でそれぞれ競合するファイル名 &quot;mymodule.pyc&quot; を使うのではなく、それぞれ &quot;mymodule.cpython-32.pyc&quot;, &quot;mymodule.cpython-33.pyc&quot;, &quot;mymodule.unladen10.pyc&quot; を使うようになりました。同時にこれらの新しいファイルがソースディレクトリを散らかすのを防ぐために、 <em>pyc</em> ファイルはパッケージディレクトリの下の &quot;__pycache__&quot; ディレクトリに収集するようになりました。</p>
<p>ファイル名と格納先ディレクトリは別にして、この新方式にはプログラマ目線での目に見える変化が少しあります:</p>
<ul>
<li><p>インポートされたモジュールには属性 <a class="reference internal" href="../reference/import.html#cached__" title="__cached__"><code class="xref py py-attr docutils literal notranslate"><span class="pre">__cached__</span></code></a> が追加されて、これにはインポートされたファイルの実際のファイル名を記憶しています:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">collections</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collections</span><span class="o">.</span><span class="n">__cached__</span> 
<span class="go">&#39;c:/py32/lib/__pycache__/collections.cpython-32.pyc&#39;</span>
</pre></div>
</div>
</li>
<li><p>The tag that is unique to each interpreter is accessible from the <code class="xref py py-mod docutils literal notranslate"><span class="pre">imp</span></code>
module:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">imp</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="n">imp</span><span class="o">.</span><span class="n">get_tag</span><span class="p">()</span> 
<span class="go">&#39;cpython-32&#39;</span>
</pre></div>
</div>
</li>
<li><p>Scripts that try to deduce source filename from the imported file now need to
be smarter.  It is no longer sufficient to simply strip the &quot;c&quot; from a &quot;.pyc&quot;
filename.  Instead, use the new functions in the <code class="xref py py-mod docutils literal notranslate"><span class="pre">imp</span></code> module:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">imp</span><span class="o">.</span><span class="n">source_from_cache</span><span class="p">(</span><span class="s1">&#39;c:/py32/lib/__pycache__/collections.cpython-32.pyc&#39;</span><span class="p">)</span> 
<span class="go">&#39;c:/py32/lib/collections.py&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">imp</span><span class="o">.</span><span class="n">cache_from_source</span><span class="p">(</span><span class="s1">&#39;c:/py32/lib/collections.py&#39;</span><span class="p">)</span> 
<span class="go">&#39;c:/py32/lib/__pycache__/collections.cpython-32.pyc&#39;</span>
</pre></div>
</div>
</li>
<li><p><a class="reference internal" href="../library/py_compile.html#module-py_compile" title="py_compile: Generate byte-code files from Python source files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">py_compile</span></code></a> と <a class="reference internal" href="../library/compileall.html#module-compileall" title="compileall: Tools for byte-compiling all Python source files in a directory tree."><code class="xref py py-mod docutils literal notranslate"><span class="pre">compileall</span></code></a> モジュールはこの新命名規則とターゲットディレクトリを反映するよう更新されました。 <em>compileall</em> のコマンドラインからの起動には新しいオプションが追加されました。 <code class="docutils literal notranslate"><span class="pre">-i</span></code> はコンパイルするファイルとディレクトリのリストを指定します。 <code class="docutils literal notranslate"><span class="pre">-b</span></code> はバイトコードファイルを <em>__pycache__</em> ではなく伝統的な場所に書き出します。</p></li>
<li><p>The <a class="reference internal" href="../library/importlib.html#module-importlib.abc" title="importlib.abc: Abstract base classes related to import"><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib.abc</span></code></a> module has been updated with new <a class="reference internal" href="../glossary.html#term-abstract-base-class"><span class="xref std std-term">abstract base
classes</span></a> for loading bytecode files.  The obsolete
ABCs, <code class="xref py py-class docutils literal notranslate"><span class="pre">PyLoader</span></code> and
<code class="xref py py-class docutils literal notranslate"><span class="pre">PyPycLoader</span></code>, have been deprecated (instructions on how
to stay Python 3.1 compatible are included with the documentation).</p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">参考</p>
<dl class="simple">
<dt><span class="target" id="index-32"></span><a class="pep reference external" href="https://peps.python.org/pep-3147/"><strong>PEP 3147</strong></a> - PYC リポジトリーディレクトリー</dt><dd><p>PEP written by Barry Warsaw.</p>
</dd>
</dl>
</div>
</section>
<section id="pep-3149-abi-version-tagged-so-files">
<h2>PEP 3149: ABI バージョンでタグ付けされた .so ファイル<a class="headerlink" href="#pep-3149-abi-version-tagged-so-files" title="Link to this heading">¶</a></h2>
<p>PYC レポジトリーディレクトリでは複数バイトコードのキャッシュファイルを共存できます。この PEP は共有オブジェクトについての同じようなメカニズムを実装します。それには共通のディレクトリを使い、個々のバージョンごとの名前の区別をします。</p>
<p>共通ディレクトリは &quot;pyshared&quot; です。また、ファイル名は Python 実装 (例えば CPython、PyPy、Jython など)、メジャー・マイナーバージョン番号やオプショナルなビルドフラグ (例えばデバッグビルドでの &quot;d&quot;、 pymalloc ビルドの &quot;m&quot;、ワイド幅 Unicode の &quot;u&quot;) を特定することで区別するように命名されます。任意のパッケージ &quot;foo&quot; について、配布パッケージがインストールされるとこれらファイルは例えばこのような具合でしょう:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">pyshared</span><span class="o">/</span><span class="n">foo</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mi">32</span><span class="n">m</span><span class="o">.</span><span class="n">so</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">pyshared</span><span class="o">/</span><span class="n">foo</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mi">33</span><span class="n">md</span><span class="o">.</span><span class="n">so</span>
</pre></div>
</div>
<p>Python 自身からこのタグに、 <a class="reference internal" href="../library/sysconfig.html#module-sysconfig" title="sysconfig: Python's configuration information"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sysconfig</span></code></a> モジュールにある関数でアクセス出来ます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sysconfig</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sysconfig</span><span class="o">.</span><span class="n">get_config_var</span><span class="p">(</span><span class="s1">&#39;SOABI&#39;</span><span class="p">)</span>       <span class="c1"># find the version tag</span>
<span class="go">&#39;cpython-32mu&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sysconfig</span><span class="o">.</span><span class="n">get_config_var</span><span class="p">(</span><span class="s1">&#39;EXT_SUFFIX&#39;</span><span class="p">)</span>  <span class="c1"># find the full filename extension</span>
<span class="go">&#39;.cpython-32mu.so&#39;</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参考</p>
<dl class="simple">
<dt><span class="target" id="index-33"></span><a class="pep reference external" href="https://peps.python.org/pep-3149/"><strong>PEP 3149</strong></a> - ABI バージョンでタグ付けされた .so ファイル</dt><dd><p>PEP written by Barry Warsaw.</p>
</dd>
</dl>
</div>
</section>
<section id="pep-3333-python-web-server-gateway-interface-v1-0-1">
<h2>PEP 3333: Python Web Server Gateway Interface v1.0.1<a class="headerlink" href="#pep-3333-python-web-server-gateway-interface-v1-0-1" title="Link to this heading">¶</a></h2>
<p>この情報 PEP は、 WSGI プロトコルによってどのようにバイト列/テキストの問題が処理されるべきかを明確化しています。HTTP プロトコルそのものはバイト列指向であっても、Python 3 にあってほとんど <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> 型で便利に文字列処理出来るようにすることが挑戦でした。</p>
<p>この PEP では、リクエスト/レスポンスヘッダとメタデータに使われるいわゆる <em>ネイティブ文字列(native strings)</em> と、リクエストとレスポンスのボディに使われる <em>バイト列文字列(byte strings)</em> を区別します。</p>
<p>The <em>native strings</em> are always of type <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> but are restricted to code
points between <em>U+0000</em> through <em>U+00FF</em> which are translatable to bytes using
<em>Latin-1</em> encoding.  These strings are used for the keys and values in the
environment dictionary and for response headers and statuses in the
<code class="xref py py-func docutils literal notranslate"><span class="pre">start_response()</span></code> function.  They must follow <span class="target" id="index-7"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html"><strong>RFC 2616</strong></a> with respect to
encoding. That is, they must either be <em>ISO-8859-1</em> characters or use
<span class="target" id="index-8"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2047.html"><strong>RFC 2047</strong></a> MIME encoding.</p>
<p>WSGI アプリケーションを Python 2 から移植する開発者は、とりわけ以下に注意してください:</p>
<ul class="simple">
<li><p>Python 2 でヘッダとしてネイティブ文字列を既に使っているアプリケーションは変更の必要はありません。(---訳注: 原文は「If the app already used strings for headers ...」。native strings としないと意味が通りません。 ---)</p></li>
<li><p>そうではなくアプリケーションが出力ヘッダをエンコードしていたり、入力ヘッダをデコードしていたのであれば、ヘッダは Latin-1 に再エンコードする必要があります。たとえば <code class="docutils literal notranslate"><span class="pre">h.encode('utf-8')</span></code> により utf-8 でエンコードされた出力ヘッダは、バイト列からネイティブ文字列に <code class="docutils literal notranslate"><span class="pre">h.encode('utf-8').decode('latin-1')</span></code> で変換する必要があります。(---訳注: この原文は h が元々 latin-1 で表現出来る文字セットであることを暗黙で仮定しているようです。---)</p></li>
<li><p>Values yielded by an application or sent using the <code class="xref py py-meth docutils literal notranslate"><span class="pre">write()</span></code> method
must be byte strings.  The <code class="xref py py-func docutils literal notranslate"><span class="pre">start_response()</span></code> function and environ
must use native strings.  The two cannot be mixed.</p></li>
</ul>
<p>For server implementers writing CGI-to-WSGI pathways or other CGI-style
protocols, the users must to be able access the environment using native strings
even though the underlying platform may have a different convention.  To bridge
this gap, the <a class="reference internal" href="../library/wsgiref.html#module-wsgiref" title="wsgiref: WSGI Utilities and Reference Implementation."><code class="xref py py-mod docutils literal notranslate"><span class="pre">wsgiref</span></code></a> module has a new function,
<a class="reference internal" href="../library/wsgiref.html#wsgiref.handlers.read_environ" title="wsgiref.handlers.read_environ"><code class="xref py py-func docutils literal notranslate"><span class="pre">wsgiref.handlers.read_environ()</span></code></a> for transcoding CGI variables from
<a class="reference internal" href="../library/os.html#os.environ" title="os.environ"><code class="xref py py-data docutils literal notranslate"><span class="pre">os.environ</span></code></a> into native strings and returning a new dictionary.</p>
<div class="admonition seealso">
<p class="admonition-title">参考</p>
<dl class="simple">
<dt><span class="target" id="index-9"></span><a class="pep reference external" href="https://peps.python.org/pep-3333/"><strong>PEP 3333</strong></a> - Python Web Server Gateway Interface v1.0.1</dt><dd><p>PEP written by Phillip Eby.</p>
</dd>
</dl>
</div>
</section>
<section id="other-language-changes">
<h2>その他の言語変更<a class="headerlink" href="#other-language-changes" title="Link to this heading">¶</a></h2>
<p>Python 言語コアに小さな変更がいくつか行われました:</p>
<ul>
<li><p><a class="reference internal" href="../library/functions.html#format" title="format"><code class="xref py py-func docutils literal notranslate"><span class="pre">format()</span></code></a> と <a class="reference internal" href="../library/stdtypes.html#str.format" title="str.format"><code class="xref py py-meth docutils literal notranslate"><span class="pre">str.format()</span></code></a> のフォーマット文字 <strong>#</strong> が拡張されました。以前から二進、八進、十六進整数に対して順にそれぞれ '0b', '0o', '0x' を冠する出力をしていましたが、これは浮動小数点数、複素数、 Decimal に対しても処理するようになり、これはあとに続く桁がなくても必ず小数点を出力します。</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">format</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;#o&#39;</span><span class="p">)</span>
<span class="go">&#39;0o24&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">format</span><span class="p">(</span><span class="mf">12.34</span><span class="p">,</span> <span class="s1">&#39;#5.0f&#39;</span><span class="p">)</span>
<span class="go">&#39;  12.&#39;</span>
</pre></div>
</div>
<p>(Suggested by Mark Dickinson and implemented by Eric Smith in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7094">bpo-7094</a>.)</p>
</li>
<li><p>新たに追加された <a class="reference internal" href="../library/stdtypes.html#str.format_map" title="str.format_map"><code class="xref py py-meth docutils literal notranslate"><span class="pre">str.format_map()</span></code></a> メソッドも既存の <a class="reference internal" href="../library/stdtypes.html#str.format" title="str.format"><code class="xref py py-meth docutils literal notranslate"><span class="pre">str.format()</span></code></a> メソッドの能力を拡大します。これは任意の <a class="reference internal" href="../glossary.html#term-mapping"><span class="xref std std-term">mapping</span></a> を受け付けます。この新規メソッドは Python の数多くの「辞書的な」オブジェクトとともに文字列書式化を使うことを可能にします。たとえば <a class="reference internal" href="../library/collections.html#collections.defaultdict" title="collections.defaultdict"><code class="xref py py-class docutils literal notranslate"><span class="pre">defaultdict</span></code></a>, <a class="reference internal" href="../library/shelve.html#shelve.Shelf" title="shelve.Shelf"><code class="xref py py-class docutils literal notranslate"><span class="pre">Shelf</span></code></a>, <a class="reference internal" href="../library/configparser.html#configparser.ConfigParser" title="configparser.ConfigParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigParser</span></code></a>, あるいは <a class="reference internal" href="../library/dbm.html#module-dbm" title="dbm: Interfaces to various Unix &quot;database&quot; formats."><code class="xref py py-mod docutils literal notranslate"><span class="pre">dbm</span></code></a> などで使えるということです。カスタムな <a class="reference internal" href="../library/stdtypes.html#dict" title="dict"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> のサブクラスと一緒に使うのも便利で、例えばルックアップの前にキーを正規化してみたり、未知のキーを <code class="xref py py-meth docutils literal notranslate"><span class="pre">__missing__()</span></code> メソッドで補ってみたりなど出来ます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">shelve</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">shelve</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;tmp.shl&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;The </span><span class="si">{project_name}</span><span class="s1"> status is </span><span class="si">{status}</span><span class="s1"> as of </span><span class="si">{date}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="go">&#39;The testing project status is green as of February 15, 2011&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">LowerCasedDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lcd</span> <span class="o">=</span> <span class="n">LowerCasedDict</span><span class="p">(</span><span class="n">part</span><span class="o">=</span><span class="s1">&#39;widgets&#39;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;There are </span><span class="si">{QUANTITY}</span><span class="s1"> </span><span class="si">{Part}</span><span class="s1"> in stock&#39;</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">lcd</span><span class="p">)</span>
<span class="go">&#39;There are 10 widgets in stock&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">PlaceholderDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__missing__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;Hello </span><span class="si">{name}</span><span class="s1">, welcome to </span><span class="si">{location}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">PlaceholderDict</span><span class="p">())</span>
<span class="go">&#39;Hello &lt;name&gt;, welcome to &lt;location&gt;&#39;</span>
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><p>(Suggested by Raymond Hettinger and implemented by Eric Smith in
<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=6081">bpo-6081</a>.)</p>
</div></blockquote>
<ul>
<li><p>The interpreter can now be started with a quiet option, <code class="docutils literal notranslate"><span class="pre">-q</span></code>, to prevent
the copyright and version information from being displayed in the interactive
mode.  The option can be introspected using the <a class="reference internal" href="../library/sys.html#sys.flags" title="sys.flags"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.flags</span></code></a> attribute:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-q
<span class="go">&gt;&gt;&gt; sys.flags</span>
<span class="go">sys.flags(debug=0, division_warning=0, inspect=0, interactive=0,</span>
<span class="go">optimize=0, dont_write_bytecode=0, no_user_site=0, no_site=0,</span>
<span class="go">ignore_environment=0, verbose=0, bytes_warning=0, quiet=1)</span>
</pre></div>
</div>
<p>(Contributed by Marcin Wojdyr in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1772833">bpo-1772833</a>).</p>
</li>
<li><p>The <a class="reference internal" href="../library/functions.html#hasattr" title="hasattr"><code class="xref py py-func docutils literal notranslate"><span class="pre">hasattr()</span></code></a> function works by calling <a class="reference internal" href="../library/functions.html#getattr" title="getattr"><code class="xref py py-func docutils literal notranslate"><span class="pre">getattr()</span></code></a> and detecting
whether an exception is raised.  This technique allows it to detect methods
created dynamically by <a class="reference internal" href="../reference/datamodel.html#object.__getattr__" title="object.__getattr__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__getattr__()</span></code></a> or <a class="reference internal" href="../reference/datamodel.html#object.__getattribute__" title="object.__getattribute__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__getattribute__()</span></code></a> which
would otherwise be absent from the class dictionary.  Formerly, <em>hasattr</em>
would catch any exception, possibly masking genuine errors.  Now, <em>hasattr</em>
has been tightened to only catch <a class="reference internal" href="../library/exceptions.html#AttributeError" title="AttributeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AttributeError</span></code></a> and let other
exceptions pass through:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="mi">1</span> <span class="o">//</span> <span class="mi">0</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">hasattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">  </span><span class="c">...</span>
<span class="gr">ZeroDivisionError</span>: <span class="n">integer division or modulo by zero</span>
</pre></div>
</div>
<p>(Discovered by Yury Selivanov and fixed by Benjamin Peterson; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9666">bpo-9666</a>.)</p>
</li>
<li><p>浮動小数点数または複素数に対する <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-func docutils literal notranslate"><span class="pre">str()</span></code></a> は <a class="reference internal" href="../library/functions.html#repr" title="repr"><code class="xref py py-func docutils literal notranslate"><span class="pre">repr()</span></code></a> 表現と同じになりました。以前は <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-func docutils literal notranslate"><span class="pre">str()</span></code></a> 形式のほうが短い表現になっていましたがこれは単に困惑させるものでした。 <a class="reference internal" href="../library/functions.html#repr" title="repr"><code class="xref py py-func docutils literal notranslate"><span class="pre">repr()</span></code></a> がデフォルトで可能ななかでの一番短い表現をするようになったので、 <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-func docutils literal notranslate"><span class="pre">str()</span></code></a> があえて短い表現を取ろうとする必要性がなくなりました。</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">math</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">repr</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="go">&#39;3.141592653589793&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="go">&#39;3.141592653589793&#39;</span>
</pre></div>
</div>
<p>(Proposed and implemented by Mark Dickinson; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9337">bpo-9337</a>.)</p>
</li>
<li><p><a class="reference internal" href="../library/stdtypes.html#memoryview" title="memoryview"><code class="xref py py-class docutils literal notranslate"><span class="pre">memoryview</span></code></a> オブジェクトに <a class="reference internal" href="../library/stdtypes.html#memoryview.release" title="memoryview.release"><code class="xref py py-meth docutils literal notranslate"><span class="pre">release()</span></code></a> メソッドが追加され、また、これは今ではコンテキストマネージャプロトコルをサポートします。このことにより、オリジナルのオブジェクトからバッファを要求した際に獲得した任意のリソースを、適切な時点で解放できます。</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">memoryview</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;abcdefgh&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<span class="go">[97, 98, 99, 100, 101, 102, 103, 104]</span>
</pre></div>
</div>
<p>(Added by Antoine Pitrou; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9757">bpo-9757</a>.)</p>
</li>
<li><p>以前は、入れ子になったブロック内である名前が自由変数として現れる場合、局所名前空間からその名前を削除することは不正でした。</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">outer</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">x</span>
    <span class="n">inner</span><span class="p">()</span>
    <span class="k">del</span> <span class="n">x</span>
</pre></div>
</div>
<p>これは可能になりました。
<a class="reference internal" href="../reference/compound_stmts.html#except"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">except</span></code></a> 節の対象が消去されることを思い出せば、
Python 2.6 では動き、Python 3.1 では <a class="reference internal" href="../library/exceptions.html#SyntaxError" title="SyntaxError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxError</span></code></a> を送出するこのコードは再び動きます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">print_error</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">something</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">print_error</span><span class="p">()</span>
        <span class="c1"># implicit &quot;del e&quot; here</span>
</pre></div>
</div>
<p>(<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=4617">bpo-4617</a> を参照してください。)</p>
</li>
<li><p><a class="reference internal" href="../c-api/tuple.html#struct-sequence-objects"><span class="std std-ref">Struct sequence types</span></a> are now subclasses of tuple.
This means that C structures like those returned by <a class="reference internal" href="../library/os.html#os.stat" title="os.stat"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.stat()</span></code></a>,
<a class="reference internal" href="../library/time.html#time.gmtime" title="time.gmtime"><code class="xref py py-func docutils literal notranslate"><span class="pre">time.gmtime()</span></code></a>, and <a class="reference internal" href="../library/sys.html#sys.version_info" title="sys.version_info"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.version_info</span></code></a> now work like a
<a class="reference internal" href="../glossary.html#term-named-tuple"><span class="xref std std-term">named tuple</span></a> and now work with functions and methods that
expect a tuple as an argument.  This is a big step forward in making the C
structures as flexible as their pure Python counterparts:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;Version </span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1"> </span><span class="si">%s</span><span class="s1">(</span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> 
<span class="go">&#39;Version 3.2.0 final(0)&#39;</span>
</pre></div>
</div>
<p>(Suggested by Arfrever Frehtes Taifersar Arahesis and implemented
by Benjamin Peterson in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8413">bpo-8413</a>.)</p>
</li>
<li><p>警告の制御を以前より簡単に出来るようになりました。環境変数 <span class="target" id="index-34"></span><a class="reference internal" href="../using/cmdline.html#envvar-PYTHONWARNINGS"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONWARNINGS</span></code></a> を使えば、コマンドラインで <code class="docutils literal notranslate"><span class="pre">-W</span></code> を使うより簡単です:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONWARNINGS</span><span class="o">=</span><span class="s1">&#39;ignore::RuntimeWarning::,once::UnicodeWarning::&#39;</span>
</pre></div>
</div>
<p>(Suggested by Barry Warsaw and implemented by Philip Jenvey in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7301">bpo-7301</a>.)</p>
</li>
<li><p>新たな警告カテゴリ <a class="reference internal" href="../library/exceptions.html#ResourceWarning" title="ResourceWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ResourceWarning</span></code></a> が追加されました。これはリソース消費やクリーンアップについての潜在的な問題が検出されると発行されます。これは通常のリリースビルドではデフォルトでは黙殺しますが、 <a class="reference internal" href="../library/warnings.html#module-warnings" title="warnings: Issue warning messages and control their disposition."><code class="xref py py-mod docutils literal notranslate"><span class="pre">warnings</span></code></a> モジュールで意味付けを変更 (訳注: <a class="reference internal" href="../library/warnings.html#warning-filter"><span class="std std-ref">警告フィルタ</span></a> 参照) するかコマンドラインオプションで有効に出来ます。</p>
<p>A <a class="reference internal" href="../library/exceptions.html#ResourceWarning" title="ResourceWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ResourceWarning</span></code></a> is issued at interpreter shutdown if the
<a class="reference internal" href="../library/gc.html#gc.garbage" title="gc.garbage"><code class="xref py py-data docutils literal notranslate"><span class="pre">gc.garbage</span></code></a> list isn't empty, and if <a class="reference internal" href="../library/gc.html#gc.DEBUG_UNCOLLECTABLE" title="gc.DEBUG_UNCOLLECTABLE"><code class="xref py py-const docutils literal notranslate"><span class="pre">gc.DEBUG_UNCOLLECTABLE</span></code></a> is
set, all uncollectable objects are printed.  This is meant to make the
programmer aware that their code contains object finalization issues.</p>
<p><a class="reference internal" href="../library/exceptions.html#ResourceWarning" title="ResourceWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ResourceWarning</span></code></a> は明示的にクローズされなかった <a class="reference internal" href="../glossary.html#term-file-object"><span class="xref std std-term">file object</span></a> が破壊される際にも発行されます。そのようなオブジェクトのデアロケータは背後の OS リソース (大抵はファイル記述子) を閉じることを保障はしますが、オブジェクトのデアロケートの遅れは様々な問題を産み落とし、とりわけ Windows でこれは顕著です。コマンドラインからこの警告を有効にするには例えばこのようにします:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-q<span class="w"> </span>-Wdefault
<span class="go">&gt;&gt;&gt; f = open(&quot;foo&quot;, &quot;wb&quot;)</span>
<span class="go">&gt;&gt;&gt; del f</span>
<span class="go">__main__:1: ResourceWarning: unclosed file &lt;_io.BufferedWriter name=&#39;foo&#39;&gt;</span>
</pre></div>
</div>
<p>(Added by Antoine Pitrou and Georg Brandl in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10093">bpo-10093</a> and <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=477863">bpo-477863</a>.)</p>
</li>
<li><p><a class="reference internal" href="../library/stdtypes.html#range" title="range"><code class="xref py py-class docutils literal notranslate"><span class="pre">range</span></code></a> objects now support <em>index</em> and <em>count</em> methods. This is part
of an effort to make more objects fully implement the
<a class="reference internal" href="../library/collections.abc.html#collections.abc.Sequence" title="collections.abc.Sequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.Sequence</span></code></a> <a class="reference internal" href="../glossary.html#term-abstract-base-class"><span class="xref std std-term">abstract base class</span></a>.  As a result, the
language will have a more uniform API.  In addition, <a class="reference internal" href="../library/stdtypes.html#range" title="range"><code class="xref py py-class docutils literal notranslate"><span class="pre">range</span></code></a> objects
now support slicing and negative indices, even with values larger than
<a class="reference internal" href="../library/sys.html#sys.maxsize" title="sys.maxsize"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.maxsize</span></code></a>.  This makes <em>range</em> more interoperable with lists:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">5</span><span class="p">]</span>
<span class="go">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
<span class="go">range(0, 10, 2)</span>
</pre></div>
</div>
<p>(Contributed by Daniel Stutzbach in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9213">bpo-9213</a>, by Alexander Belopolsky
in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=2690">bpo-2690</a>, and by Nick Coghlan in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10889">bpo-10889</a>.)</p>
</li>
<li><p>Py2.x から <a class="reference internal" href="../library/functions.html#callable" title="callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">callable()</span></code></a> 組み込み関数が復活しました。
この関数は <code class="docutils literal notranslate"><span class="pre">isinstance(x,</span> <span class="pre">collections.Callable)</span></code> のように式内で <a class="reference internal" href="../glossary.html#term-abstract-base-class"><span class="xref std std-term">抽象基底クラス</span></a> を使用するよりも、簡潔で可読性の高い手段を提供します:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">callable</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">callable</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
<p>(<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10518">bpo-10518</a> を参照してください。)</p>
</li>
<li><p>Python のインポート機構が、パス名に非 ASCII 文字を含むディレクトリにインストールされたモジュールをロードできるようになりました。これはユーザ名に非 ASCII 文字を含むユーザにとっての、ホームディレクトリにまつわる腹立たしい問題を解決しました。</p></li>
</ul>
<blockquote>
<div><p>(Required extensive work by Victor Stinner in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9425">bpo-9425</a>.)</p>
</div></blockquote>
</section>
<section id="new-improved-and-deprecated-modules">
<h2>新たなモジュール、改良されたモジュール、非推奨のモジュール<a class="headerlink" href="#new-improved-and-deprecated-modules" title="Link to this heading">¶</a></h2>
<p>Python の標準ライブラリは保守の努力と質の向上を大きく受けています。</p>
<p>The biggest news for Python 3.2 is that the <a class="reference internal" href="../library/email.html#module-email" title="email: Package supporting the parsing, manipulating, and generating email messages."><code class="xref py py-mod docutils literal notranslate"><span class="pre">email</span></code></a> package, <a class="reference internal" href="../library/mailbox.html#module-mailbox" title="mailbox: Manipulate mailboxes in various formats"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mailbox</span></code></a>
module, and <a class="reference internal" href="../library/nntplib.html#module-nntplib" title="nntplib: NNTP protocol client (requires sockets). (非推奨)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">nntplib</span></code></a> modules now work correctly with the bytes/text model
in Python 3.  For the first time, there is correct handling of messages with
mixed encodings.</p>
<p>標準ライブラリ全体を通じて、エンコーディング問題とテキスト対バイト列問題に関してより注意深い配慮がなされました。とりわけオペレーティングシステムとの連携では、Windows の MBCS エンコーディングやロケールに配慮するエンコーディング、あるいは UTF-8 を使う非 ASCII のデータ交換はより良く行えるようになりました。</p>
<p>もうひとつの目覚しい勝利は、 <em>SSL</em> 接続とセキュリティ証明書サポートの大幅な改善です。</p>
<p>さらに、以前よりももっと多くのクラスが今では <a class="reference internal" href="../glossary.html#term-context-manager"><span class="xref std std-term">context manager</span></a> を実装し、 <a class="reference internal" href="../reference/compound_stmts.html#with"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">with</span></code></a> 文を使った便利で信頼出来るリソースのクリーンアップをサポートしています。</p>
<section id="email">
<h3>email<a class="headerlink" href="#email" title="Link to this heading">¶</a></h3>
<p>R. David Murray による多大なる尽力により、Python 3 における <a class="reference internal" href="../library/email.html#module-email" title="email: Package supporting the parsing, manipulating, and generating email messages."><code class="xref py py-mod docutils literal notranslate"><span class="pre">email</span></code></a> パッケージの適応可能性の問題は、ほとんど修正されました。問題は、email が典型的には <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> テキストよりも <a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> 形式で格納され、読まれることであり、一つの email の中に複数のエンコーディングを含みうることでした。ですから email パッケージは email メッセージの解析と生成を bytes フォーマットで拡張される必要がありました。</p>
<ul>
<li><p>新規関数 <a class="reference internal" href="../library/email.parser.html#email.message_from_bytes" title="email.message_from_bytes"><code class="xref py py-func docutils literal notranslate"><span class="pre">message_from_bytes()</span></code></a>, <a class="reference internal" href="../library/email.parser.html#email.message_from_binary_file" title="email.message_from_binary_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">message_from_binary_file()</span></code></a> 、それに新規クラス <a class="reference internal" href="../library/email.parser.html#email.parser.BytesFeedParser" title="email.parser.BytesFeedParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">BytesFeedParser</span></code></a>, <a class="reference internal" href="../library/email.parser.html#email.parser.BytesParser" title="email.parser.BytesParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">BytesParser</span></code></a> が、バイナリメッセージデータをパースしてモデルオブジェクトに読み込みます。</p></li>
<li><p>bytes の入力をモデルに与えると <a class="reference internal" href="../library/email.compat32-message.html#email.message.Message.get_payload" title="email.message.Message.get_payload"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_payload()</span></code></a> は、デフォルトでは <em>8 ビット</em> の <em class="mailheader">Content-Transfer-Encoding</em> MIME ヘッダをもったメッセージボディをそのヘッダで指定された文字セットを使い、デコードして結果文字列を返します。</p></li>
<li><p>bytes の入力をモデルに与えると <a class="reference internal" href="../library/email.generator.html#email.generator.Generator" title="email.generator.Generator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Generator</span></code></a> は、 <em>8 ビット</em> の <em class="mailheader">Content-Transfer-Encoding</em> MIME ヘッダをもったメッセージボディを、 <em>7 ビット</em> の <em class="mailheader">Content-Transfer-Encoding</em> を持つものに変換します。</p>
<p>エンコードされていない非 ASCII バイト列を持つヘッダは <em>未知の 8 ビット</em> 文字セットを使った <span class="target" id="index-35"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2047.html"><strong>RFC 2047</strong></a> エンコードであると見做されます。</p>
</li>
<li><p>新規クラス <a class="reference internal" href="../library/email.generator.html#email.generator.BytesGenerator" title="email.generator.BytesGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">BytesGenerator</span></code></a> は出力としてバイト列を生成します。これはモデルを構築するのに使った入力にあった非 ASCII データをそのままにし、 <em>8ビットの</em> <em class="mailheader">Content-Transfer-Encoding</em> を持つメッセージボディに含めます。</p></li>
<li><p><a class="reference internal" href="../library/smtplib.html#module-smtplib" title="smtplib: SMTP protocol client (requires sockets)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">smtplib</span></code></a> モジュールの <a class="reference internal" href="../library/smtplib.html#smtplib.SMTP" title="smtplib.SMTP"><code class="xref py py-class docutils literal notranslate"><span class="pre">SMTP</span></code></a> クラスが <a class="reference internal" href="../library/smtplib.html#smtplib.SMTP.sendmail" title="smtplib.SMTP.sendmail"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sendmail()</span></code></a> メソッドの <em>msg</em> 引数としてバイト列文字列を受け付けるようになりました。新しく追加されたメソッド <a class="reference internal" href="../library/smtplib.html#smtplib.SMTP.send_message" title="smtplib.SMTP.send_message"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send_message()</span></code></a> は <em>msg</em> 引数に <a class="reference internal" href="../library/email.compat32-message.html#email.message.Message" title="email.message.Message"><code class="xref py py-class docutils literal notranslate"><span class="pre">Message</span></code></a> オブジェクトを受け付けます。このメソッドは <em>msg</em> にあたえたオブジェクトから <em>from_addr</em> アドレスと <em>to_addrs</em> アドレスを直接取ることが出来ます。</p></li>
</ul>
<p>(Proposed and implemented by R. David Murray, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=4661">bpo-4661</a> and <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10321">bpo-10321</a>.)</p>
</section>
<section id="elementtree">
<h3>elementtree<a class="headerlink" href="#elementtree" title="Link to this heading">¶</a></h3>
<p>The <a class="reference internal" href="../library/xml.etree.elementtree.html#module-xml.etree.ElementTree" title="xml.etree.ElementTree: Implementation of the ElementTree API."><code class="xref py py-mod docutils literal notranslate"><span class="pre">xml.etree.ElementTree</span></code></a> package and its <code class="xref py py-mod docutils literal notranslate"><span class="pre">xml.etree.cElementTree</span></code>
counterpart have been updated to version 1.3.</p>
<p>有用な関数とメソッドが幾つか新たに追加されました:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.fromstringlist" title="xml.etree.ElementTree.fromstringlist"><code class="xref py py-func docutils literal notranslate"><span class="pre">xml.etree.ElementTree.fromstringlist()</span></code></a>、断片のシーケンスから XML 文書を組み立てます</p></li>
<li><p><a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.register_namespace" title="xml.etree.ElementTree.register_namespace"><code class="xref py py-func docutils literal notranslate"><span class="pre">xml.etree.ElementTree.register_namespace()</span></code></a>、大域名前空間接頭辞を登録するのに使用します</p></li>
<li><p><a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.tostringlist" title="xml.etree.ElementTree.tostringlist"><code class="xref py py-func docutils literal notranslate"><span class="pre">xml.etree.ElementTree.tostringlist()</span></code></a>、全サブリストを含めた文字列表記に使用します</p></li>
<li><p><a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.Element.extend" title="xml.etree.ElementTree.Element.extend"><code class="xref py py-meth docutils literal notranslate"><span class="pre">xml.etree.ElementTree.Element.extend()</span></code></a>、ゼロ以上の要素のシークエンスを追加するのに使用します</p></li>
<li><p><a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.Element.iterfind" title="xml.etree.ElementTree.Element.iterfind"><code class="xref py py-meth docutils literal notranslate"><span class="pre">xml.etree.ElementTree.Element.iterfind()</span></code></a>、要素と子要素を検索します</p></li>
<li><p><a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.Element.itertext" title="xml.etree.ElementTree.Element.itertext"><code class="xref py py-meth docutils literal notranslate"><span class="pre">xml.etree.ElementTree.Element.itertext()</span></code></a>、要素と子要素を走るテキストイテレータを作成します</p></li>
<li><p><a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.TreeBuilder.end" title="xml.etree.ElementTree.TreeBuilder.end"><code class="xref py py-meth docutils literal notranslate"><span class="pre">xml.etree.ElementTree.TreeBuilder.end()</span></code></a>、現在の要素を閉じます</p></li>
<li><p><a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.TreeBuilder.doctype" title="xml.etree.ElementTree.TreeBuilder.doctype"><code class="xref py py-meth docutils literal notranslate"><span class="pre">xml.etree.ElementTree.TreeBuilder.doctype()</span></code></a>、doctype 定義を処理します</p></li>
</ul>
<p>2つのメソッドが非推奨になりました:</p>
<ul class="simple">
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">xml.etree.ElementTree.getchildren()</span></code> use <code class="docutils literal notranslate"><span class="pre">list(elem)</span></code> instead.</p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">xml.etree.ElementTree.getiterator()</span></code> use <code class="docutils literal notranslate"><span class="pre">Element.iter</span></code> instead.</p></li>
</ul>
<p>For details of the update, see <a class="reference external" href="https://web.archive.org/web/20200703234532/http://effbot.org/zone/elementtree-13-intro.htm">Introducing ElementTree</a>
on Fredrik Lundh's website.</p>
<p>(Contributed by Florent Xicluna and Fredrik Lundh, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=6472">bpo-6472</a>.)</p>
</section>
<section id="functools">
<h3>functools<a class="headerlink" href="#functools" title="Link to this heading">¶</a></h3>
<ul>
<li><p><a class="reference internal" href="../library/functools.html#module-functools" title="functools: Higher-order functions and operations on callable objects."><code class="xref py py-mod docutils literal notranslate"><span class="pre">functools</span></code></a> モジュールに関数呼び出しをキャッシュするデコレータが追加されています。 <a class="reference internal" href="../library/functools.html#functools.lru_cache" title="functools.lru_cache"><code class="xref py py-func docutils literal notranslate"><span class="pre">functools.lru_cache()</span></code></a> を使うと、同じ結果が期待される場合の外部リソースへの問い合わせ繰り返しを防ぐことができます。</p>
<p>たとえばデータベース問い合わせ関数をキャッシュするデコレータで修飾すれば、人気の検索のデータベースアクセスを省けます:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">functools</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">get_phone_number</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">c</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT phonenumber FROM phonelist WHERE name=?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,))</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">user_requests</span><span class="p">:</span>        
<span class="gp">... </span>    <span class="n">get_phone_number</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>        <span class="c1"># cached lookup</span>
</pre></div>
</div>
<p>効果的なキャッシュサイズを選択する助けとなるよう、ラップされた関数はキャッシュの統計を追跡する道具にもなっています:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_phone_number</span><span class="o">.</span><span class="n">cache_info</span><span class="p">()</span>     
<span class="go">CacheInfo(hits=4805, misses=980, maxsize=300, currsize=300)</span>
</pre></div>
</div>
<p>テーブル phonelist が更新されたのであれば、内容が古くなったキャッシュをクリアできます:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_phone_number</span><span class="o">.</span><span class="n">cache_clear</span><span class="p">()</span>
</pre></div>
</div>
<p>(Contributed by Raymond Hettinger and incorporating design ideas from Jim
Baker, Miki Tebeka, and Nick Coghlan; see <a class="reference external" href="https://code.activestate.com/recipes/498245-lru-and-lfu-cache-decorators/">recipe 498245</a>, <a class="reference external" href="https://code.activestate.com/recipes/577479-simple-caching-decorator/">recipe 577479</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10586">bpo-10586</a>, and
<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10593">bpo-10593</a>.)</p>
</li>
<li><p>The <a class="reference internal" href="../library/functools.html#functools.wraps" title="functools.wraps"><code class="xref py py-func docutils literal notranslate"><span class="pre">functools.wraps()</span></code></a> decorator now adds a <code class="xref py py-attr docutils literal notranslate"><span class="pre">__wrapped__</span></code> attribute
pointing to the original callable function.  This allows wrapped functions to
be introspected.  It also copies <a class="reference internal" href="../reference/datamodel.html#function.__annotations__" title="function.__annotations__"><code class="xref py py-attr docutils literal notranslate"><span class="pre">__annotations__</span></code></a> if
defined.  And now it also gracefully skips over missing attributes such as
<a class="reference internal" href="../reference/datamodel.html#function.__doc__" title="function.__doc__"><code class="xref py py-attr docutils literal notranslate"><span class="pre">__doc__</span></code></a> which
might not be defined for the wrapped callable.</p>
<p>上の例の場合、キャッシュは元の関数を復元することで削除できます:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_phone_number</span> <span class="o">=</span> <span class="n">get_phone_number</span><span class="o">.</span><span class="n">__wrapped__</span>    <span class="c1"># uncached function</span>
</pre></div>
</div>
<p>(By Nick Coghlan and Terrence Cole; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9567">bpo-9567</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=3445">bpo-3445</a>, and
<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8814">bpo-8814</a>.)</p>
</li>
<li><p>拡張比較 (rich comparison) メソッドを持つクラスを書く助けとなるよう、新たなデコレータ <a class="reference internal" href="../library/functools.html#functools.total_ordering" title="functools.total_ordering"><code class="xref py py-func docutils literal notranslate"><span class="pre">functools.total_ordering()</span></code></a> が追加されました。これは既存の等式と不等式メソッドを使って残りのメソッドを埋めます。</p>
<p>例えば <em>__eq__</em> と <em>__lt__</em> を与えると、 <a class="reference internal" href="../library/functools.html#functools.total_ordering" title="functools.total_ordering"><code class="xref py py-func docutils literal notranslate"><span class="pre">total_ordering()</span></code></a> は <em>__le__</em>, <em>__gt__</em>, <em>__ge__</em> を補います:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@total_ordering</span>
<span class="k">class</span> <span class="nc">Student</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">lastname</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstname</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="o">==</span>
                <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">lastname</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">firstname</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">lastname</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstname</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="o">&lt;</span>
                <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">lastname</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">firstname</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
</pre></div>
</div>
<p><em>total_ordering</em> デコレータが残りの比較メソッドを自動的に補います。</p>
<p>(Contributed by Raymond Hettinger.)</p>
</li>
<li><p>Python 2 からのプログラムの移植のために使える、 <a class="reference internal" href="../library/functools.html#functools.cmp_to_key" title="functools.cmp_to_key"><code class="xref py py-func docutils literal notranslate"><span class="pre">functools.cmp_to_key()</span></code></a> 関数が追加されました。これは旧式の比較関数をモダンな <a class="reference internal" href="../glossary.html#term-key-function"><span class="xref std std-term">key function</span></a> に変換します:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># locale-aware sort order</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">locale</span><span class="o">.</span><span class="n">strcoll</span><span class="p">))</span> 
</pre></div>
</div>
<p>ソートの例と簡単なチュートリアルは <a class="reference internal" href="../howto/sorting.html#sortinghowto"><span class="std std-ref">Sorting Techniques</span></a> を参照して下さい。</p>
<p>(Contributed by Raymond Hettinger.)</p>
</li>
</ul>
</section>
<section id="itertools">
<h3>itertools<a class="headerlink" href="#itertools" title="Link to this heading">¶</a></h3>
<ul>
<li><p><a class="reference internal" href="../library/itertools.html#module-itertools" title="itertools: Functions creating iterators for efficient looping."><code class="xref py py-mod docutils literal notranslate"><span class="pre">itertools</span></code></a> モジュールに、 <a class="reference external" href="https://ja.wikipedia.org/wiki/APL">APL</a> の <em>scan</em> 演算子や <a class="reference external" href="http://www.numpy.org/">NumPy</a> の <em>accumulate</em> 関数をモデルにした <a class="reference internal" href="../library/itertools.html#itertools.accumulate" title="itertools.accumulate"><code class="xref py py-func docutils literal notranslate"><span class="pre">accumulate()</span></code></a> が新しく追加されました:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">accumulate</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">accumulate</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">50</span><span class="p">]))</span>
<span class="go">[8, 10, 60]</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prob_dist</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">accumulate</span><span class="p">(</span><span class="n">prob_dist</span><span class="p">))</span>      <span class="c1"># cumulative probability distribution</span>
<span class="go">[0.1, 0.5, 0.7, 1.0]</span>
</pre></div>
</div>
<p><a class="reference internal" href="../library/itertools.html#itertools.accumulate" title="itertools.accumulate"><code class="xref py py-func docutils literal notranslate"><span class="pre">accumulate()</span></code></a> の使用例が <a class="reference internal" href="../library/random.html#random-examples"><span class="std std-ref">examples for the random module</span></a> にあります。</p>
<p>(Contributed by Raymond Hettinger and incorporating design suggestions
from Mark Dickinson.)</p>
</li>
</ul>
</section>
<section id="collections">
<h3>collections<a class="headerlink" href="#collections" title="Link to this heading">¶</a></h3>
<ul>
<li><p><a class="reference internal" href="../library/collections.html#collections.Counter" title="collections.Counter"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.Counter</span></code></a> クラスに 2 つの形式のインプレイス減算が追加されました。 <a class="reference external" href="https://en.wikipedia.org/wiki/Saturation_arithmetic">saturating subtraction</a> (訳注: 結果を [min, max] に収める演算) を行う既存の <em>-=</em> 演算子に加え、新しく追加された <a class="reference internal" href="../library/collections.html#collections.Counter.subtract" title="collections.Counter.subtract"><code class="xref py py-meth docutils literal notranslate"><span class="pre">subtract()</span></code></a> メソッドは通常の減算を行います。前者は要素数に正しか持たない <a class="reference external" href="https://ja.wikipedia.org/wiki/%E5%A4%9A%E9%87%8D%E9%9B%86%E5%90%88">多重集合</a> に用いるのに適していて、後者は要素数に負を許容するユースケースにより適しています。</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tally</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">dogs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cats</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tally</span> <span class="o">-=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">dogs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cats</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>    <span class="c1"># saturating subtraction</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tally</span>
<span class="go">Counter({&#39;dogs&#39;: 3})</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tally</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">dogs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cats</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tally</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">dogs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cats</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>      <span class="c1"># regular subtraction</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tally</span>
<span class="go">Counter({&#39;dogs&#39;: 3, &#39;cats&#39;: -5})</span>
</pre></div>
</div>
<p>(Contributed by Raymond Hettinger.)</p>
</li>
<li><p><a class="reference internal" href="../library/collections.html#collections.OrderedDict" title="collections.OrderedDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.OrderedDict</span></code></a> クラスに <a class="reference internal" href="../library/collections.html#collections.OrderedDict.move_to_end" title="collections.OrderedDict.move_to_end"><code class="xref py py-meth docutils literal notranslate"><span class="pre">move_to_end()</span></code></a> メソッド (訳注: 「end」は「端」) が追加されました。これは既存のキーを受け取って、順序付けされたシーケンスの最初の位置か最後の位置に移動します。</p>
<p>デフォルトでは要素は最後の位置に移動します。これはエントリを <code class="docutils literal notranslate"><span class="pre">od[k]</span> <span class="pre">=</span> <span class="pre">od.pop(k)</span></code> で入れ替えるのと同じです。</p>
<p>高速な端への移動操作はエントリの並べなおしに便利です。例えば、最も最近使った順序でエントリを年齢付けすることによってアクセス順を追跡するのに、順序付けされた辞書を使えます。</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;X&#39;, &#39;d&#39;, &#39;e&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">move_to_end</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;, &#39;d&#39;, &#39;e&#39;, &#39;X&#39;]</span>
</pre></div>
</div>
<p>(Contributed by Raymond Hettinger.)</p>
</li>
<li><p><a class="reference internal" href="../library/collections.html#collections.deque" title="collections.deque"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.deque</span></code></a> クラスに 2 つのメソッド <a class="reference internal" href="../library/collections.html#collections.deque.count" title="collections.deque.count"><code class="xref py py-meth docutils literal notranslate"><span class="pre">count()</span></code></a> と <a class="reference internal" href="../library/collections.html#collections.deque.reverse" title="collections.deque.reverse"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reverse()</span></code></a> が追加されました。これでさらに <a class="reference internal" href="../library/stdtypes.html#list" title="list"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> との置換可能性が増しました:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="s1">&#39;simsalabim&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>
<span class="go">deque([&#39;m&#39;, &#39;i&#39;, &#39;b&#39;, &#39;a&#39;, &#39;l&#39;, &#39;a&#39;, &#39;s&#39;, &#39;m&#39;, &#39;i&#39;, &#39;s&#39;])</span>
</pre></div>
</div>
<p>(Contributed by Raymond Hettinger.)</p>
</li>
</ul>
</section>
<section id="threading">
<h3>threading<a class="headerlink" href="#threading" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/threading.html#module-threading" title="threading: Thread-based parallelism."><code class="xref py py-mod docutils literal notranslate"><span class="pre">threading</span></code></a> モジュールに新たに同期クラス <a class="reference internal" href="../library/threading.html#threading.Barrier" title="threading.Barrier"><code class="xref py py-class docutils literal notranslate"><span class="pre">Barrier</span></code></a> が追加されました。これは多重のスレッドに、それら全てが共通のバリアポイントに到達するまで待たせます。バリアは、複数の事前条件を持ったタスクを、その前任タスクの全てが完了するまで走らせたくない場合に有用です。</p>
<p>バリアは任意の数のスレッドに対して使えます。これは <a class="reference external" href="https://en.wikipedia.org/wiki/Synchronous_rendezvous">Rendezvous</a> を一般化したもので、それは 2 つのスレッドに対してのみに定義されていました。</p>
<p>二段階の周期バリアとしての実装なので、 <a class="reference internal" href="../library/threading.html#threading.Barrier" title="threading.Barrier"><code class="xref py py-class docutils literal notranslate"><span class="pre">Barrier</span></code></a> オブジェクトはループ内での利用に適しています。分けられた <em>filling (満杯にする)</em> 段階と <em>draining (排出する)</em> 段階は、スレッドのどれか一つが元に戻ってバリアに再び入る前に、全てのスレッドが解放 (排出) されることを保障します。バリアはそれぞれの周期のあとに完全にリセットされます。</p>
<p>バリアは例えばこのように使います:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Barrier</span><span class="p">,</span> <span class="n">Thread</span>

<span class="k">def</span> <span class="nf">get_votes</span><span class="p">(</span><span class="n">site</span><span class="p">):</span>
    <span class="n">ballots</span> <span class="o">=</span> <span class="n">conduct_election</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
    <span class="n">all_polls_closed</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>        <span class="c1"># do not count until all polls are closed</span>
    <span class="n">totals</span> <span class="o">=</span> <span class="n">summarize</span><span class="p">(</span><span class="n">ballots</span><span class="p">)</span>
    <span class="n">publish</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">totals</span><span class="p">)</span>

<span class="n">all_polls_closed</span> <span class="o">=</span> <span class="n">Barrier</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sites</span><span class="p">))</span>
<span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">:</span>
    <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">get_votes</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">site</span><span class="p">,))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>この例ではバリアは、全ての投票所が閉じるまではどの投票サイトでも得票を数えないルールを強制しています。バリアを使ったソリューションが <a class="reference internal" href="../library/threading.html#threading.Thread.join" title="threading.Thread.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">threading.Thread.join()</span></code></a> でのそれといかに似ているか気付くと思います。ですがバリアポイントを通過した後に、スレッドは生き続けて (投票を集計する (summarizing ballots) という) 仕事を続けます。</p>
<p>いずれかの前任タスクがハングしたり遅延したりしうるのであれば、バリアを <em>timeout</em> 付きで作ることができます。全ての前任タスクがバリアポイントに到達する前にタイムアウトの期間が経過すると、全ての待機スレッドは解放されて <a class="reference internal" href="../library/threading.html#threading.BrokenBarrierError" title="threading.BrokenBarrierError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">BrokenBarrierError</span></code></a> 例外が発生します:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_votes</span><span class="p">(</span><span class="n">site</span><span class="p">):</span>
    <span class="n">ballots</span> <span class="o">=</span> <span class="n">conduct_election</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">all_polls_closed</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">midnight</span> <span class="o">-</span> <span class="n">time</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
    <span class="k">except</span> <span class="n">BrokenBarrierError</span><span class="p">:</span>
        <span class="n">lockbox</span> <span class="o">=</span> <span class="n">seal_ballots</span><span class="p">(</span><span class="n">ballots</span><span class="p">)</span>
        <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">lockbox</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">totals</span> <span class="o">=</span> <span class="n">summarize</span><span class="p">(</span><span class="n">ballots</span><span class="p">)</span>
        <span class="n">publish</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">totals</span><span class="p">)</span>
</pre></div>
</div>
<p>この例ではバリアは、もっと手堅いルールを強制しています。選挙サイトのどれかが午前零時前に終了しなかった場合バリアがタイムアウトし、投票用紙は密封されて後の処理のためのキューに預けられます。</p>
<p>See <a class="reference external" href="https://osl.cs.illinois.edu/media/papers/karmani-2009-barrier_synchronization_pattern.pdf">Barrier Synchronization Patterns</a>
for more examples of how barriers can be used in parallel computing.  Also, there is
a simple but thorough explanation of barriers in <a class="reference external" href="https://greenteapress.com/semaphores/LittleBookOfSemaphores.pdf">The Little Book of Semaphores</a>, <em>section 3.6</em>.</p>
<p>(Contributed by Kristján Valur Jónsson with an API review by Jeffrey Yasskin in
<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8777">bpo-8777</a>.)</p>
</section>
<section id="datetime-and-time">
<h3>datetime と time<a class="headerlink" href="#datetime-and-time" title="Link to this heading">¶</a></h3>
<ul>
<li><p><a class="reference internal" href="../library/datetime.html#module-datetime" title="datetime: Basic date and time types."><code class="xref py py-mod docutils literal notranslate"><span class="pre">datetime</span></code></a> モジュールに新たに <a class="reference internal" href="../library/datetime.html#datetime.timezone" title="datetime.timezone"><code class="xref py py-class docutils literal notranslate"><span class="pre">timezone</span></code></a> 型が追加されています。これは <a class="reference internal" href="../library/datetime.html#datetime.tzinfo" title="datetime.tzinfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">tzinfo</span></code></a> インターフェイスを実装し、UTC からの固定オフセットとタイムゾーン名を返します。これによりタイムゾーンを意識する (timezone-aware な) datetime オブジェクトを容易に作れます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
<span class="go">datetime.datetime(2010, 12, 8, 21, 4, 2, 923754, tzinfo=datetime.timezone.utc)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;01/01/2000 12:00 +0000&quot;</span><span class="p">,</span> <span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y %H:%M %z&quot;</span><span class="p">)</span>
<span class="go">datetime.datetime(2000, 1, 1, 12, 0, tzinfo=datetime.timezone.utc)</span>
</pre></div>
</div>
</li>
<li><p>さらに、 <a class="reference internal" href="../library/datetime.html#datetime.timedelta" title="datetime.timedelta"><code class="xref py py-class docutils literal notranslate"><span class="pre">timedelta</span></code></a> オブジェクトは今では <a class="reference internal" href="../library/functions.html#float" title="float"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a> を掛けることができ、 <a class="reference internal" href="../library/functions.html#float" title="float"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a> や <a class="reference internal" href="../library/functions.html#int" title="int"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a> で割ることができます。また、 <a class="reference internal" href="../library/datetime.html#datetime.timedelta" title="datetime.timedelta"><code class="xref py py-class docutils literal notranslate"><span class="pre">timedelta</span></code></a> オブジェクトは別の <a class="reference internal" href="../library/datetime.html#datetime.timedelta" title="datetime.timedelta"><code class="xref py py-class docutils literal notranslate"><span class="pre">timedelta</span></code></a> で割ることが出来ます。</p></li>
<li><p><a class="reference internal" href="../library/datetime.html#datetime.date.strftime" title="datetime.date.strftime"><code class="xref py py-meth docutils literal notranslate"><span class="pre">datetime.date.strftime()</span></code></a> メソッドにはもう 1900 年以降という制限はありません。新しくサポートされる年の範囲は 1000 以上 9999 以下です。</p></li>
<li><p>Whenever a two-digit year is used in a time tuple, the interpretation has been
governed by <code class="xref py py-data docutils literal notranslate"><span class="pre">time.accept2dyear</span></code>.  The default is <code class="docutils literal notranslate"><span class="pre">True</span></code> which means that
for a two-digit year, the century is guessed according to the POSIX rules
governing the <code class="docutils literal notranslate"><span class="pre">%y</span></code> strptime format.</p>
<p>Starting with Py3.2, use of the century guessing heuristic will emit a
<a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>.  Instead, it is recommended that
<code class="xref py py-data docutils literal notranslate"><span class="pre">time.accept2dyear</span></code> be set to <code class="docutils literal notranslate"><span class="pre">False</span></code> so that large date ranges
can be used without guesswork:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">warnings</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">warnings</span><span class="o">.</span><span class="n">resetwarnings</span><span class="p">()</span>      <span class="c1"># remove the default warning filters</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span><span class="o">.</span><span class="n">accept2dyear</span> <span class="o">=</span> <span class="kc">True</span>      <span class="c1"># guess whether 11 means 11 or 2011</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span><span class="o">.</span><span class="n">asctime</span><span class="p">((</span><span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="go">Warning (from warnings module):</span>
<span class="go">  ...</span>
<span class="go">DeprecationWarning: Century info guessed for a 2-digit year.</span>
<span class="go">&#39;Fri Jan  1 12:34:56 2011&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span><span class="o">.</span><span class="n">accept2dyear</span> <span class="o">=</span> <span class="kc">False</span>     <span class="c1"># use the full range of allowable dates</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span><span class="o">.</span><span class="n">asctime</span><span class="p">((</span><span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="go">&#39;Fri Jan  1 12:34:56 11&#39;</span>
</pre></div>
</div>
<p>Several functions now have significantly expanded date ranges.  When
<code class="xref py py-data docutils literal notranslate"><span class="pre">time.accept2dyear</span></code> is false, the <a class="reference internal" href="../library/time.html#time.asctime" title="time.asctime"><code class="xref py py-func docutils literal notranslate"><span class="pre">time.asctime()</span></code></a> function will
accept any year that fits in a C int, while the <a class="reference internal" href="../library/time.html#time.mktime" title="time.mktime"><code class="xref py py-func docutils literal notranslate"><span class="pre">time.mktime()</span></code></a> and
<a class="reference internal" href="../library/time.html#time.strftime" title="time.strftime"><code class="xref py py-func docutils literal notranslate"><span class="pre">time.strftime()</span></code></a> functions will accept the full range supported by the
corresponding operating system functions.</p>
</li>
</ul>
<p>(Contributed by Alexander Belopolsky and Victor Stinner in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1289118">bpo-1289118</a>,
<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5094">bpo-5094</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=6641">bpo-6641</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=2706">bpo-2706</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1777412">bpo-1777412</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8013">bpo-8013</a>,
and <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10827">bpo-10827</a>.)</p>
</section>
<section id="math">
<h3>math<a class="headerlink" href="#math" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/math.html#module-math" title="math: Mathematical functions (sin() etc.)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">math</span></code></a> モジュールがアップデートされ、C99 標準に触発されて6つの新たな関数が追加されました。</p>
<p><a class="reference internal" href="../library/math.html#math.isfinite" title="math.isfinite"><code class="xref py py-func docutils literal notranslate"><span class="pre">isfinite()</span></code></a> 関数は特殊値を確実に、かつ高速に検出する方法を提供します。通常の数には <code class="docutils literal notranslate"><span class="pre">True</span></code> を、<em>Nan</em> や <em>Infinity</em> には <code class="docutils literal notranslate"><span class="pre">False</span></code> を返します:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">isfinite</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="mf">4.56</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;Nan&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;Inf&#39;</span><span class="p">))]</span>
<span class="go">[True, True, False, False]</span>
</pre></div>
</div>
<p><a class="reference internal" href="../library/math.html#math.expm1" title="math.expm1"><code class="xref py py-func docutils literal notranslate"><span class="pre">expm1()</span></code></a> 関数は小さな <em>x</em> に対しても精度を失うこと (訳注: 桁落ち) なく <code class="docutils literal notranslate"><span class="pre">e**x-1</span></code> を計算します。
通常、桁落ちは非常に近い数の引き算で起こります。</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">expm1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expm1</span><span class="p">(</span><span class="mf">0.013671875</span><span class="p">)</span>   <span class="c1"># more accurate way to compute e**x-1 for a small x</span>
<span class="go">0.013765762467652909</span>
</pre></div>
</div>
<p><a class="reference internal" href="../library/math.html#math.erf" title="math.erf"><code class="xref py py-func docutils literal notranslate"><span class="pre">erf()</span></code></a> 関数は確率積分、すなわち <a class="reference external" href="https://ja.wikipedia.org/wiki/%E8%AA%A4%E5%B7%AE%E9%96%A2%E6%95%B0">誤差関数</a> を返します。 相補誤差関数 <a class="reference internal" href="../library/math.html#math.erfc" title="math.erfc"><code class="xref py py-func docutils literal notranslate"><span class="pre">erfc()</span></code></a> は <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">-</span> <span class="pre">erf(x)</span></code> です:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">erf</span><span class="p">,</span> <span class="n">erfc</span><span class="p">,</span> <span class="n">sqrt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">erf</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span>   <span class="c1"># portion of normal distribution within 1 standard deviation</span>
<span class="go">0.682689492137086</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">erfc</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span>  <span class="c1"># portion of normal distribution outside 1 standard deviation</span>
<span class="go">0.31731050786291404</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">erf</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span> <span class="o">+</span> <span class="n">erfc</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span>
<span class="go">1.0</span>
</pre></div>
</div>
<p><a class="reference internal" href="../library/math.html#math.gamma" title="math.gamma"><code class="xref py py-func docutils literal notranslate"><span class="pre">gamma()</span></code></a> 関数は階乗を連続的に拡張したものです。詳細は <a class="reference external" href="https://ja.wikipedia.org/wiki/%E3%82%AC%E3%83%B3%E3%83%9E%E9%96%A2%E6%95%B0">ガンマ関数</a>  を参照してください。ガンマ関数は階乗に関係しているため、小さな  <em>x</em> でも大きくなります。そのため、ガンマ関数の自然対数を計算する <a class="reference internal" href="../library/math.html#math.lgamma" title="math.lgamma"><code class="xref py py-func docutils literal notranslate"><span class="pre">lgamma()</span></code></a> 関数があります。</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">lgamma</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gamma</span><span class="p">(</span><span class="mf">7.0</span><span class="p">)</span>           <span class="c1"># six factorial</span>
<span class="go">720.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lgamma</span><span class="p">(</span><span class="mf">801.0</span><span class="p">)</span>        <span class="c1"># log(800 factorial)</span>
<span class="go">4551.950730698041</span>
</pre></div>
</div>
<p>(Contributed by Mark Dickinson.)</p>
</section>
<section id="abc">
<h3>abc<a class="headerlink" href="#abc" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/abc.html#module-abc" title="abc: Abstract base classes according to :pep:`3119`."><code class="xref py py-mod docutils literal notranslate"><span class="pre">abc</span></code></a> モジュールは <a class="reference internal" href="../library/abc.html#abc.abstractclassmethod" title="abc.abstractclassmethod"><code class="xref py py-func docutils literal notranslate"><span class="pre">abstractclassmethod()</span></code></a> と <a class="reference internal" href="../library/abc.html#abc.abstractstaticmethod" title="abc.abstractstaticmethod"><code class="xref py py-func docutils literal notranslate"><span class="pre">abstractstaticmethod()</span></code></a> をサポートしました。</p>
<p>これらのツールによって特定の <a class="reference internal" href="../library/functions.html#classmethod" title="classmethod"><code class="xref py py-func docutils literal notranslate"><span class="pre">classmethod()</span></code></a> や <a class="reference internal" href="../library/functions.html#staticmethod" title="staticmethod"><code class="xref py py-func docutils literal notranslate"><span class="pre">staticmethod()</span></code></a> を実装する必要のある <a class="reference internal" href="../glossary.html#term-abstract-base-class"><span class="xref std std-term">抽象基底クラス</span></a> を定義することが出来ます。</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Temperature</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractclassmethod</span>
    <span class="k">def</span> <span class="nf">from_fahrenheit</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="o">...</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractclassmethod</span>
    <span class="k">def</span> <span class="nf">from_celsius</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>(Patch submitted by Daniel Urban; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5867">bpo-5867</a>.)</p>
</section>
<section id="io">
<h3>io<a class="headerlink" href="#io" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/io.html#io.BytesIO" title="io.BytesIO"><code class="xref py py-class docutils literal notranslate"><span class="pre">io.BytesIO</span></code></a> に <a class="reference internal" href="../library/stdtypes.html#memoryview" title="memoryview"><code class="xref py py-func docutils literal notranslate"><span class="pre">memoryview()</span></code></a> と同様の機能を提供する新たなメソッド <a class="reference internal" href="../library/io.html#io.BytesIO.getbuffer" title="io.BytesIO.getbuffer"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getbuffer()</span></code></a> が追加されました。
このメソッドはコピーせずにデータの編集可能なビューを作成します。
バッファのランダムアクセスとスライス記法のサポートはインプレースな編集に適しています:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">REC_LEN</span><span class="p">,</span> <span class="n">LOC_START</span><span class="p">,</span> <span class="n">LOC_LEN</span> <span class="o">=</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">change_location</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">record_number</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">start</span> <span class="o">=</span> <span class="n">record_number</span> <span class="o">*</span> <span class="n">REC_LEN</span> <span class="o">+</span> <span class="n">LOC_START</span>
<span class="gp">... </span>    <span class="n">buffer</span><span class="p">[</span><span class="n">start</span><span class="p">:</span> <span class="n">start</span><span class="o">+</span><span class="n">LOC_LEN</span><span class="p">]</span> <span class="o">=</span> <span class="n">location</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">io</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">byte_stream</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span>
<span class="gp">... </span>    <span class="sa">b</span><span class="s1">&#39;G3805  storeroom  Main chassis    &#39;</span>
<span class="gp">... </span>    <span class="sa">b</span><span class="s1">&#39;X7899  shipping   Reserve cog     &#39;</span>
<span class="gp">... </span>    <span class="sa">b</span><span class="s1">&#39;L6988  receiving  Primary sprocket&#39;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">buffer</span> <span class="o">=</span> <span class="n">byte_stream</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">change_location</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;warehouse  &#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">change_location</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;showroom   &#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">byte_stream</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
<span class="go">b&#39;G3805  showroom   Main chassis    &#39;</span>
<span class="go">b&#39;X7899  warehouse  Reserve cog     &#39;</span>
<span class="go">b&#39;L6988  receiving  Primary sprocket&#39;</span>
</pre></div>
</div>
<p>(Contributed by Antoine Pitrou in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5506">bpo-5506</a>.)</p>
</section>
<section id="reprlib">
<h3>reprlib<a class="headerlink" href="#reprlib" title="Link to this heading">¶</a></h3>
<p>When writing a <a class="reference internal" href="../reference/datamodel.html#object.__repr__" title="object.__repr__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__repr__()</span></code></a> method for a custom container, it is easy to
forget to handle the case where a member refers back to the container itself.
Python's builtin objects such as <a class="reference internal" href="../library/stdtypes.html#list" title="list"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> and <a class="reference internal" href="../library/stdtypes.html#set" title="set"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> handle
self-reference by displaying &quot;...&quot; in the recursive part of the representation
string.</p>
<p>To help write such <a class="reference internal" href="../reference/datamodel.html#object.__repr__" title="object.__repr__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__repr__()</span></code></a> methods, the <a class="reference internal" href="../library/reprlib.html#module-reprlib" title="reprlib: Alternate repr() implementation with size limits."><code class="xref py py-mod docutils literal notranslate"><span class="pre">reprlib</span></code></a> module has a new
decorator, <a class="reference internal" href="../library/reprlib.html#reprlib.recursive_repr" title="reprlib.recursive_repr"><code class="xref py py-func docutils literal notranslate"><span class="pre">recursive_repr()</span></code></a>, for detecting recursive calls to
<code class="xref py py-meth docutils literal notranslate"><span class="pre">__repr__()</span></code> and substituting a placeholder string instead:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyList</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nd">@recursive_repr</span><span class="p">()</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">MyList</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="go">&lt;&#39;a&#39;|&#39;b&#39;|&#39;c&#39;|...|&#39;x&#39;&gt;</span>
</pre></div>
</div>
<p>(Contributed by Raymond Hettinger in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9826">bpo-9826</a> and <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9840">bpo-9840</a>.)</p>
</section>
<section id="logging">
<h3>logging<a class="headerlink" href="#logging" title="Link to this heading">¶</a></h3>
<p>上記の辞書ベースの設定に加え、<a class="reference internal" href="../library/logging.html#module-logging" title="logging: Flexible event logging system for applications."><code class="xref py py-mod docutils literal notranslate"><span class="pre">logging</span></code></a> パッケージには他にも多くの改良があります。</p>
<p>ロギングのドキュメントは <a class="reference internal" href="../howto/logging.html#logging-basic-tutorial"><span class="std std-ref">基本チュートリアル</span></a>  、 <a class="reference internal" href="../howto/logging.html#logging-advanced-tutorial"><span class="std std-ref">上級チュートリアル</span></a>  、 <a class="reference internal" href="../howto/logging-cookbook.html#logging-cookbook"><span class="std std-ref">クックブック</span></a> により増強されてきました。ロギングについて学習するにはこれらのドキュメントが最速の方法です。</p>
<p>セットアップ関数 <a class="reference internal" href="../library/logging.html#logging.basicConfig" title="logging.basicConfig"><code class="xref py py-func docutils literal notranslate"><span class="pre">logging.basicConfig()</span></code></a> に <em>style</em> 引数が追加され、これにより異なる 3 つのタイプの文字列書式化がサポートされます。デフォルトは伝統的な % 書式化を使う &quot;%&quot; で、 <a class="reference internal" href="../library/stdtypes.html#str.format" title="str.format"><code class="xref py py-meth docutils literal notranslate"><span class="pre">str.format()</span></code></a> スタイルの &quot;{&quot; 、 <a class="reference internal" href="../library/string.html#string.Template" title="string.Template"><code class="xref py py-class docutils literal notranslate"><span class="pre">string.Template</span></code></a> で提供されるシェルスタイルの &quot;$&quot; をセット出来ます。以下の 3 つの設定は等価です:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">logging</span> <span class="kn">import</span> <span class="n">basicConfig</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">basicConfig</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(name)s</span><span class="s2"> -&gt; </span><span class="si">%(levelname)s</span><span class="s2">: </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">basicConfig</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;{&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{name}</span><span class="s2"> -&gt; </span><span class="si">{levelname}</span><span class="s2"> </span><span class="si">{message}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">basicConfig</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;$name -&gt; $levelname: $message&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If no configuration is set-up before a logging event occurs, there is now a
default configuration using a <a class="reference internal" href="../library/logging.handlers.html#logging.StreamHandler" title="logging.StreamHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">StreamHandler</span></code></a> directed to
<a class="reference internal" href="../library/sys.html#sys.stderr" title="sys.stderr"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.stderr</span></code></a> for events of <code class="docutils literal notranslate"><span class="pre">WARNING</span></code> level or higher.  Formerly, an
event occurring before a configuration was set-up would either raise an
exception or silently drop the event depending on the value of
<a class="reference internal" href="../library/logging.html#logging.raiseExceptions" title="logging.raiseExceptions"><code class="xref py py-data docutils literal notranslate"><span class="pre">logging.raiseExceptions</span></code></a>.  The new default handler is stored in
<a class="reference internal" href="../library/logging.html#logging.lastResort" title="logging.lastResort"><code class="xref py py-data docutils literal notranslate"><span class="pre">logging.lastResort</span></code></a>.</p>
<p>フィルタの利用は単純になりました。 <a class="reference internal" href="../library/logging.html#logging.Filter" title="logging.Filter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Filter</span></code></a> オブジェクトを作る代わりに、 <code class="docutils literal notranslate"><span class="pre">True</span></code> か <code class="docutils literal notranslate"><span class="pre">False</span></code> を返す任意の Python 呼び出し可能オブジェクトを述語 (predicate) として利用出来ます。</p>
<p>ほかにも柔軟性を高め、設定を単純化する数多くの改善がありました。Python 3.2 での全ての変更についてはモジュールのドキュメントを参照してください。</p>
</section>
<section id="csv">
<h3>csv<a class="headerlink" href="#csv" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/csv.html#module-csv" title="csv: Write and read tabular data to and from delimited files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">csv</span></code></a> モジュールは新たな方言 <a class="reference internal" href="../library/csv.html#csv.unix_dialect" title="csv.unix_dialect"><code class="xref py py-class docutils literal notranslate"><span class="pre">unix_dialect</span></code></a> をサポートしました。
この方言は全フィールドをクォートし、行末を伝統的な Unix 形式の <code class="docutils literal notranslate"><span class="pre">'\n'</span></code> にします。
登録された方言名は <code class="docutils literal notranslate"><span class="pre">unix</span></code> です。</p>
<p><a class="reference internal" href="../library/csv.html#csv.DictWriter" title="csv.DictWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">csv.DictWriter</span></code></a> に新たなメソッド <a class="reference internal" href="../library/csv.html#csv.DictWriter.writeheader" title="csv.DictWriter.writeheader"><code class="xref py py-meth docutils literal notranslate"><span class="pre">writeheader()</span></code></a> が追加されました。
最初の列をドキュメントのフィールド名に書き出すのに使用します:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">csv</span><span class="o">,</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;dept&#39;</span><span class="p">],</span> <span class="n">dialect</span><span class="o">=</span><span class="s1">&#39;unix&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
<span class="go">&quot;name&quot;,&quot;dept&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span><span class="o">.</span><span class="n">writerows</span><span class="p">([</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;tom&#39;</span><span class="p">,</span> <span class="s1">&#39;dept&#39;</span><span class="p">:</span> <span class="s1">&#39;accounting&#39;</span><span class="p">},</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;susan&#39;</span><span class="p">,</span> <span class="s1">&#39;dept&#39;</span><span class="p">:</span> <span class="s1">&#39;Salesl&#39;</span><span class="p">}])</span>
<span class="go">&quot;tom&quot;,&quot;accounting&quot;</span>
<span class="go">&quot;susan&quot;,&quot;sales&quot;</span>
</pre></div>
</div>
<p>(New dialect suggested by Jay Talbot in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5975">bpo-5975</a>, and the new method
suggested by Ed Abraham in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1537721">bpo-1537721</a>.)</p>
</section>
<section id="contextlib">
<h3>contextlib<a class="headerlink" href="#contextlib" title="Link to this heading">¶</a></h3>
<p>新しく追加され、そして少しばかりハートを揺さぶるツール <a class="reference internal" href="../library/contextlib.html#contextlib.ContextDecorator" title="contextlib.ContextDecorator"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContextDecorator</span></code></a> は、関数デコレータとしての任務も果たす <a class="reference internal" href="../glossary.html#term-context-manager"><span class="xref std std-term">context manager</span></a> を作るのに役立つものです。</p>
<p>利便性のためにこの新機能は <a class="reference internal" href="../library/contextlib.html#contextlib.contextmanager" title="contextlib.contextmanager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contextmanager()</span></code></a> で使われているので、両方の役割をサポートするのにことさら労力は要しません。</p>
<p>基本的なアイディアは、コンテキストマネージャも関数デコレータも、ともに事前アクション・事後アクションラッパーとして使うことが出来るというものです。コンテキストマネージャは <a class="reference internal" href="../reference/compound_stmts.html#with"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">with</span></code></a> 文を使ったステートメント (文) のグループを包みますし、関数デコレータは関数に取り囲まれたステートメントのグループを包みます。そうです、どちらかの役割で使える事前アクションあるいは事後アクションラッパーを書く必要性は、しばしば起こることです。</p>
<p>たとえば関数やステートメントのグループをロガーで包んで、開始時刻と終了時刻を追跡できるようにするとしばしば便利です。このタスクをこなすために関数デコレータとコンテキストマネージャの両方を書く代わりに、 <a class="reference internal" href="../library/contextlib.html#contextlib.contextmanager" title="contextlib.contextmanager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contextmanager()</span></code></a> が単一の定義に両方の能力をもたらしてくれます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">track_entry_and_exit</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Entering: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">yield</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Exiting: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>ContextDecorator が使われる前の 3.1 までの <a class="reference internal" href="../library/contextlib.html#contextlib.contextmanager" title="contextlib.contextmanager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contextmanager()</span></code></a> では、これはコンテキストマネージャとして使えるだけでした:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">track_entry_and_exit</span><span class="p">(</span><span class="s1">&#39;widget loader&#39;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Some time consuming activity goes here&#39;</span><span class="p">)</span>
    <span class="n">load_widget</span><span class="p">()</span>
</pre></div>
</div>
<p>今ではこれはデコレータとしても使えます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@track_entry_and_exit</span><span class="p">(</span><span class="s1">&#39;widget loader&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">activity</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Some time consuming activity goes here&#39;</span><span class="p">)</span>
    <span class="n">load_widget</span><span class="p">()</span>
</pre></div>
</div>
<p>一つの場所に二重の責務を持たせることには普通ある種の制約を持ち込みます。コンテキストマネージャには普通は <a class="reference internal" href="../reference/compound_stmts.html#with"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">with</span></code></a> 文で使える値を返せる柔軟性を持ちますが、関数デコレータにはそれに匹敵するものはありません。</p>
<p>上の例の場合は、<em>track_entry_and_exit</em> コンテキストマネージャが、取り囲まれたステートメント本体で使えるロギングのインスタンスを返す綺麗な方法はありません。</p>
<p>(Contributed by Michael Foord in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9110">bpo-9110</a>.)</p>
</section>
<section id="decimal-and-fractions">
<h3>decimal と fractions<a class="headerlink" href="#decimal-and-fractions" title="Link to this heading">¶</a></h3>
<p>Mark Dickinson は、異なる数値データの型が実際の値が等しい場合は常に同じハッシュ値を持つことを保証する、エレガントで効率的なスキームを作り上げました (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8188">bpo-8188</a>):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="nb">hash</span><span class="p">(</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">==</span> <span class="nb">hash</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span> <span class="o">==</span> \
       <span class="nb">hash</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;1.5&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<p>Some of the hashing details are exposed through a new attribute,
<a class="reference internal" href="../library/sys.html#sys.hash_info" title="sys.hash_info"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.hash_info</span></code></a>, which describes the bit width of the hash value, the
prime modulus, the hash values for <em>infinity</em> and <em>nan</em>, and the multiplier
used for the imaginary part of a number:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">hash_info</span> 
<span class="go">sys.hash_info(width=64, modulus=2305843009213693951, inf=314159, nan=0, imag=1000003)</span>
</pre></div>
</div>
<p>An early decision to limit the interoperability of various numeric types has
been relaxed.  It is still unsupported (and ill-advised) to have implicit
mixing in arithmetic expressions such as <code class="docutils literal notranslate"><span class="pre">Decimal('1.1')</span> <span class="pre">+</span> <span class="pre">float('1.1')</span></code>
because the latter loses information in the process of constructing the binary
float.  However, since existing floating point value can be converted losslessly
to either a decimal or rational representation, it makes sense to add them to
the constructor and to support mixed-type comparisons.</p>
<ul class="simple">
<li><p><a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><code class="xref py py-class docutils literal notranslate"><span class="pre">decimal.Decimal</span></code></a> コンストラクタに <a class="reference internal" href="../library/functions.html#float" title="float"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a> オブジェクトを直接渡せるようになりました。これにより <a class="reference internal" href="../library/decimal.html#decimal.Decimal.from_float" title="decimal.Decimal.from_float"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_float()</span></code></a> メソッドを使う必要はなくなりました (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8257">bpo-8257</a>)。</p></li>
<li><p>型違いの比較はいまでは完全にサポートされたので、 <a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><code class="xref py py-class docutils literal notranslate"><span class="pre">Decimal</span></code></a> オブジェクトを直接 <a class="reference internal" href="../library/functions.html#float" title="float"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a> や <a class="reference internal" href="../library/fractions.html#fractions.Fraction" title="fractions.Fraction"><code class="xref py py-class docutils literal notranslate"><span class="pre">fractions.Fraction</span></code></a> と比較出来ます (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=2531">bpo-2531</a> and <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8188">bpo-8188</a>)。</p></li>
</ul>
<p>同じ変更が <a class="reference internal" href="../library/fractions.html#fractions.Fraction" title="fractions.Fraction"><code class="xref py py-class docutils literal notranslate"><span class="pre">fractions.Fraction</span></code></a> にもなされたので、 <a class="reference internal" href="../library/fractions.html#fractions.Fraction.from_float" title="fractions.Fraction.from_float"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_float()</span></code></a> も <a class="reference internal" href="../library/fractions.html#fractions.Fraction.from_decimal" title="fractions.Fraction.from_decimal"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_decimal()</span></code></a> も、もはや必要ありません (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8294">bpo-8294</a>):</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">fractions</span> <span class="kn">import</span> <span class="n">Fraction</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="mf">1.1</span><span class="p">)</span>
<span class="go">Decimal(&#39;1.100000000000000088817841970012523233890533447265625&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Fraction</span><span class="p">(</span><span class="mf">1.1</span><span class="p">)</span>
<span class="go">Fraction(2476979795053773, 2251799813685248)</span>
</pre></div>
</div>
<p>Another useful change for the <a class="reference internal" href="../library/decimal.html#module-decimal" title="decimal: Implementation of the General Decimal Arithmetic  Specification."><code class="xref py py-mod docutils literal notranslate"><span class="pre">decimal</span></code></a> module is that the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">Context.clamp</span></code> attribute is now public.  This is useful in creating
contexts that correspond to the decimal interchange formats specified in IEEE
754 (see <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8540">bpo-8540</a>).</p>
<p>(Contributed by Mark Dickinson and Raymond Hettinger.)</p>
</section>
<section id="ftp">
<h3>ftp<a class="headerlink" href="#ftp" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/ftplib.html#ftplib.FTP" title="ftplib.FTP"><code class="xref py py-class docutils literal notranslate"><span class="pre">ftplib.FTP</span></code></a> クラスがコンテキスト管理プロトコルをサポートするようになりました。with ブロックを抜ける際に無条件に FTP 接続をクローズします (クローズ処理で発生する <a class="reference internal" href="../library/socket.html#socket.error" title="socket.error"><code class="xref py py-exc docutils literal notranslate"><span class="pre">socket.error</span></code></a> は無視されます)。:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ftplib</span> <span class="kn">import</span> <span class="n">FTP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">FTP</span><span class="p">(</span><span class="s2">&quot;ftp1.at.proftpd.org&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ftp</span><span class="p">:</span>
<span class="go">        ftp.login()</span>
<span class="go">        ftp.dir()</span>

<span class="go">&#39;230 Anonymous login ok, restrictions apply.&#39;</span>
<span class="go">dr-xr-xr-x   9 ftp      ftp           154 May  6 10:43 .</span>
<span class="go">dr-xr-xr-x   9 ftp      ftp           154 May  6 10:43 ..</span>
<span class="go">dr-xr-xr-x   5 ftp      ftp          4096 May  6 10:43 CentOS</span>
<span class="go">dr-xr-xr-x   3 ftp      ftp            18 Jul 10  2008 Fedora</span>
</pre></div>
</div>
<p>ちなみに <a class="reference internal" href="../library/mmap.html#mmap.mmap" title="mmap.mmap"><code class="xref py py-class docutils literal notranslate"><span class="pre">mmap.mmap</span></code></a> や <a class="reference internal" href="../library/fileinput.html#fileinput.input" title="fileinput.input"><code class="xref py py-func docutils literal notranslate"><span class="pre">fileinput.input()</span></code></a>  のようなほかのファイルライクなオブジェクトも自動クローズするコンテキスト管理プロトコルをサポートするようになっていたりします:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">files</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;log1.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;log2.txt&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">process</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p>(Contributed by Tarek Ziadé and Giampaolo Rodolà in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=4972">bpo-4972</a>, and
by Georg Brandl in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8046">bpo-8046</a> and <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1286">bpo-1286</a>.)</p>
<p><a class="reference internal" href="../library/ftplib.html#ftplib.FTP_TLS" title="ftplib.FTP_TLS"><code class="xref py py-class docutils literal notranslate"><span class="pre">FTP_TLS</span></code></a> クラスが <em>context</em> パラメータを受け取れるようになりました。これには <a class="reference internal" href="../library/ssl.html#ssl.SSLContext" title="ssl.SSLContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ssl.SSLContext</span></code></a> オブジェクトを渡します。これは SSL コンフィグレーションオプション、証明書、秘密鍵を単一の (たぶん長生きの) 構造にまとめあげてくれるものです。</p>
<p>(Contributed by Giampaolo Rodolà; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8806">bpo-8806</a>.)</p>
</section>
<section id="popen">
<h3>popen<a class="headerlink" href="#popen" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/os.html#os.popen" title="os.popen"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.popen()</span></code></a> ならびに <a class="reference internal" href="../library/subprocess.html#subprocess.Popen" title="subprocess.Popen"><code class="xref py py-func docutils literal notranslate"><span class="pre">subprocess.Popen()</span></code></a> 関数が自動的にファイル記述子を閉じる <a class="reference internal" href="../reference/compound_stmts.html#with"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">with</span></code></a> 文をサポートしました。</p>
<p>(Contributed by Antoine Pitrou and Brian Curtin in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7461">bpo-7461</a> and
<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10554">bpo-10554</a>.)</p>
</section>
<section id="select">
<h3>select<a class="headerlink" href="#select" title="Link to this heading">¶</a></h3>
<p>The <a class="reference internal" href="../library/select.html#module-select" title="select: Wait for I/O completion on multiple streams."><code class="xref py py-mod docutils literal notranslate"><span class="pre">select</span></code></a> module now exposes a new, constant attribute,
<a class="reference internal" href="../library/select.html#select.PIPE_BUF" title="select.PIPE_BUF"><code class="xref py py-const docutils literal notranslate"><span class="pre">PIPE_BUF</span></code></a>, which gives the minimum number of bytes which are
guaranteed not to block when <a class="reference internal" href="../library/select.html#select.select" title="select.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select.select()</span></code></a> says a pipe is ready
for writing.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">select</span><span class="o">.</span><span class="n">PIPE_BUF</span>  
<span class="go">512</span>
</pre></div>
</div>
<p>(Available on Unix systems. Patch by Sébastien Sablé in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9862">bpo-9862</a>)</p>
</section>
<section id="gzip-and-zipfile">
<h3>gzip と zipfile<a class="headerlink" href="#gzip-and-zipfile" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/gzip.html#gzip.GzipFile" title="gzip.GzipFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">gzip.GzipFile</span></code></a> が <a class="reference internal" href="../library/io.html#io.BufferedIOBase" title="io.BufferedIOBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">io.BufferedIOBase</span></code></a> <a class="reference internal" href="../glossary.html#term-abstract-base-class"><span class="xref std std-term">抽象基底クラス</span></a> を継承しました (<code class="docutils literal notranslate"><span class="pre">truncate()</span></code> をのぞく)。
<a class="reference internal" href="../library/gzip.html#gzip.GzipFile.peek" title="gzip.GzipFile.peek"><code class="xref py py-meth docutils literal notranslate"><span class="pre">peek()</span></code></a> メソッドが追加され、シーク不能なファイルオブジェクトならびにゼロ埋めされたファイルオブジェクトをサポートしました。</p>
<p>また、<a class="reference internal" href="../library/gzip.html#module-gzip" title="gzip: Interfaces for gzip compression and decompression using file objects."><code class="xref py py-mod docutils literal notranslate"><span class="pre">gzip</span></code></a> モジュールにより簡便でインメモリな圧縮および解凍を行う  <a class="reference internal" href="../library/gzip.html#gzip.compress" title="gzip.compress"><code class="xref py py-func docutils literal notranslate"><span class="pre">compress()</span></code></a> ならびに <a class="reference internal" href="../library/gzip.html#gzip.decompress" title="gzip.decompress"><code class="xref py py-func docutils literal notranslate"><span class="pre">decompress()</span></code></a> 関数が追加されました。
圧縮や解凍の前に <a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> としてエンコードしなければならない点に注意してください:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">gzip</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;Three shall be the number thou shalt count, &#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;and the number of the counting shall be three&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>                        <span class="c1"># convert to utf-8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">89</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">77</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gzip</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()[:</span><span class="mi">42</span><span class="p">]</span>      <span class="c1"># decompress and convert to text</span>
<span class="go">&#39;Three shall be the number thou shalt count&#39;</span>
</pre></div>
</div>
<p>(Contributed by Anand B. Pillai in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=3488">bpo-3488</a>; and by Antoine Pitrou, Nir
Aides and Brian Curtin in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9962">bpo-9962</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1675951">bpo-1675951</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7471">bpo-7471</a> and
<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=2846">bpo-2846</a>.)</p>
<p>Also, the <a class="reference internal" href="../library/zipfile.html#zipfile.ZipFile.open" title="zipfile.ZipFile.open"><code class="xref py py-class docutils literal notranslate"><span class="pre">zipfile.ZipExtFile</span></code></a> class was reworked internally to represent
files stored inside an archive.  The new implementation is significantly faster
and can be wrapped in an <a class="reference internal" href="../library/io.html#io.BufferedReader" title="io.BufferedReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">io.BufferedReader</span></code></a> object for more speedups.  It
also solves an issue where interleaved calls to <em>read</em> and <em>readline</em> gave the
wrong results.</p>
<p>(Patch submitted by Nir Aides in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7610">bpo-7610</a>.)</p>
</section>
<section id="tarfile">
<h3>tarfile<a class="headerlink" href="#tarfile" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/tarfile.html#tarfile.TarFile" title="tarfile.TarFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">TarFile</span></code></a> クラスは今ではコンテキストマネージャとして使えます。加えて、その <a class="reference internal" href="../library/tarfile.html#tarfile.TarFile.add" title="tarfile.TarFile.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code></a> メソッドに新しいオプション <em>filter</em> が追加されました。これはファイルをアーカイブに追加するかどうかを制御し、また、ファイルのメタデータを編集するのにも使えます。</p>
<p><em>filter</em> オプションは古くて柔軟性に欠ける <em>exclude</em> パラメータを置き換えるものであり、 <em>exclude</em> は非推奨となりました。 <em>filter</em> を指定する場合は <a class="reference internal" href="../glossary.html#term-keyword-argument"><span class="xref std std-term">keyword argument</span></a> として渡さなければなりません。ユーザ指定の filter 関数は <a class="reference internal" href="../library/tarfile.html#tarfile.TarInfo" title="tarfile.TarInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">TarInfo</span></code></a> オブジェクトを受け取り、更新した <a class="reference internal" href="../library/tarfile.html#tarfile.TarInfo" title="tarfile.TarInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">TarInfo</span></code></a> オブジェクトを返すか、あるいはアーカイブから除外したければ <code class="docutils literal notranslate"><span class="pre">None</span></code> を返してください。</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tarfile</span><span class="o">,</span> <span class="nn">glob</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">myfilter</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">tarinfo</span><span class="o">.</span><span class="n">isfile</span><span class="p">():</span>             <span class="c1"># only save real files</span>
<span class="gp">... </span>        <span class="n">tarinfo</span><span class="o">.</span><span class="n">uname</span> <span class="o">=</span> <span class="s1">&#39;monty&#39;</span>      <span class="c1"># redact the user name</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">tarinfo</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;myarchive.tar.gz&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w:gz&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*.txt&#39;</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">tf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="n">myfilter</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">tf</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
<span class="go">-rw-r--r-- monty/501        902 2011-01-26 17:59:11 annotations.txt</span>
<span class="go">-rw-r--r-- monty/501        123 2011-01-26 17:59:11 general_questions.txt</span>
<span class="go">-rw-r--r-- monty/501       3514 2011-01-26 17:59:11 prion.txt</span>
<span class="go">-rw-r--r-- monty/501        124 2011-01-26 17:59:11 py_todo.txt</span>
<span class="go">-rw-r--r-- monty/501       1399 2011-01-26 17:59:11 semaphore_notes.txt</span>
</pre></div>
</div>
<p>(Proposed by Tarek Ziadé and implemented by Lars Gustäbel in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=6856">bpo-6856</a>.)</p>
</section>
<section id="hashlib">
<h3>hashlib<a class="headerlink" href="#hashlib" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/hashlib.html#module-hashlib" title="hashlib: Secure hash and message digest algorithms."><code class="xref py py-mod docutils literal notranslate"><span class="pre">hashlib</span></code></a> モジュールに、2 つの定数属性が追加されました。全ての実装で利用可能であることが保障されているハッシュアルゴリズムのリストと、現在の実装で利用可能なそれらリストの 2 つです:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">hashlib</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">hashlib</span><span class="o">.</span><span class="n">algorithms_guaranteed</span>
<span class="go">{&#39;sha1&#39;, &#39;sha224&#39;, &#39;sha384&#39;, &#39;sha256&#39;, &#39;sha512&#39;, &#39;md5&#39;}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">hashlib</span><span class="o">.</span><span class="n">algorithms_available</span>
<span class="go">{&#39;md2&#39;, &#39;SHA256&#39;, &#39;SHA512&#39;, &#39;dsaWithSHA&#39;, &#39;mdc2&#39;, &#39;SHA224&#39;, &#39;MD4&#39;, &#39;sha256&#39;,</span>
<span class="go">&#39;sha512&#39;, &#39;ripemd160&#39;, &#39;SHA1&#39;, &#39;MDC2&#39;, &#39;SHA&#39;, &#39;SHA384&#39;, &#39;MD2&#39;,</span>
<span class="go">&#39;ecdsa-with-SHA1&#39;,&#39;md4&#39;, &#39;md5&#39;, &#39;sha1&#39;, &#39;DSA-SHA&#39;, &#39;sha224&#39;,</span>
<span class="go">&#39;dsaEncryption&#39;, &#39;DSA&#39;, &#39;RIPEMD160&#39;, &#39;sha&#39;, &#39;MD5&#39;, &#39;sha384&#39;}</span>
</pre></div>
</div>
<p>(Suggested by Carl Chenet in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7418">bpo-7418</a>.)</p>
</section>
<section id="ast">
<h3>ast<a class="headerlink" href="#ast" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/ast.html#module-ast" title="ast: Abstract Syntax Tree classes and manipulation."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ast</span></code></a> モジュールには、Python リテラル構文を使った式文字列を安全に評価できる、汎用目的の素晴らしい道具が含まれています。その <a class="reference internal" href="../library/ast.html#ast.literal_eval" title="ast.literal_eval"><code class="xref py py-func docutils literal notranslate"><span class="pre">ast.literal_eval()</span></code></a> 関数は、悪用されやすい組み込み関数 <a class="reference internal" href="../library/functions.html#eval" title="eval"><code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code></a> の安全な代替品として働いてくれます。Python 3.2 はこれのサポート型に <a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> と <a class="reference internal" href="../library/stdtypes.html#set" title="set"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> を加えました。結果サポートする型は全部でこれらになりました: 文字列型、バイト列文字列型、数値型、タプル型、リスト型、辞書型、集合型、真偽値型、<code class="docutils literal notranslate"><span class="pre">None</span></code>。</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ast</span> <span class="kn">import</span> <span class="n">literal_eval</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">request</span> <span class="o">=</span> <span class="s2">&quot;{&#39;req&#39;: 3, &#39;func&#39;: &#39;pow&#39;, &#39;args&#39;: (2, 0.5)}&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">literal_eval</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="go">{&#39;args&#39;: (2, 0.5), &#39;req&#39;: 3, &#39;func&#39;: &#39;pow&#39;}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">request</span> <span class="o">=</span> <span class="s2">&quot;os.system(&#39;do something harmful&#39;)&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">literal_eval</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">  </span><span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">malformed node or string: &lt;_ast.Call object at 0x101739a10&gt;</span>
</pre></div>
</div>
<p>(Implemented by Benjamin Peterson and Georg Brandl.)</p>
</section>
<section id="os">
<h3>os<a class="headerlink" href="#os" title="Link to this heading">¶</a></h3>
<p>ファイル名と環境変数に使われるエンコーディングは OS ごとに様々です。 <a class="reference internal" href="../library/os.html#module-os" title="os: Miscellaneous operating system interfaces."><code class="xref py py-mod docutils literal notranslate"><span class="pre">os</span></code></a> モジュールは新たに 2 つの関数 <a class="reference internal" href="../library/os.html#os.fsencode" title="os.fsencode"><code class="xref py py-func docutils literal notranslate"><span class="pre">fsencode()</span></code></a> と <a class="reference internal" href="../library/os.html#os.fsdecode" title="os.fsdecode"><code class="xref py py-func docutils literal notranslate"><span class="pre">fsdecode()</span></code></a> を追加しました。それぞれファイル名のエンコード、デコードを行います:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;Sehenswürdigkeiten&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">fsencode</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="go">b&#39;Sehensw\xc3\xbcrdigkeiten&#39;</span>
</pre></div>
</div>
<p>Some operating systems allow direct access to encoded bytes in the
environment.  If so, the <a class="reference internal" href="../library/os.html#os.supports_bytes_environ" title="os.supports_bytes_environ"><code class="xref py py-const docutils literal notranslate"><span class="pre">os.supports_bytes_environ</span></code></a> constant will be
true.</p>
<p>エンコードされた環境変数への直接アクセス (可能な場合) には、新規関数 <a class="reference internal" href="../library/os.html#os.getenvb" title="os.getenvb"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.getenvb()</span></code></a> または <a class="reference internal" href="../library/os.html#os.environb" title="os.environb"><code class="xref py py-data docutils literal notranslate"><span class="pre">os.environb</span></code></a> を使ってください。これは <a class="reference internal" href="../library/os.html#os.environ" title="os.environ"><code class="xref py py-data docutils literal notranslate"><span class="pre">os.environ</span></code></a> のバイト列バージョンです。</p>
<p>(Contributed by Victor Stinner.)</p>
</section>
<section id="shutil">
<h3>shutil<a class="headerlink" href="#shutil" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/shutil.html#shutil.copytree" title="shutil.copytree"><code class="xref py py-func docutils literal notranslate"><span class="pre">shutil.copytree()</span></code></a> 関数に新たに 2 つのオプションが追加されました:</p>
<ul class="simple">
<li><p><em>ignore_dangling_symlinks</em>: <code class="docutils literal notranslate"><span class="pre">symlinks=False</span></code> とするとこの関数は、ファイルがシンボリックリンクだった場合にリンクそのものではなくそれが指しているファイルをコピーします。 <em>ignore_dangling_symlinks</em> を真にすると、そのファイルが存在しない場合のエラーを無視します。</p></li>
<li><p><em>copy_function</em>: これはファイルをコピーするのに使われる呼び出し可能オブジェクトです。デフォルトでは <a class="reference internal" href="../library/shutil.html#shutil.copy2" title="shutil.copy2"><code class="xref py py-func docutils literal notranslate"><span class="pre">shutil.copy2()</span></code></a> が使われます。</p></li>
</ul>
<p>(Contributed by Tarek Ziadé.)</p>
<p>これらに加え、 <a class="reference internal" href="../library/shutil.html#module-shutil" title="shutil: High-level file operations, including copying."><code class="xref py py-mod docutils literal notranslate"><span class="pre">shutil</span></code></a> モジュールは ZIP ファイル、未圧縮の tar ファイル、gzip 圧縮の tar、 bzip 圧縮の tar のための <a class="reference internal" href="../library/shutil.html#archiving-operations"><span class="std std-ref">archiving operations</span></a> を新たにサポートします。また、追加のアーカイブファイルフォーマットを登録する関数もあります (例えば xz 圧縮の tar やカスタムフォーマット)。</p>
<p>そのメインとなるのが <a class="reference internal" href="../library/shutil.html#shutil.make_archive" title="shutil.make_archive"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_archive()</span></code></a> と <a class="reference internal" href="../library/shutil.html#shutil.unpack_archive" title="shutil.unpack_archive"><code class="xref py py-func docutils literal notranslate"><span class="pre">unpack_archive()</span></code></a> です。デフォルトではカレントディレクトリ (<a class="reference internal" href="../library/os.html#os.chdir" title="os.chdir"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.chdir()</span></code></a> で変えれます) とそのサブディレクトリの両方を処理します。アーカイブファイル名はフルパス名で指定しなければなりません(訳注: これの真偽不明。リファレンスに対応する記述なし)。アーカイブするステップは非破壊的です (つまりオリジナルのファイルは変更されずにそのままにされます)。</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">shutil</span><span class="o">,</span> <span class="nn">pprint</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;mydata&#39;</span><span class="p">)</span>  <span class="c1"># change to the source directory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span><span class="s1">&#39;/var/backup/mydata&#39;</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="s1">&#39;zip&#39;</span><span class="p">)</span>      <span class="c1"># archive the current directory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span>                                   <span class="c1"># show the name of archive</span>
<span class="go">&#39;/var/backup/mydata.zip&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;tmp&#39;</span><span class="p">)</span>                     <span class="c1"># change to an unpacking</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shutil</span><span class="o">.</span><span class="n">unpack_archive</span><span class="p">(</span><span class="s1">&#39;/var/backup/mydata.zip&#39;</span><span class="p">)</span>  <span class="c1"># recover the data</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">get_archive_formats</span><span class="p">())</span>  <span class="c1"># display known formats</span>
<span class="go">[(&#39;bztar&#39;, &quot;bzip2&#39;ed tar-file&quot;),</span>
<span class="go"> (&#39;gztar&#39;, &quot;gzip&#39;ed tar-file&quot;),</span>
<span class="go"> (&#39;tar&#39;, &#39;uncompressed tar file&#39;),</span>
<span class="go"> (&#39;zip&#39;, &#39;ZIP file&#39;)]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">shutil</span><span class="o">.</span><span class="n">register_archive_format</span><span class="p">(</span>     <span class="c1"># register a new archive format</span>
<span class="gp">... </span>    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;xz&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">function</span><span class="o">=</span><span class="n">xz</span><span class="o">.</span><span class="n">compress</span><span class="p">,</span>           <span class="c1"># callable archiving function</span>
<span class="gp">... </span>    <span class="n">extra_args</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)],</span>      <span class="c1"># arguments to the function</span>
<span class="gp">... </span>    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;xz compression&#39;</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>(Contributed by Tarek Ziadé.)</p>
</section>
<section id="sqlite3">
<h3>sqlite3<a class="headerlink" href="#sqlite3" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/sqlite3.html#module-sqlite3" title="sqlite3: A DB-API 2.0 implementation using SQLite 3.x."><code class="xref py py-mod docutils literal notranslate"><span class="pre">sqlite3</span></code></a> モジュールが pysqlite バージョン 2.6.0 に更新されました。これには 2 つの新機能があります。</p>
<ul class="simple">
<li><p>The <code class="xref py py-attr docutils literal notranslate"><span class="pre">sqlite3.Connection.in_transit</span></code> attribute is true if there is an
active transaction for uncommitted changes.</p></li>
<li><p><a class="reference internal" href="../library/sqlite3.html#sqlite3.Connection.enable_load_extension" title="sqlite3.Connection.enable_load_extension"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sqlite3.Connection.enable_load_extension()</span></code></a> メソッドと <a class="reference internal" href="../library/sqlite3.html#sqlite3.Connection.load_extension" title="sqlite3.Connection.load_extension"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sqlite3.Connection.load_extension()</span></code></a> メソッドにより &quot;.so&quot; ファイルから SQLite 拡張をロードできます。良く知られた拡張の一つとして、SQLite と一緒に配布されている全文検索拡張があります。</p></li>
</ul>
<p>(Contributed by R. David Murray and Shashwat Anand; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8845">bpo-8845</a>.)</p>
</section>
<section id="html">
<h3>html<a class="headerlink" href="#html" title="Link to this heading">¶</a></h3>
<p>ただ一つの関数 <a class="reference internal" href="../library/html.html#html.escape" title="html.escape"><code class="xref py py-func docutils literal notranslate"><span class="pre">escape()</span></code></a> が提供される、新しい <a class="reference internal" href="../library/html.html#module-html" title="html: Helpers for manipulating HTML."><code class="xref py py-mod docutils literal notranslate"><span class="pre">html</span></code></a> モジュールが導入されました。これは HTML マークアップから予約されている文字をエスケープするのに使います:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">html</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="s1">&#39;x &gt; 2 &amp;&amp; x &lt; 7&#39;</span><span class="p">)</span>
<span class="go">&#39;x &amp;gt; 2 &amp;amp;&amp;amp; x &amp;lt; 7&#39;</span>
</pre></div>
</div>
</section>
<section id="socket">
<h3>socket<a class="headerlink" href="#socket" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/socket.html#module-socket" title="socket: Low-level networking interface."><code class="xref py py-mod docutils literal notranslate"><span class="pre">socket</span></code></a> モジュールに新たに二つの改善がありました。</p>
<ul class="simple">
<li><p>ソケットオブジェクトに <a class="reference internal" href="../library/socket.html#socket.socket.detach" title="socket.socket.detach"><code class="xref py py-meth docutils literal notranslate"><span class="pre">detach()</span></code></a> メソッドが追加されました。これは背後のファイル記述子を閉じることなくソケットをクローズ状態にします。これによりファイル記述子は他の目的に再利用出来ます。 (Added by Antoine Pitrou; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8524">bpo-8524</a>.)</p></li>
<li><p><a class="reference internal" href="../library/socket.html#socket.create_connection" title="socket.create_connection"><code class="xref py py-func docutils literal notranslate"><span class="pre">socket.create_connection()</span></code></a> がコンテキスト管理プロトコルをサポートするようになりました。with ブロックを抜ける際に無条件にソケットをクローズします (クローズ処理で発生する <a class="reference internal" href="../library/socket.html#socket.error" title="socket.error"><code class="xref py py-exc docutils literal notranslate"><span class="pre">socket.error</span></code></a> は無視されます)。 (Contributed by Giampaolo Rodolà; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9794">bpo-9794</a>.) (---訳注: リファレンスもそうなのですが、「 <a class="reference internal" href="../library/socket.html#socket.create_connection" title="socket.create_connection"><code class="xref py py-func docutils literal notranslate"><span class="pre">socket.create_connection()</span></code></a> が with をサポート」というのは実態とは違うんじゃないかと思います(この関数のユーザからは同じにみえたとしても)。実際には <a class="reference internal" href="../library/socket.html#socket.socket" title="socket.socket"><code class="xref py py-class docutils literal notranslate"><span class="pre">socket.socket</span></code></a> がコンテキストマネージャをサポートしています。 <a class="reference external" href="https://hg.python.org/cpython/file/3.2/Lib/socket.py">socket.py</a> 参照。--)</p></li>
</ul>
</section>
<section id="ssl">
<h3>ssl<a class="headerlink" href="#ssl" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/ssl.html#module-ssl" title="ssl: TLS/SSL wrapper for socket objects"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ssl</span></code></a> モジュールは、セキュアな (暗号化され、認証された) インターネット接続のために共通の要求を満足するための数多くの機能を追加しています:</p>
<ul class="simple">
<li><p>新規クラス <a class="reference internal" href="../library/ssl.html#ssl.SSLContext" title="ssl.SSLContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">SSLContext</span></code></a> は、プロトコル設定や証明書、秘密鍵やそのた色々なオプションのような、永続的 SSL データの容器として働きます。その中のメソッド <a class="reference internal" href="../library/ssl.html#ssl.SSLContext.wrap_socket" title="ssl.SSLContext.wrap_socket"><code class="xref py py-meth docutils literal notranslate"><span class="pre">wrap_socket()</span></code></a> を使うと、 SSL コンテキストから SSL ソケットを作れます。</p></li>
<li><p>A new function, <code class="xref py py-func docutils literal notranslate"><span class="pre">ssl.match_hostname()</span></code>, supports server identity
verification for higher-level protocols by implementing the rules of HTTPS
(from <span class="target" id="index-12"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2818.html"><strong>RFC 2818</strong></a>) which are also suitable for other protocols.</p></li>
<li><p>The <a class="reference internal" href="../library/ssl.html#ssl.SSLContext.wrap_socket" title="ssl.SSLContext.wrap_socket"><code class="xref py py-func docutils literal notranslate"><span class="pre">ssl.wrap_socket()</span></code></a> constructor function now takes a <em>ciphers</em>
argument.  The <em>ciphers</em> string lists the allowed encryption algorithms using
the format described in the <a class="reference external" href="https://www.openssl.org/docs/man1.0.2/man1/ciphers.html#CIPHER-LIST-FORMAT">OpenSSL documentation</a>.</p></li>
<li><p>最新版の OpenSSL にリンクしていれば、 <a class="reference internal" href="../library/ssl.html#module-ssl" title="ssl: TLS/SSL wrapper for socket objects"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ssl</span></code></a> モジュールは TLS プロトコルに対する Server Name Indication 拡張 (訳注: SNI, <span class="target" id="index-36"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc4366.html"><strong>RFC 4366</strong></a>) をサポートします。これは単一の IP ポートで異なった証明書を使った複数「バーチャルホスト」をもたらすものです。この拡張はクライアントモードでのみサポートされ、 <a class="reference internal" href="../library/ssl.html#ssl.SSLContext.wrap_socket" title="ssl.SSLContext.wrap_socket"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ssl.SSLContext.wrap_socket()</span></code></a> の <em>server_hostname</em> を渡すことで活性化されます。</p></li>
<li><p><a class="reference internal" href="../library/ssl.html#module-ssl" title="ssl: TLS/SSL wrapper for socket objects"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ssl</span></code></a> モジュールに色々オプションが追加されました。例えば <a class="reference internal" href="../library/ssl.html#ssl.OP_NO_SSLv2" title="ssl.OP_NO_SSLv2"><code class="xref py py-data docutils literal notranslate"><span class="pre">OP_NO_SSLv2</span></code></a> は安全でなく時代遅れの SSLv2 を無効にします。</p></li>
<li><p>拡張はOpenSSL の全ての暗号とメッセージダイジェストアルゴリズムをロードします。SSL 証明書の中に検証できないものがある場合、&quot;unknown algorithm&quot; エラーを報告します。</p></li>
<li><p>The version of OpenSSL being used is now accessible using the module
attributes <a class="reference internal" href="../library/ssl.html#ssl.OPENSSL_VERSION" title="ssl.OPENSSL_VERSION"><code class="xref py py-const docutils literal notranslate"><span class="pre">ssl.OPENSSL_VERSION</span></code></a> (a string),
<a class="reference internal" href="../library/ssl.html#ssl.OPENSSL_VERSION_INFO" title="ssl.OPENSSL_VERSION_INFO"><code class="xref py py-const docutils literal notranslate"><span class="pre">ssl.OPENSSL_VERSION_INFO</span></code></a> (a 5-tuple), and
<a class="reference internal" href="../library/ssl.html#ssl.OPENSSL_VERSION_NUMBER" title="ssl.OPENSSL_VERSION_NUMBER"><code class="xref py py-const docutils literal notranslate"><span class="pre">ssl.OPENSSL_VERSION_NUMBER</span></code></a> (an integer).</p></li>
</ul>
<p>(Contributed by Antoine Pitrou in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8850">bpo-8850</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1589">bpo-1589</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8322">bpo-8322</a>,
<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5639">bpo-5639</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=4870">bpo-4870</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8484">bpo-8484</a>, and <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8321">bpo-8321</a>.)</p>
</section>
<section id="nntp">
<h3>nntp<a class="headerlink" href="#nntp" title="Link to this heading">¶</a></h3>
<p>The <a class="reference internal" href="../library/nntplib.html#module-nntplib" title="nntplib: NNTP protocol client (requires sockets). (非推奨)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">nntplib</span></code></a> module has a revamped implementation with better bytes and
text semantics as well as more practical APIs.  These improvements break
compatibility with the nntplib version in Python 3.1, which was partly
dysfunctional in itself.</p>
<p>Support for secure connections through both implicit (using
<a class="reference internal" href="../library/nntplib.html#nntplib.NNTP_SSL" title="nntplib.NNTP_SSL"><code class="xref py py-class docutils literal notranslate"><span class="pre">nntplib.NNTP_SSL</span></code></a>) and explicit (using <a class="reference internal" href="../library/nntplib.html#nntplib.NNTP.starttls" title="nntplib.NNTP.starttls"><code class="xref py py-meth docutils literal notranslate"><span class="pre">nntplib.NNTP.starttls()</span></code></a>)
TLS has also been added.</p>
<p>(Contributed by Antoine Pitrou in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9360">bpo-9360</a> and Andrew Vant in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1926">bpo-1926</a>.)</p>
</section>
<section id="certificates">
<h3>certificates<a class="headerlink" href="#certificates" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/http.client.html#http.client.HTTPSConnection" title="http.client.HTTPSConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">http.client.HTTPSConnection</span></code></a>, <a class="reference internal" href="../library/urllib.request.html#urllib.request.HTTPSHandler" title="urllib.request.HTTPSHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">urllib.request.HTTPSHandler</span></code></a> <a class="reference internal" href="../library/urllib.request.html#urllib.request.urlopen" title="urllib.request.urlopen"><code class="xref py py-func docutils literal notranslate"><span class="pre">urllib.request.urlopen()</span></code></a> はサーバ証明書を証明書認証局 (Certification Authority (CA)) セットと照合するためのオプショナル引数を取るようになりました。これは HTTPS の公共利用で推奨されるものです。(---訳注: これは <em>check_hostname</em> パラメータのことを指していますが、3.4.3 でこれの扱いが変わっているのでリファレンスを注意深く読んで下さい。--)</p>
<p>(Added by Antoine Pitrou, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9003">bpo-9003</a>.)</p>
</section>
<section id="imaplib">
<h3>imaplib<a class="headerlink" href="#imaplib" title="Link to this heading">¶</a></h3>
<p>標準 IMAP4 接続での明示的な TLS 使用を新規メソッド <a class="reference internal" href="../library/imaplib.html#imaplib.IMAP4.starttls" title="imaplib.IMAP4.starttls"><code class="xref py py-mod docutils literal notranslate"><span class="pre">imaplib.IMAP4.starttls</span></code></a> で出来るようになりました。</p>
<p>(Contributed by Lorenzo M. Catucci and Antoine Pitrou, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=4471">bpo-4471</a>.)</p>
</section>
<section id="http-client">
<h3>http.client<a class="headerlink" href="#http-client" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/http.client.html#module-http.client" title="http.client: HTTP and HTTPS protocol client (requires sockets)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">http.client</span></code></a> モジュールに数多くの小さな API 改善がなされています。旧式 HTTP 0.9 の単純な応答 (HTTP 0.9 simple responses) はもうサポートされず、また、 <em>strict</em> パラメータは全てのクラスで非推奨となりました。</p>
<p><a class="reference internal" href="../library/http.client.html#http.client.HTTPConnection" title="http.client.HTTPConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPConnection</span></code></a> クラスと <a class="reference internal" href="../library/http.client.html#http.client.HTTPSConnection" title="http.client.HTTPSConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPSConnection</span></code></a> クラスが <em>source_address</em> パラメータを取るようになりました。これには HTTP(S) 接続の接続元を表す (host, port) のタプルを渡します。</p>
<p><a class="reference internal" href="../library/http.client.html#http.client.HTTPSConnection" title="http.client.HTTPSConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPSConnection</span></code></a> に、証明書検証と HTTPS バーチャルホストのサポートが追加されました。</p>
<p>接続オブジェクトの <a class="reference internal" href="../library/http.client.html#http.client.HTTPConnection.request" title="http.client.HTTPConnection.request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request()</span></code></a> メソッドのオプショナルな <em>body</em> 引数には、リクエストのコンテンツを与えるために <a class="reference internal" href="../glossary.html#term-file-object"><span class="xref std std-term">file object</span></a> を渡すことが出来ました。便利のためにこれに <a class="reference internal" href="../glossary.html#term-iterable"><span class="xref std std-term">iterable</span></a> も渡すことが出来るようになりました。ただしこの場合は明示的に <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> ヘッダを加えなければなりません。この拡張されたインターフェイスは以前よりも遥かに柔軟です。</p>
<p>プロキシサーバ経由で HTTPS 接続を確立するために、新規メソッド <a class="reference internal" href="../library/http.client.html#http.client.HTTPConnection.set_tunnel" title="http.client.HTTPConnection.set_tunnel"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_tunnel()</span></code></a> が追加されています。これにより HTTP 接続トンネリングのためのホストとポートをセットします。</p>
<p><a class="reference internal" href="../library/http.server.html#module-http.server" title="http.server: HTTP server and request handlers."><code class="xref py py-mod docutils literal notranslate"><span class="pre">http.server</span></code></a> の振る舞いと合わせ、HTTP クライアントライブラリもヘッダを ISO-8859-1 (Latin-1) エンコーディングでエンコードするようになりました。これは既に incoming (外から来る方) ヘッダに対して行われていますが、今ではこの振る舞いは incoming、outgoing (外へ向かう方) トラフィックの両方で一貫しています (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10980">bpo-10980</a> 内の Armin Ronacher による仕事を参照)。</p>
</section>
<section id="unittest">
<h3>unittest<a class="headerlink" href="#unittest" title="Link to this heading">¶</a></h3>
<p>unittest モジュールに数多くの改善がありました。パッケージに対する test discovery のサポートが追加され、対話プロンプトから実験しやすくなり、新しいメソッドが追加され、テスト失敗時の診断メッセージが改善され、そしてメソッド名がより良いものになりました。</p>
<ul>
<li><p>The command-line call <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">unittest</span></code> can now accept file paths
instead of module names for running specific tests (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10620">bpo-10620</a>).  The new
test discovery can find tests within packages, locating any test importable
from the top-level directory.  The top-level directory can be specified with
the <code class="docutils literal notranslate"><span class="pre">-t</span></code> option, a pattern for matching files with <code class="docutils literal notranslate"><span class="pre">-p</span></code>, and a directory to
start discovery with <code class="docutils literal notranslate"><span class="pre">-s</span></code>:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>unittest<span class="w"> </span>discover<span class="w"> </span>-s<span class="w"> </span>my_proj_dir<span class="w"> </span>-p<span class="w"> </span>_test.py
</pre></div>
</div>
<p>(Contributed by Michael Foord.)</p>
</li>
<li><p>Experimentation at the interactive prompt is now easier because the
<a class="reference internal" href="../library/unittest.html#unittest.TestCase" title="unittest.TestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">unittest.TestCase</span></code></a> class can now be instantiated without
arguments:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">unittest</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">TestCase</span><span class="p">()</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
<p>(Contributed by Michael Foord.)</p>
</li>
<li><p><a class="reference internal" href="../library/unittest.html#module-unittest" title="unittest: Unit testing framework for Python."><code class="xref py py-mod docutils literal notranslate"><span class="pre">unittest</span></code></a> モジュールは 2 つの新メソッド <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertWarns" title="unittest.TestCase.assertWarns"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertWarns()</span></code></a> と <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertWarnsRegex" title="unittest.TestCase.assertWarnsRegex"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertWarnsRegex()</span></code></a> を持ちます。これらはテストのもとでコードによって所与の警告が発行されるかどうかを検証します:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWarns</span><span class="p">(</span><span class="ne">DeprecationWarning</span><span class="p">):</span>
    <span class="n">legacy_function</span><span class="p">(</span><span class="s1">&#39;XYZ&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(Contributed by Antoine Pitrou, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9754">bpo-9754</a>.)</p>
<p>もう一つの新メソッド <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertCountEqual" title="unittest.TestCase.assertCountEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertCountEqual()</span></code></a> は 2 つのイテラブルを比較して、要素の出現回数が同じか (順序に関わらず同じ要素が同じ数だけ出現するかどうか) をテストします:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_anagram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertCountEqual</span><span class="p">(</span><span class="s1">&#39;algorithm&#39;</span><span class="p">,</span> <span class="s1">&#39;logarithm&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(Contributed by Raymond Hettinger.)</p>
</li>
<li><p>unittest モジュールの大事な特長は、テスト失敗時の有意義な診断を生成するよう腐心してくれることです。可能ならば失敗は期待値と実際の出力との差分と一緒に記録されます。これは失敗したテスト実行の解析に特に役に立ちますが、差分は時々とてつもなく大きくもなりますので、新たに追加した属性 <a class="reference internal" href="../library/unittest.html#unittest.TestCase.maxDiff" title="unittest.TestCase.maxDiff"><code class="xref py py-attr docutils literal notranslate"><span class="pre">maxDiff</span></code></a> に差分の最大長をセットすることで表示を制御できるようになりました。</p></li>
<li><p>さらにモジュールのメソッド名に数多くのクリーンアップを行いました。</p>
<p>For example, <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertRegex" title="unittest.TestCase.assertRegex"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertRegex()</span></code></a> is the new name for
<code class="xref py py-meth docutils literal notranslate"><span class="pre">assertRegexpMatches()</span></code> which was misnamed because the
test uses <a class="reference internal" href="../library/re.html#re.search" title="re.search"><code class="xref py py-func docutils literal notranslate"><span class="pre">re.search()</span></code></a>, not <a class="reference internal" href="../library/re.html#re.match" title="re.match"><code class="xref py py-func docutils literal notranslate"><span class="pre">re.match()</span></code></a>.  Other methods using
regular expressions are now named using short form &quot;Regex&quot; in preference to
&quot;Regexp&quot; -- this matches the names used in other unittest implementations,
matches Python's old name for the <a class="reference internal" href="../library/re.html#module-re" title="re: Regular expression operations."><code class="xref py py-mod docutils literal notranslate"><span class="pre">re</span></code></a> module, and it has unambiguous
camel-casing.</p>
<p>(Contributed by Raymond Hettinger and implemented by Ezio Melotti.)</p>
</li>
<li><p>一貫性を向上させるために、長年使用されたメソッドエイリアスが推奨名に対し非推奨になりました:</p>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>以前の名前</p></th>
<th class="head"><p>推奨名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">assert_()</span></code></p></td>
<td><p><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertTrue" title="unittest.TestCase.assertTrue"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertTrue()</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertEquals()</span></code></p></td>
<td><p><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertEqual" title="unittest.TestCase.assertEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertEqual()</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertNotEquals()</span></code></p></td>
<td><p><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertNotEqual" title="unittest.TestCase.assertNotEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertNotEqual()</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertAlmostEquals()</span></code></p></td>
<td><p><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertAlmostEqual" title="unittest.TestCase.assertAlmostEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertAlmostEqual()</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertNotAlmostEquals()</span></code></p></td>
<td><p><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertNotAlmostEqual" title="unittest.TestCase.assertNotAlmostEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertNotAlmostEqual()</span></code></a></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Likewise, the <code class="docutils literal notranslate"><span class="pre">TestCase.fail*</span></code> methods deprecated in Python 3.1 are expected
to be removed in Python 3.3.</p>
<p>(Contributed by Ezio Melotti; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9424">bpo-9424</a>.)</p>
</li>
<li><p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">assertDictContainsSubset()</span></code> method was deprecated
because it was misimplemented with the arguments in the wrong order.  This
created hard-to-debug optical illusions where tests like
<code class="docutils literal notranslate"><span class="pre">TestCase().assertDictContainsSubset({'a':1,</span> <span class="pre">'b':2},</span> <span class="pre">{'a':1})</span></code> would fail.</p>
<p>(Contributed by Raymond Hettinger.)</p>
</li>
</ul>
</section>
<section id="random">
<h3>random<a class="headerlink" href="#random" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/random.html#module-random" title="random: Generate pseudo-random numbers with various common distributions."><code class="xref py py-mod docutils literal notranslate"><span class="pre">random</span></code></a> モジュールの整数メソッドの一様分布の生成が改善されました。
以前は <code class="docutils literal notranslate"><span class="pre">int(n*random())</span></code> を計算していました。
この方法では <em>n</em> が2の冪乗でない限り僅かにバイアスがあります。
現在の方法では次の2の冪乗の範囲まで複数の選択肢を作成し、<code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;=</span> <span class="pre">x</span> <span class="pre">&lt;</span> <span class="pre">n</span></code> の範囲に入ったもののみを保持します。
影響を受ける関数やメソッドは <a class="reference internal" href="../library/random.html#random.randrange" title="random.randrange"><code class="xref py py-func docutils literal notranslate"><span class="pre">randrange()</span></code></a>、<a class="reference internal" href="../library/random.html#random.randint" title="random.randint"><code class="xref py py-func docutils literal notranslate"><span class="pre">randint()</span></code></a>、<a class="reference internal" href="../library/random.html#random.choice" title="random.choice"><code class="xref py py-func docutils literal notranslate"><span class="pre">choice()</span></code></a>、<a class="reference internal" href="../library/random.html#random.shuffle" title="random.shuffle"><code class="xref py py-func docutils literal notranslate"><span class="pre">shuffle()</span></code></a> ならびに <a class="reference internal" href="../library/random.html#random.sample" title="random.sample"><code class="xref py py-func docutils literal notranslate"><span class="pre">sample()</span></code></a> です。</p>
<p>(Contributed by Raymond Hettinger; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9025">bpo-9025</a>.)</p>
</section>
<section id="poplib">
<h3>poplib<a class="headerlink" href="#poplib" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/poplib.html#poplib.POP3_SSL" title="poplib.POP3_SSL"><code class="xref py py-class docutils literal notranslate"><span class="pre">POP3_SSL</span></code></a> クラスが <em>context</em> パラメータを受け取れるようになりました。これには <a class="reference internal" href="../library/ssl.html#ssl.SSLContext" title="ssl.SSLContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ssl.SSLContext</span></code></a> オブジェクトを渡します。これは SSL コンフィグレーションオプション、証明書、秘密鍵を単一の (たぶん長生きの) 構造にまとめあげてくれるものです。</p>
<p>(Contributed by Giampaolo Rodolà; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8807">bpo-8807</a>.)</p>
</section>
<section id="asyncore">
<h3>asyncore<a class="headerlink" href="#asyncore" title="Link to this heading">¶</a></h3>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncore.dispatcher</span></code> now provides a
<code class="xref py py-meth docutils literal notranslate"><span class="pre">handle_accepted()</span></code> method
returning a <code class="docutils literal notranslate"><span class="pre">(sock,</span> <span class="pre">addr)</span></code> pair which is called when a connection has actually
been established with a new remote endpoint. This is supposed to be used as a
replacement for old <code class="xref py py-meth docutils literal notranslate"><span class="pre">handle_accept()</span></code> and avoids
the user  to call <code class="xref py py-meth docutils literal notranslate"><span class="pre">accept()</span></code> directly.</p>
<p>(Contributed by Giampaolo Rodolà; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=6706">bpo-6706</a>.)</p>
</section>
<section id="tempfile">
<h3>tempfile<a class="headerlink" href="#tempfile" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/tempfile.html#module-tempfile" title="tempfile: Generate temporary files and directories."><code class="xref py py-mod docutils literal notranslate"><span class="pre">tempfile</span></code></a> モジュールに新たなコンテキストマネージャ <a class="reference internal" href="../library/tempfile.html#tempfile.TemporaryDirectory" title="tempfile.TemporaryDirectory"><code class="xref py py-class docutils literal notranslate"><span class="pre">TemporaryDirectory</span></code></a> が追加されました。一時ディレクトリの確実な後片付けを容易に行えます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;created temporary dir:&#39;</span><span class="p">,</span> <span class="n">tmpdirname</span><span class="p">)</span>
</pre></div>
</div>
<p>(Contributed by Neil Schemenauer and Nick Coghlan; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5178">bpo-5178</a>.)</p>
</section>
<section id="inspect">
<h3>inspect<a class="headerlink" href="#inspect" title="Link to this heading">¶</a></h3>
<ul>
<li><p><a class="reference internal" href="../library/inspect.html#module-inspect" title="inspect: Extract information and source code from live objects."><code class="xref py py-mod docutils literal notranslate"><span class="pre">inspect</span></code></a> モジュールに新たな関数 <a class="reference internal" href="../library/inspect.html#inspect.getgeneratorstate" title="inspect.getgeneratorstate"><code class="xref py py-func docutils literal notranslate"><span class="pre">getgeneratorstate()</span></code></a> が追加されました。これで簡単にジェネレータイテレータの現在状態を識別出来ます (---訳注: generator-iterator という用語を使っている箇所は Python ドキュメント全体通して多くはないのですが 2.x の <a class="reference internal" href="../reference/simple_stmts.html#yield"><span class="std std-ref">yield 文</span></a> 説明中に登場します。ジェネレータと同じ意味です。なお getgeneratorstate はジェネレータでないイテレータには使えません。---):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">getgeneratorstate</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">gen</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">yield</span> <span class="s1">&#39;demo&#39;</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">gen</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">getgeneratorstate</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="go">&#39;GEN_CREATED&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="go">&#39;demo&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">getgeneratorstate</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="go">&#39;GEN_SUSPENDED&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">getgeneratorstate</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="go">&#39;GEN_CLOSED&#39;</span>
</pre></div>
</div>
<p>(Contributed by Rodolpho Eckhardt and Nick Coghlan, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10220">bpo-10220</a>.)</p>
</li>
<li><p>動的な属性を活性化することなく検索するのをサポートするために、 <a class="reference internal" href="../library/inspect.html#module-inspect" title="inspect: Extract information and source code from live objects."><code class="xref py py-mod docutils literal notranslate"><span class="pre">inspect</span></code></a> モジュールに <a class="reference internal" href="../library/inspect.html#inspect.getattr_static" title="inspect.getattr_static"><code class="xref py py-func docutils literal notranslate"><span class="pre">getattr_static()</span></code></a> 関数が追加されました。 <a class="reference internal" href="../library/functions.html#hasattr" title="hasattr"><code class="xref py py-func docutils literal notranslate"><span class="pre">hasattr()</span></code></a> とは違ってこれは本当に読み出しのみの検索であり、検索中に状態変更しないことが保障されています:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Running&#39;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="mi">10</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">getattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
<span class="go">Running</span>
<span class="go">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inspect</span><span class="o">.</span><span class="n">getattr_static</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
<span class="go">&lt;property object at 0x1022bd788&gt;</span>
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><p>(Contributed by Michael Foord.)</p>
</div></blockquote>
</section>
<section id="pydoc">
<h3>pydoc<a class="headerlink" href="#pydoc" title="Link to this heading">¶</a></h3>
<p>The <a class="reference internal" href="../library/pydoc.html#module-pydoc" title="pydoc: Documentation generator and online help system."><code class="xref py py-mod docutils literal notranslate"><span class="pre">pydoc</span></code></a> module now provides a much-improved web server interface, as
well as a new command-line option <code class="docutils literal notranslate"><span class="pre">-b</span></code> to automatically open a browser window
to display that server:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pydoc3.2<span class="w"> </span>-b
</pre></div>
</div>
<p>(Contributed by Ron Adam; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=2001">bpo-2001</a>.)</p>
</section>
<section id="dis">
<h3>dis<a class="headerlink" href="#dis" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/dis.html#module-dis" title="dis: Disassembler for Python bytecode."><code class="xref py py-mod docutils literal notranslate"><span class="pre">dis</span></code></a> モジュールに、コードを調べるための 2 つの新しい関数 <a class="reference internal" href="../library/dis.html#dis.code_info" title="dis.code_info"><code class="xref py py-func docutils literal notranslate"><span class="pre">code_info()</span></code></a> と <a class="reference internal" href="../library/dis.html#dis.show_code" title="dis.show_code"><code class="xref py py-func docutils literal notranslate"><span class="pre">show_code()</span></code></a> が追加されました。ともに、与えられた関数、メソッド、ソースコード文字列、コードオブジェクトについての詳細なコードオブジェクト情報を提供します。前者はそれを文字列で返し、後者は印字します:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">dis</span><span class="o">,</span> <span class="nn">random</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dis</span><span class="o">.</span><span class="n">show_code</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">)</span>
<span class="go">Name:              choice</span>
<span class="go">Filename:          /Library/Frameworks/Python.framework/Versions/3.2/lib/python3.2/random.py</span>
<span class="go">Argument count:    2</span>
<span class="go">Kw-only arguments: 0</span>
<span class="go">Number of locals:  3</span>
<span class="go">Stack size:        11</span>
<span class="go">Flags:             OPTIMIZED, NEWLOCALS, NOFREE</span>
<span class="go">Constants:</span>
<span class="go">   0: &#39;Choose a random element from a non-empty sequence.&#39;</span>
<span class="go">   1: &#39;Cannot choose from an empty sequence&#39;</span>
<span class="go">Names:</span>
<span class="go">   0: _randbelow</span>
<span class="go">   1: len</span>
<span class="go">   2: ValueError</span>
<span class="go">   3: IndexError</span>
<span class="go">Variable names:</span>
<span class="go">   0: self</span>
<span class="go">   1: seq</span>
<span class="go">   2: i</span>
</pre></div>
</div>
<p>また、 <a class="reference internal" href="../library/dis.html#dis.dis" title="dis.dis"><code class="xref py py-func docutils literal notranslate"><span class="pre">dis()</span></code></a> 関数が文字列引数を取れるようになり、これによって、よくあるイディオム <code class="docutils literal notranslate"><span class="pre">dis(compile(s,</span> <span class="pre">'',</span> <span class="pre">'eval'))</span></code> は <code class="docutils literal notranslate"><span class="pre">dis(s)</span></code> で一撃です:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dis</span><span class="p">(</span><span class="s1">&#39;3*x+1 if x%2==1 else x//2&#39;</span><span class="p">)</span>
<span class="go">  1           0 LOAD_NAME                0 (x)</span>
<span class="go">              3 LOAD_CONST               0 (2)</span>
<span class="go">              6 BINARY_MODULO</span>
<span class="go">              7 LOAD_CONST               1 (1)</span>
<span class="go">             10 COMPARE_OP               2 (==)</span>
<span class="go">             13 POP_JUMP_IF_FALSE       28</span>
<span class="go">             16 LOAD_CONST               2 (3)</span>
<span class="go">             19 LOAD_NAME                0 (x)</span>
<span class="go">             22 BINARY_MULTIPLY</span>
<span class="go">             23 LOAD_CONST               1 (1)</span>
<span class="go">             26 BINARY_ADD</span>
<span class="go">             27 RETURN_VALUE</span>
<span class="go">        &gt;&gt;   28 LOAD_NAME                0 (x)</span>
<span class="go">             31 LOAD_CONST               0 (2)</span>
<span class="go">             34 BINARY_FLOOR_DIVIDE</span>
<span class="go">             35 RETURN_VALUE</span>
</pre></div>
</div>
<p>要はこれらによって、CPython がどう実装されているか探索してみたり、言語構文が裏方で何をするのか見てみたりすることがより簡単になったということです。</p>
<p>(Contributed by Nick Coghlan in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9147">bpo-9147</a>.)</p>
</section>
<section id="dbm">
<h3>dbm<a class="headerlink" href="#dbm" title="Link to this heading">¶</a></h3>
<p>All database modules now support the <code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">setdefault()</span></code> methods.</p>
<p>(Suggested by Ray Allen in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9523">bpo-9523</a>.)</p>
</section>
<section id="ctypes">
<h3>ctypes<a class="headerlink" href="#ctypes" title="Link to this heading">¶</a></h3>
<p>C <code class="xref c c-type docutils literal notranslate"><span class="pre">ssize_t</span></code> データ型を表現する新たな型 <a class="reference internal" href="../library/ctypes.html#ctypes.c_ssize_t" title="ctypes.c_ssize_t"><code class="xref py py-class docutils literal notranslate"><span class="pre">ctypes.c_ssize_t</span></code></a> が追加されました。</p>
</section>
<section id="site">
<h3>site<a class="headerlink" href="#site" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/site.html#module-site" title="site: Module responsible for site-specific configuration."><code class="xref py py-mod docutils literal notranslate"><span class="pre">site</span></code></a> モジュールに、Python インストレーションの詳細を報告するのに有益な3つの新たな関数が追加されました。</p>
<ul class="simple">
<li><p><a class="reference internal" href="../library/site.html#site.getsitepackages" title="site.getsitepackages"><code class="xref py py-func docutils literal notranslate"><span class="pre">getsitepackages()</span></code></a> は全てのグローバルな site-packages ディレクトリを一覧します。</p></li>
<li><p><a class="reference internal" href="../library/site.html#site.getuserbase" title="site.getuserbase"><code class="xref py py-func docutils literal notranslate"><span class="pre">getuserbase()</span></code></a> は、ユーザのデータを格納できるベースディレクトリを報告します。</p></li>
<li><p><a class="reference internal" href="../library/site.html#site.getusersitepackages" title="site.getusersitepackages"><code class="xref py py-func docutils literal notranslate"><span class="pre">getusersitepackages()</span></code></a> はユーザ固有の site-packages ディレクトリのパスを明らかにします。</p></li>
</ul>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">site</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">site</span><span class="o">.</span><span class="n">getsitepackages</span><span class="p">()</span>
<span class="go">[&#39;/Library/Frameworks/Python.framework/Versions/3.2/lib/python3.2/site-packages&#39;,</span>
<span class="go"> &#39;/Library/Frameworks/Python.framework/Versions/3.2/lib/site-python&#39;,</span>
<span class="go"> &#39;/Library/Python/3.2/site-packages&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">site</span><span class="o">.</span><span class="n">getuserbase</span><span class="p">()</span>
<span class="go">&#39;/Users/raymondhettinger/Library/Python/3.2&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">site</span><span class="o">.</span><span class="n">getusersitepackages</span><span class="p">()</span>
<span class="go">&#39;/Users/raymondhettinger/Library/Python/3.2/lib/python/site-packages&#39;</span>
</pre></div>
</div>
<p>便宜のために、いくつかの site の機能はコマンドラインから直接アクセス可能です:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>site<span class="w"> </span>--user-base
<span class="go">/Users/raymondhettinger/.local</span>
<span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>site<span class="w"> </span>--user-site
<span class="go">/Users/raymondhettinger/.local/lib/python3.2/site-packages</span>
</pre></div>
</div>
<p>(Contributed by Tarek Ziadé in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=6693">bpo-6693</a>.)</p>
</section>
<section id="sysconfig">
<h3>sysconfig<a class="headerlink" href="#sysconfig" title="Link to this heading">¶</a></h3>
<p>新しい <a class="reference internal" href="../library/sysconfig.html#module-sysconfig" title="sysconfig: Python's configuration information"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sysconfig</span></code></a> モジュールは、プラットフォームやインストレーションごとに変わるインストールパスや環境設定変数への、直接的なアクセスを提供します。</p>
<p>このモジュールはプラットフォームとバージョンの情報へのシンプルなアクセス関数を持っています:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../library/sysconfig.html#sysconfig.get_platform" title="sysconfig.get_platform"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_platform()</span></code></a> は <em>linux-i586</em> や <em>macosx-10.6-ppc</em> といった値を返します。</p></li>
<li><p><a class="reference internal" href="../library/sysconfig.html#sysconfig.get_python_version" title="sysconfig.get_python_version"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_python_version()</span></code></a> は Python バージョンを文字列で &quot;3.2&quot; のように返します。</p></li>
</ul>
<p>It also provides access to the paths and variables corresponding to one of
seven named schemes used by <code class="docutils literal notranslate"><span class="pre">distutils</span></code>.  Those include <em>posix_prefix</em>,
<em>posix_home</em>, <em>posix_user</em>, <em>nt</em>, <em>nt_user</em>, <em>os2</em>, <em>os2_home</em>:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../library/sysconfig.html#sysconfig.get_paths" title="sysconfig.get_paths"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_paths()</span></code></a> は現在のインストールスキームに関するインストールパスを含むディレクトリ名を作ります。</p></li>
<li><p><a class="reference internal" href="../library/sysconfig.html#sysconfig.get_config_vars" title="sysconfig.get_config_vars"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_config_vars()</span></code></a> はプラットフォーム依存変数の辞書を返します。</p></li>
</ul>
<p>便利なコマンドラインインターフェースもあります:</p>
<div class="highlight-doscon notranslate"><div class="highlight"><pre><span></span><span class="gp">C:\Python32&gt;</span>python -m sysconfig
<span class="go">Platform: &quot;win32&quot;</span>
<span class="go">Python version: &quot;3.2&quot;</span>
<span class="go">Current installation scheme: &quot;nt&quot;</span>

<span class="go">Paths:</span>
<span class="go">        data = &quot;C:\Python32&quot;</span>
<span class="go">        include = &quot;C:\Python32\Include&quot;</span>
<span class="go">        platinclude = &quot;C:\Python32\Include&quot;</span>
<span class="go">        platlib = &quot;C:\Python32\Lib\site-packages&quot;</span>
<span class="go">        platstdlib = &quot;C:\Python32\Lib&quot;</span>
<span class="go">        purelib = &quot;C:\Python32\Lib\site-packages&quot;</span>
<span class="go">        scripts = &quot;C:\Python32\Scripts&quot;</span>
<span class="go">        stdlib = &quot;C:\Python32\Lib&quot;</span>

<span class="go">Variables:</span>
<span class="go">        BINDIR = &quot;C:\Python32&quot;</span>
<span class="go">        BINLIBDEST = &quot;C:\Python32\Lib&quot;</span>
<span class="go">        EXE = &quot;.exe&quot;</span>
<span class="go">        INCLUDEPY = &quot;C:\Python32\Include&quot;</span>
<span class="go">        LIBDEST = &quot;C:\Python32\Lib&quot;</span>
<span class="go">        SO = &quot;.pyd&quot;</span>
<span class="go">        VERSION = &quot;32&quot;</span>
<span class="go">        abiflags = &quot;&quot;</span>
<span class="go">        base = &quot;C:\Python32&quot;</span>
<span class="go">        exec_prefix = &quot;C:\Python32&quot;</span>
<span class="go">        platbase = &quot;C:\Python32&quot;</span>
<span class="go">        prefix = &quot;C:\Python32&quot;</span>
<span class="go">        projectbase = &quot;C:\Python32&quot;</span>
<span class="go">        py_version = &quot;3.2&quot;</span>
<span class="go">        py_version_nodot = &quot;32&quot;</span>
<span class="go">        py_version_short = &quot;3.2&quot;</span>
<span class="go">        srcdir = &quot;C:\Python32&quot;</span>
<span class="go">        userbase = &quot;C:\Documents and Settings\Raymond\Application Data\Python&quot;</span>
</pre></div>
</div>
<p>(Moved out of Distutils by Tarek Ziadé.)</p>
</section>
<section id="pdb">
<h3>pdb<a class="headerlink" href="#pdb" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../library/pdb.html#module-pdb" title="pdb: The Python debugger for interactive interpreters."><code class="xref py py-mod docutils literal notranslate"><span class="pre">pdb</span></code></a> デバッガモジュールに数多くのユーザビリティの改善がなされました:</p>
<ul class="simple">
<li><p><code class="file docutils literal notranslate"><span class="pre">pdb.py</span></code> は <code class="docutils literal notranslate"><span class="pre">-c</span></code> オプションで指定した <code class="file docutils literal notranslate"><span class="pre">.pdbrc</span></code> スクリプトファイルを実行できるようになっています。</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">.pdbrc</span></code> スクリプトファイルにはデバッグを継続する <code class="docutils literal notranslate"><span class="pre">continue</span></code> コマンドと <code class="docutils literal notranslate"><span class="pre">next</span></code> コマンドを含むことができます。</p></li>
<li><p>The <a class="reference internal" href="../library/pdb.html#pdb.Pdb" title="pdb.Pdb"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pdb</span></code></a> class constructor now accepts a <em>nosigint</em> argument.</p></li>
<li><p>新コマンド: <code class="docutils literal notranslate"><span class="pre">l(list)</span></code>, <code class="docutils literal notranslate"><span class="pre">ll(long</span> <span class="pre">list)</span></code>, <code class="docutils literal notranslate"><span class="pre">source</span></code> はソースコードを出力します。</p></li>
<li><p>新コマンド:  <code class="docutils literal notranslate"><span class="pre">display</span></code>, <code class="docutils literal notranslate"><span class="pre">undisplay</span></code> は、変更があった場合の式の値の表示/非表示を切り替えます。</p></li>
<li><p>新コマンド: <code class="docutils literal notranslate"><span class="pre">interact</span></code> は現在のスコープで見つかったグローバルおよびローカル名を含む対話型インタプリタを開始します。</p></li>
<li><p>ブレイクポイントをブレイクポイント番号指定でクリア出来ます。</p></li>
</ul>
<p>(Contributed by Georg Brandl, Antonio Cuni and Ilya Sandler.)</p>
</section>
<section id="configparser">
<h3>configparser<a class="headerlink" href="#configparser" title="Link to this heading">¶</a></h3>
<p>The <a class="reference internal" href="../library/configparser.html#module-configparser" title="configparser: Configuration file parser."><code class="xref py py-mod docutils literal notranslate"><span class="pre">configparser</span></code></a> module was modified to improve usability and
predictability of the default parser and its supported INI syntax.  The old
<code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigParser</span></code> class was removed in favor of <code class="xref py py-class docutils literal notranslate"><span class="pre">SafeConfigParser</span></code>
which has in turn been renamed to <a class="reference internal" href="../library/configparser.html#configparser.ConfigParser" title="configparser.ConfigParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigParser</span></code></a>. Support
for inline comments is now turned off by default and section or option
duplicates are not allowed in a single configuration source.</p>
<p>Config parsers はマッピングプロトコルにもとづく新しい API を獲得しました:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="s2">[DEFAULT]</span>
<span class="gp">... </span><span class="s2">location = upper left</span>
<span class="gp">... </span><span class="s2">visible = yes</span>
<span class="gp">... </span><span class="s2">editable = no</span>
<span class="gp">... </span><span class="s2">color = blue</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="s2">[main]</span>
<span class="gp">... </span><span class="s2">title = Main Menu</span>
<span class="gp">... </span><span class="s2">color = green</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="s2">[options]</span>
<span class="gp">... </span><span class="s2">title = Options</span>
<span class="gp">... </span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
<span class="go">&#39;green&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">][</span><span class="s1">&#39;editable&#39;</span><span class="p">]</span>
<span class="go">&#39;no&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">section</span> <span class="o">=</span> <span class="n">parser</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">section</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
<span class="go">&#39;Options&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">section</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Options (editable: </span><span class="si">%(editable)s</span><span class="s1">)&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">section</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
<span class="go">&#39;Options (editable: no)&#39;</span>
</pre></div>
</div>
<p>新しい API は旧式 API の上に実装されているので、カスタムなパーサーサブクラスは変更なしで使えるはずです。</p>
<p>config parser によって受け付けられる INI ファイルの構造は今ではカスタマイズ出来ます。ユーザは、オプションと値を区切る代替のデリミタやコメントのプレフィクスを指定でき、 <em>DEFAULT</em> セクションの名前を変えることができ、あるいは補間の構文を切り替えられます。</p>
<p>抜き挿し可能 (pluggable) な補間サポートがあって、これには追加の補間ハンドラ <a class="reference internal" href="../library/configparser.html#configparser.ExtendedInterpolation" title="configparser.ExtendedInterpolation"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtendedInterpolation</span></code></a> が含まれています:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">(</span><span class="n">interpolation</span><span class="o">=</span><span class="n">ExtendedInterpolation</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span><span class="o">.</span><span class="n">read_dict</span><span class="p">({</span><span class="s1">&#39;buildout&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;directory&#39;</span><span class="p">:</span> <span class="s1">&#39;/home/ambv/zope9&#39;</span><span class="p">},</span>
<span class="gp">... </span>                  <span class="s1">&#39;custom&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;prefix&#39;</span><span class="p">:</span> <span class="s1">&#39;/usr/local&#39;</span><span class="p">}})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="s2">[buildout]</span>
<span class="gp">... </span><span class="s2">parts =</span>
<span class="gp">... </span><span class="s2">  zope9</span>
<span class="gp">... </span><span class="s2">  instance</span>
<span class="gp">... </span><span class="s2">find-links =</span>
<span class="gp">... </span><span class="s2">  ${buildout:directory}/downloads/dist</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="s2">[zope9]</span>
<span class="gp">... </span><span class="s2">recipe = plone.recipe.zope9install</span>
<span class="gp">... </span><span class="s2">location = /opt/zope</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="s2">[instance]</span>
<span class="gp">... </span><span class="s2">recipe = plone.recipe.zope9instance</span>
<span class="gp">... </span><span class="s2">zope9-location = ${zope9:location}</span>
<span class="gp">... </span><span class="s2">zope-conf = ${custom:prefix}/etc/zope.conf</span>
<span class="gp">... </span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span><span class="p">[</span><span class="s1">&#39;buildout&#39;</span><span class="p">][</span><span class="s1">&#39;find-links&#39;</span><span class="p">]</span>
<span class="go">&#39;\n/home/ambv/zope9/downloads/dist&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">][</span><span class="s1">&#39;zope-conf&#39;</span><span class="p">]</span>
<span class="go">&#39;/usr/local/etc/zope.conf&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">instance</span> <span class="o">=</span> <span class="n">parser</span><span class="p">[</span><span class="s1">&#39;instance&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">instance</span><span class="p">[</span><span class="s1">&#39;zope-conf&#39;</span><span class="p">]</span>
<span class="go">&#39;/usr/local/etc/zope.conf&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">instance</span><span class="p">[</span><span class="s1">&#39;zope9-location&#39;</span><span class="p">]</span>
<span class="go">&#39;/opt/zope&#39;</span>
</pre></div>
</div>
<p>小さな機能もたくさん導入されています。例えば読み込み操作内でのエンコーディング指定のサポート、取得関数でのフォールバック値の指定、あるいは辞書や文字列から直接的に読むことなどです。</p>
<p>(All changes contributed by Łukasz Langa.)</p>
</section>
<section id="urllib-parse">
<h3>urllib.parse<a class="headerlink" href="#urllib-parse" title="Link to this heading">¶</a></h3>
<p>数多くのユーザビリティーの改善が <a class="reference internal" href="../library/urllib.parse.html#module-urllib.parse" title="urllib.parse: Parse URLs into or assemble them from components."><code class="xref py py-mod docutils literal notranslate"><span class="pre">urllib.parse</span></code></a> モジュールになされました。</p>
<p><a class="reference internal" href="../library/urllib.parse.html#urllib.parse.urlparse" title="urllib.parse.urlparse"><code class="xref py py-func docutils literal notranslate"><span class="pre">urlparse()</span></code></a> 関数が <span class="target" id="index-37"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2732.html"><strong>RFC 2732</strong></a> にて記述されている <a class="reference external" href="https://ja.wikipedia.org/wiki/IPv6">IPv6</a> アドレスをサポートするようになりました:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">urllib.parse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="s1">&#39;http://[dead:beef:cafe:5417:affe:8FA3:deaf:feed]/foo/&#39;</span><span class="p">)</span> 
<span class="go">ParseResult(scheme=&#39;http&#39;,</span>
<span class="go">            netloc=&#39;[dead:beef:cafe:5417:affe:8FA3:deaf:feed]&#39;,</span>
<span class="go">            path=&#39;/foo/&#39;,</span>
<span class="go">            params=&#39;&#39;,</span>
<span class="go">            query=&#39;&#39;,</span>
<span class="go">            fragment=&#39;&#39;)</span>
</pre></div>
</div>
<p><a class="reference internal" href="../library/urllib.parse.html#urllib.parse.urldefrag" title="urllib.parse.urldefrag"><code class="xref py py-func docutils literal notranslate"><span class="pre">urldefrag()</span></code></a> 関数は、今や <a class="reference internal" href="../glossary.html#term-named-tuple"><span class="xref std std-term">named tuple</span></a> を返します:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urldefrag</span><span class="p">(</span><span class="s1">&#39;http://python.org/about/#target&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span>
<span class="go">DefragResult(url=&#39;http://python.org/about/&#39;, fragment=&#39;target&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&#39;http://python.org/about/&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">fragment</span>
<span class="go">&#39;target&#39;</span>
</pre></div>
</div>
<p>また、  <a class="reference internal" href="../library/urllib.parse.html#urllib.parse.urlencode" title="urllib.parse.urlencode"><code class="xref py py-func docutils literal notranslate"><span class="pre">urlencode()</span></code></a> 関数はさらに柔軟になり、 <em>query</em> 引数としては文字列とバイト列のどちらも受け付けます。文字列で渡した場合、パラメータ  <em>safe</em>, <em>encoding</em>, <em>error</em> がエンコードのために <a class="reference internal" href="../library/urllib.parse.html#urllib.parse.quote_plus" title="urllib.parse.quote_plus"><code class="xref py py-func docutils literal notranslate"><span class="pre">quote_plus()</span></code></a> に送られます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">([</span>
<span class="gp">... </span>     <span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;telenovela&#39;</span><span class="p">),</span>
<span class="gp">... </span>     <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;¿Dónde Está Elisa?&#39;</span><span class="p">)],</span>
<span class="gp">... </span>     <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">)</span>
<span class="go">&#39;type=telenovela&amp;name=%BFD%F3nde+Est%E1+Elisa%3F&#39;</span>
</pre></div>
</div>
<p><a class="reference internal" href="../library/urllib.parse.html#parsing-ascii-encoded-bytes"><span class="std std-ref">ASCII エンコードバイト列の解析</span></a> に詳細に書きましたが、全ての <a class="reference internal" href="../library/urllib.parse.html#module-urllib.parse" title="urllib.parse: Parse URLs into or assemble them from components."><code class="xref py py-mod docutils literal notranslate"><span class="pre">urllib.parse</span></code></a> 関数は今では ASCII エンコードされたバイト文字列を (通常の文字列と混ぜない限り) 入力として受け付けます。ASCII エンコードされたバイト文字列がパラメータとして与えられると、戻り値の型も ASCII エンコードされたバイト文字列になります:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;http://www.python.org:80/about/&#39;</span><span class="p">)</span> 
<span class="go">ParseResultBytes(scheme=b&#39;http&#39;, netloc=b&#39;www.python.org:80&#39;,</span>
<span class="go">                 path=b&#39;/about/&#39;, params=b&#39;&#39;, query=b&#39;&#39;, fragment=b&#39;&#39;)</span>
</pre></div>
</div>
<p>(Work by Nick Coghlan, Dan Mahn, and Senthil Kumaran in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=2987">bpo-2987</a>,
<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5468">bpo-5468</a>, and <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9873">bpo-9873</a>.)</p>
</section>
<section id="mailbox">
<h3>mailbox<a class="headerlink" href="#mailbox" title="Link to this heading">¶</a></h3>
<p>R. David Murray がコミュニティの調整に尽力したおかげで、 <a class="reference internal" href="../library/mailbox.html#module-mailbox" title="mailbox: Manipulate mailboxes in various formats"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mailbox</span></code></a> が Python 3.2 のために修正されました。闘いを挑んだ相手はもともとの mailbox 設計のテキストインターフェイスでした。ですが email メッセージは個々の異なるパートが異なるエンコーディングを持ち得ますから、 <a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> が最良の表現です。</p>
<p>解決のためには任意の email メッセージをパースするために、 <a class="reference internal" href="../library/email.html#module-email" title="email: Package supporting the parsing, manipulating, and generating email messages."><code class="xref py py-mod docutils literal notranslate"><span class="pre">email</span></code></a> パッケージのバイナリサポートが利用されました (---訳注: <a class="reference internal" href="../library/email.generator.html#email.generator.BytesGenerator" title="email.generator.BytesGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">BytesGenerator</span></code></a> や <a class="reference internal" href="../library/email.parser.html#email.message_from_bytes" title="email.message_from_bytes"><code class="xref py py-func docutils literal notranslate"><span class="pre">message_from_bytes()</span></code></a> など)。また、API の変更も必要となりました。</p>
<p><a class="reference internal" href="../library/mailbox.html#mailbox.Mailbox" title="mailbox.Mailbox"><code class="xref py py-class docutils literal notranslate"><span class="pre">mailbox.Mailbox</span></code></a> オブジェクトの <a class="reference internal" href="../library/mailbox.html#mailbox.Mailbox.add" title="mailbox.Mailbox.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code></a> メソッドは、今や期待通りにバイナリ入力を受け付けます。</p>
<p><a class="reference internal" href="../library/io.html#io.StringIO" title="io.StringIO"><code class="xref py py-class docutils literal notranslate"><span class="pre">StringIO</span></code></a> とテキストファイルでの入力は非推奨となりました。また、文字列での入力は、非 ASCII 文字が使用されていると早々に失敗します。以前は後のほうのステップで email が処理される際にようやく失敗していました。</p>
<p>バイナリ出力のサポートもあります。 <a class="reference internal" href="../library/mailbox.html#mailbox.Mailbox.get_file" title="mailbox.Mailbox.get_file"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_file()</span></code></a> メソッドは今ではバイナリモードのファイルを返します (これまでは不適切にテキストモードが使われていました)。また、新しい <a class="reference internal" href="../library/mailbox.html#mailbox.Mailbox.get_bytes" title="mailbox.Mailbox.get_bytes"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_bytes()</span></code></a> メソッドは、指定した <em>key</em> に対応するメッセージの <a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> 表現を返します。</p>
<p>今でも古い API の <a class="reference internal" href="../library/mailbox.html#mailbox.Mailbox.get_string" title="mailbox.Mailbox.get_string"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_string()</span></code></a> を使って非バイナリ出力は可能ですが、そのアプローチはあまり役に立ちません。そうではなく <a class="reference internal" href="../library/mailbox.html#mailbox.Message" title="mailbox.Message"><code class="xref py py-class docutils literal notranslate"><span class="pre">Message</span></code></a> オブジェクトからメッセージを抽出するか、それらをバイナリ入力からロードするのが最善です。</p>
<p>(Contributed by R. David Murray, with efforts from Steffen Daode Nurpmeso and an
initial patch by Victor Stinner in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9124">bpo-9124</a>.)</p>
</section>
<section id="turtledemo">
<h3>turtledemo<a class="headerlink" href="#turtledemo" title="Link to this heading">¶</a></h3>
<p>The demonstration code for the <a class="reference internal" href="../library/turtle.html#module-turtle" title="turtle: An educational framework for simple graphics applications"><code class="xref py py-mod docutils literal notranslate"><span class="pre">turtle</span></code></a> module was moved from the <em>Demo</em>
directory to main library.  It includes over a dozen sample scripts with
lively displays.  Being on <a class="reference internal" href="../library/sys.html#sys.path" title="sys.path"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.path</span></code></a>, it can now be run directly
from the command-line:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>turtledemo
</pre></div>
</div>
<p>(Moved from the Demo directory by Alexander Belopolsky in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10199">bpo-10199</a>.)</p>
</section>
</section>
<section id="multi-threading">
<h2>マルチスレッディング<a class="headerlink" href="#multi-threading" title="Link to this heading">¶</a></h2>
<ul>
<li><p>The mechanism for serializing execution of concurrently running Python threads
(generally known as the <a class="reference internal" href="../glossary.html#term-GIL"><span class="xref std std-term">GIL</span></a> or Global Interpreter Lock) has
been rewritten.  Among the objectives were more predictable switching
intervals and reduced overhead due to lock contention and the number of
ensuing system calls.  The notion of a &quot;check interval&quot; to allow thread
switches has been abandoned and replaced by an absolute duration expressed in
seconds.  This parameter is tunable through <a class="reference internal" href="../library/sys.html#sys.setswitchinterval" title="sys.setswitchinterval"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.setswitchinterval()</span></code></a>.
It currently defaults to 5 milliseconds.</p>
<p>この実装に関するさらなる詳細は <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2009-October/093321.html">python-dev mailing-list message</a> で読むことが出来ます (ただしこのメッセージで言っている &quot;priority requests&quot; は含められませんでした)。</p>
<p>(Contributed by Antoine Pitrou.)</p>
</li>
<li><p>通常のロックと再帰的なロックが、<a class="reference internal" href="../library/threading.html#threading.Lock.acquire" title="threading.Lock.acquire"><code class="xref py py-meth docutils literal notranslate"><span class="pre">acquire()</span></code></a> メソッドでオプションで <em>timeout</em> 引数を受け取るようになりました。
(Contributed by Antoine Pitrou; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7316">bpo-7316</a>.)</p></li>
<li><p>同様に、<a class="reference internal" href="../library/threading.html#threading.Semaphore.acquire" title="threading.Semaphore.acquire"><code class="xref py py-meth docutils literal notranslate"><span class="pre">threading.Semaphore.acquire()</span></code></a> にも <em>timeout</em> 引数が追加されました。
(Contributed by Torsten Landschoff; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=850728">bpo-850728</a>.)</p></li>
<li><p>通常のロックと再帰的なロックの獲得に、 Pthreads を使用するプラットフォームでシグナルが割り込めるようになりました。これでロック獲得時にデッドロックしていた Python プログラムは、プロセスに SIGINT (ほとんどのシェルでは <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Ctrl</kbd>+<kbd class="kbd docutils literal notranslate">C</kbd></kbd> で) を繰り返し送ることで殺せます。(Contributed by Reid Kleckner; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8844">bpo-8844</a>.)</p></li>
</ul>
</section>
<section id="optimizations">
<h2>最適化<a class="headerlink" href="#optimizations" title="Link to this heading">¶</a></h2>
<p>小さな性能向上が多く追加されました:</p>
<ul>
<li><p>Python's peephole optimizer now recognizes patterns such <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">in</span> <span class="pre">{1,</span> <span class="pre">2,</span> <span class="pre">3}</span></code> as
being a test for membership in a set of constants.  The optimizer recasts the
<a class="reference internal" href="../library/stdtypes.html#set" title="set"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> as a <a class="reference internal" href="../library/stdtypes.html#frozenset" title="frozenset"><code class="xref py py-class docutils literal notranslate"><span class="pre">frozenset</span></code></a> and stores the pre-built constant.</p>
<p>Now that the speed penalty is gone, it is practical to start writing
membership tests using set-notation.  This style is both semantically clear
and operationally fast:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">extension</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
<span class="k">if</span> <span class="n">extension</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;xml&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="s1">&#39;xhtml&#39;</span><span class="p">,</span> <span class="s1">&#39;css&#39;</span><span class="p">}:</span>
    <span class="n">handle</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>(Patch and additional tests contributed by Dave Malcolm; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=6690">bpo-6690</a>).</p>
</li>
<li><p><a class="reference internal" href="../library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back."><code class="xref py py-mod docutils literal notranslate"><span class="pre">pickle</span></code></a> モジュールを用いたデータのシリアライズ・デシリアライズが数倍速くなりました。</p>
<p>(Contributed by Alexandre Vassalotti, Antoine Pitrou
and the Unladen Swallow team in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9410">bpo-9410</a> and <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=3873">bpo-3873</a>.)</p>
</li>
<li><p>The <a class="reference external" href="https://en.wikipedia.org/wiki/Timsort">Timsort algorithm</a> used in
<a class="reference internal" href="../library/stdtypes.html#list.sort" title="list.sort"><code class="xref py py-meth docutils literal notranslate"><span class="pre">list.sort()</span></code></a> and <a class="reference internal" href="../library/functions.html#sorted" title="sorted"><code class="xref py py-func docutils literal notranslate"><span class="pre">sorted()</span></code></a> now runs faster and uses less memory
when called with a <a class="reference internal" href="../glossary.html#term-key-function"><span class="xref std std-term">key function</span></a>.  Previously, every element of
a list was wrapped with a temporary object that remembered the key value
associated with each element.  Now, two arrays of keys and values are
sorted in parallel.  This saves the memory consumed by the sort wrappers,
and it saves time lost to delegating comparisons.</p>
<p>(Patch by Daniel Stutzbach in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9915">bpo-9915</a>.)</p>
</li>
<li><p>JSON decoding performance is improved and memory consumption is reduced
whenever the same string is repeated for multiple keys.  Also, JSON encoding
now uses the C speedups when the <code class="docutils literal notranslate"><span class="pre">sort_keys</span></code> argument is true.</p>
<p>(Contributed by Antoine Pitrou in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7451">bpo-7451</a> and by Raymond Hettinger and
Antoine Pitrou in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10314">bpo-10314</a>.)</p>
</li>
<li><p>再帰的ロック (<a class="reference internal" href="../library/threading.html#threading.RLock" title="threading.RLock"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.RLock()</span></code></a> API により生成) は C で実装されたことにより、以前の純粋な Python 実装より10から15倍速くなり、通常のロックと同じくらいになりました。</p>
<p>(Contributed by Antoine Pitrou; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=3001">bpo-3001</a>.)</p>
</li>
<li><p>The fast-search algorithm in stringlib is now used by the <a class="reference internal" href="../library/stdtypes.html#str.split" title="str.split"><code class="xref py py-meth docutils literal notranslate"><span class="pre">split()</span></code></a>,
<a class="reference internal" href="../library/stdtypes.html#str.rsplit" title="str.rsplit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rsplit()</span></code></a>, <a class="reference internal" href="../library/stdtypes.html#str.splitlines" title="str.splitlines"><code class="xref py py-meth docutils literal notranslate"><span class="pre">splitlines()</span></code></a> and <a class="reference internal" href="../library/stdtypes.html#str.replace" title="str.replace"><code class="xref py py-meth docutils literal notranslate"><span class="pre">replace()</span></code></a> methods on
<a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>, <a class="reference internal" href="../library/stdtypes.html#bytearray" title="bytearray"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytearray</span></code></a> and <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> objects. Likewise, the
algorithm is also used by <a class="reference internal" href="../library/stdtypes.html#str.rfind" title="str.rfind"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rfind()</span></code></a>, <a class="reference internal" href="../library/stdtypes.html#str.rindex" title="str.rindex"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rindex()</span></code></a>, <a class="reference internal" href="../library/stdtypes.html#str.rsplit" title="str.rsplit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rsplit()</span></code></a> and
<a class="reference internal" href="../library/stdtypes.html#str.rpartition" title="str.rpartition"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rpartition()</span></code></a>.</p>
<p>(Patch by Florent Xicluna in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7622">bpo-7622</a> and <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7462">bpo-7462</a>.)</p>
</li>
<li><p>Integer to string conversions now work two &quot;digits&quot; at a time, reducing the
number of division and modulo operations.</p>
<p>(<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=6713">bpo-6713</a> by Gawain Bolton, Mark Dickinson, and Victor Stinner.)</p>
</li>
</ul>
<p>There were several other minor optimizations. Set differencing now runs faster
when one operand is much larger than the other (patch by Andress Bennetts in
<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8685">bpo-8685</a>).  The <code class="xref py py-meth docutils literal notranslate"><span class="pre">array.repeat()</span></code> method has a faster implementation
(<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1569291">bpo-1569291</a> by Alexander Belopolsky). The <a class="reference internal" href="../library/http.server.html#http.server.BaseHTTPRequestHandler" title="http.server.BaseHTTPRequestHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseHTTPRequestHandler</span></code></a>
has more efficient buffering (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=3709">bpo-3709</a> by Andrew Schaaf).  The
<a class="reference internal" href="../library/operator.html#operator.attrgetter" title="operator.attrgetter"><code class="xref py py-func docutils literal notranslate"><span class="pre">operator.attrgetter()</span></code></a> function has been sped-up (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10160">bpo-10160</a> by
Christos Georgiou).  And <a class="reference internal" href="../library/configparser.html#configparser.ConfigParser" title="configparser.ConfigParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigParser</span></code></a> loads multi-line arguments a bit
faster (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7113">bpo-7113</a> by Łukasz Langa).</p>
</section>
<section id="unicode">
<h2>Unicode 文字列型<a class="headerlink" href="#unicode" title="Link to this heading">¶</a></h2>
<p>Python has been updated to <a class="reference external" href="https://unicode.org/versions/Unicode6.0.0/">Unicode 6.0.0</a>.  The update to the standard adds
over 2,000 new characters including <a class="reference external" href="https://en.wikipedia.org/wiki/Emoji">emoji</a>
symbols which are important for mobile phones.</p>
<p>In addition, the updated standard has altered the character properties for two
Kannada characters (U+0CF1, U+0CF2) and one New Tai Lue numeric character
(U+19DA), making the former eligible for use in identifiers while disqualifying
the latter.  For more information, see <a class="reference external" href="https://www.unicode.org/versions/Unicode6.0.0/#Database_Changes">Unicode Character Database Changes</a>.</p>
</section>
<section id="codecs">
<h2>Codecs<a class="headerlink" href="#codecs" title="Link to this heading">¶</a></h2>
<p><em>cp720</em> アラビア DOS エンコードがサポートされました (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1616979">bpo-1616979</a>)。</p>
<p>MBCS エンコーディングはもうエラーハンドラ引数を無視することはありません。デフォルトの strict モードでは、デコード出来ないバイト列に対して <a class="reference internal" href="../library/exceptions.html#UnicodeDecodeError" title="UnicodeDecodeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">UnicodeDecodeError</span></code></a> を、エンコードできない文字に対して <a class="reference internal" href="../library/exceptions.html#UnicodeEncodeError" title="UnicodeEncodeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">UnicodeEncodeError</span></code></a> を投げます。</p>
<p>MBCS コーデックはエラーハンドラとして、デコードでの <code class="docutils literal notranslate"><span class="pre">'strict'</span></code> と <code class="docutils literal notranslate"><span class="pre">'ignore'</span></code> 、エンコードでの <code class="docutils literal notranslate"><span class="pre">'strict'</span></code> と <code class="docutils literal notranslate"><span class="pre">'replace'</span></code> をサポートします。</p>
<p>Python 3.1 での MBCS エンコーディングを模擬したければデコードでは <code class="docutils literal notranslate"><span class="pre">'ignore'</span></code> ハンドラを、エンコードでは <code class="docutils literal notranslate"><span class="pre">'replace'</span></code> ハンドラを選んでください。</p>
<p>Mac OS X では Python は、コマンドライン引数をロケールのエンコーディングではなく <code class="docutils literal notranslate"><span class="pre">'utf-8'</span></code> でデコードします。</p>
<p><a class="reference internal" href="../library/tarfile.html#module-tarfile" title="tarfile: Read and write tar-format archive files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">tarfile</span></code></a> はデフォルトで、Windows では (<code class="docutils literal notranslate"><span class="pre">'mbcs'</span></code> ではなく) <code class="docutils literal notranslate"><span class="pre">'utf-8'</span></code> エンコーディングを使い、また、全ての OS でエラーハンドラ <code class="docutils literal notranslate"><span class="pre">'surrogateescape'</span></code> を使います。</p>
</section>
<section id="documentation">
<h2>ドキュメント<a class="headerlink" href="#documentation" title="Link to this heading">¶</a></h2>
<p>ドキュメントの改善が引き続き行われています。</p>
<ul>
<li><p><a class="reference internal" href="../library/functions.html#built-in-funcs"><span class="std std-ref">組み込み関数</span></a> のような長大なセクションには先頭にクイックリンクの表が追加されました。 <a class="reference internal" href="../library/itertools.html#module-itertools" title="itertools: Functions creating iterators for efficient looping."><code class="xref py py-mod docutils literal notranslate"><span class="pre">itertools</span></code></a> のようなケースでは <a class="reference external" href="https://en.wikipedia.org/wiki/Cheat_sheet">cheatsheet</a> スタイルの表からリンクが張られていて、これで要約がわかりますし、ドキュメント全体を読む必要なく記憶を呼び覚ますことが出来ます。</p></li>
<li><p>ある種のケースではピュア Python のソースコードが文書化の助手として便利に働いてくれますので、今では多くのモジュールがソースコードの最新バージョンへのクイックリンクを客演させています。例えば <a class="reference internal" href="../library/functools.html#module-functools" title="functools: Higher-order functions and operations on callable objects."><code class="xref py py-mod docutils literal notranslate"><span class="pre">functools</span></code></a> モジュールのドキュメントは先頭にこのようにクイックリンクを置いています:</p>
<blockquote>
<div><p><strong>ソースコード</strong> <a class="reference external" href="https://github.com/python/cpython/tree/3.12/Lib/functools.py">Lib/functools.py</a>.</p>
</div></blockquote>
<p>(Contributed by Raymond Hettinger; see
<a class="reference external" href="https://rhettinger.wordpress.com/2011/01/28/open-your-source-more/">rationale</a>.)</p>
</li>
<li><p>ドキュメントには今ではもっと実例とレシピが含まれています。特に <a class="reference internal" href="../library/re.html#module-re" title="re: Regular expression operations."><code class="xref py py-mod docutils literal notranslate"><span class="pre">re</span></code></a> モジュールのものには大掛かりなセクション <a class="reference internal" href="../library/re.html#re-examples"><span class="std std-ref">正規表現の例</span></a> があります。同じように <a class="reference internal" href="../library/itertools.html#module-itertools" title="itertools: Functions creating iterators for efficient looping."><code class="xref py py-mod docutils literal notranslate"><span class="pre">itertools</span></code></a> では新しい <a class="reference internal" href="../library/itertools.html#itertools-recipes"><span class="std std-ref">Itertools レシピ</span></a> で更新され続けます。</p></li>
<li><p><a class="reference internal" href="../library/datetime.html#module-datetime" title="datetime: Basic date and time types."><code class="xref py py-mod docutils literal notranslate"><span class="pre">datetime</span></code></a> モジュールは今ではピュア Python による補助実装を持っています。機能に違いはありません。これは読みやすい代替の実装を提供するだけのものです。</p>
<p>(Contributed by Alexander Belopolsky in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9528">bpo-9528</a>.)</p>
</li>
<li><p>保守されていなかった <code class="file docutils literal notranslate"><span class="pre">Demo</span></code> ディレクトリは削除されました。いくつかのデモはドキュメントに統合され、いくつかは <code class="file docutils literal notranslate"><span class="pre">Tools/demo</span></code> ディレクトリに移動し、ほかのものは一緒に削除されました。</p>
<p>(Contributed by Georg Brandl in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7962">bpo-7962</a>.)</p>
</li>
</ul>
</section>
<section id="idle">
<h2>IDLE<a class="headerlink" href="#idle" title="Link to this heading">¶</a></h2>
<ul>
<li><p>IDLE のフォーマットメニューに、ソースコードから末尾の空白を取り除くことが出来るオプションが追加されました。</p>
<p>(Contributed by Raymond Hettinger; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5150">bpo-5150</a>.)</p>
</li>
<li><p>Mac OS X 上の IDLE が Carbon AquaTk と Cocoa AquaTk の両方で動くようになりました。</p>
<p>(Contributed by Kevin Walzer, Ned Deily, and Ronald Oussoren; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=6075">bpo-6075</a>.)</p>
</li>
</ul>
</section>
<section id="code-repository">
<h2>コードリポジトリ<a class="headerlink" href="#code-repository" title="Link to this heading">¶</a></h2>
<p>In addition to the existing Subversion code repository at <a class="reference external" href="https://svn.python.org">https://svn.python.org</a>
there is now a <a class="reference external" href="https://www.mercurial-scm.org/">Mercurial</a> repository at
<a class="reference external" href="https://hg.python.org/">https://hg.python.org/</a>.</p>
<p>3.2 のリリース後に、主要なリポジトリを Mercurial に移行する計画があります。
この分散バージョン管理システムによってコミュニティメンバが容易に外部 changeset を作成したり共有したりすることが出来ます。
詳細は <span class="target" id="index-38"></span><a class="pep reference external" href="https://peps.python.org/pep-0385/"><strong>PEP 385</strong></a> を参照してください。</p>
<p>To learn to use the new version control system, see the <a class="reference external" href="https://www.mercurial-scm.org/wiki/QuickStart">Quick Start</a> or the <a class="reference external" href="https://www.mercurial-scm.org/guide">Guide to
Mercurial Workflows</a>.</p>
</section>
<section id="build-and-c-api-changes">
<h2>ビルドならびに C API の変更<a class="headerlink" href="#build-and-c-api-changes" title="Link to this heading">¶</a></h2>
<p>Python のビルド過程と C API の変更は以下の通りです:</p>
<ul>
<li><p>スクリプト <em>idle</em>, <em>pydoc</em>, <em>2to3</em> が <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">altinstall</span></code> 時にバージョン固有のサフィックスを付けてインストールされるようになりました (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10679">bpo-10679</a>)。</p></li>
<li><p>Unicode データベースにアクセスする関数 (Py_UNICODE_TOLOWER, Py_UNICODE_ISDECIMAL, ほか) が、たとえ narrow Unicode ビルドであっても full Unicode 範囲を受け付け、返すようになりました。Python から目に見える違いとしては、大きなコードポイントについて <a class="reference internal" href="../library/unicodedata.html#unicodedata.numeric" title="unicodedata.numeric"><code class="xref py py-func docutils literal notranslate"><span class="pre">unicodedata.numeric()</span></code></a> が正しい値を返し、 <a class="reference internal" href="../library/functions.html#repr" title="repr"><code class="xref py py-func docutils literal notranslate"><span class="pre">repr()</span></code></a> はより多くの文字を表示可能と考えるようになりました。</p>
<p>(Reported by Bupjoe Lee and fixed by Amaury Forgeot D'Arc; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5127">bpo-5127</a>.)</p>
</li>
<li><p>Computed gotos are now enabled by default on supported compilers (which are
detected by the configure script).  They can still be disabled selectively by
specifying <code class="docutils literal notranslate"><span class="pre">--without-computed-gotos</span></code>.</p>
<p>(Contributed by Antoine Pitrou; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9203">bpo-9203</a>.)</p>
</li>
<li><p>オプション <code class="docutils literal notranslate"><span class="pre">--with-wctype-functions</span></code> は削除されました。今では組み込みの Unicode データベースが全ての関数のために使われます。</p>
<p>(Contributed by Amaury Forgeot D'Arc; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9210">bpo-9210</a>.)</p>
</li>
<li><p>ハッシュ値として新しい型 <a class="reference internal" href="../c-api/hash.html#c.Py_hash_t" title="Py_hash_t"><code class="xref c c-type docutils literal notranslate"><span class="pre">Py_hash_t</span></code></a> を使うようになりました。これはポインタと同じサイズになるように定義されています。以前は long 型を使っていましたが、これはいくつかの 64 ビット OS でも 32 ビット長のままでした。この修正の結果、64 ビットポインタでビルドすれば <a class="reference internal" href="../library/stdtypes.html#set" title="set"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> と <a class="reference internal" href="../library/stdtypes.html#dict" title="dict"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> が <code class="docutils literal notranslate"><span class="pre">2**32</span></code> 以上のエントリを持てるようになりました (以前もそのサイズを入れることは出来ましたが、悲劇的なパフォーマンス低下を起こしていました)。</p>
<p>(Suggested by Raymond Hettinger and implemented by Benjamin Peterson;
<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9778">bpo-9778</a>.)</p>
</li>
<li><p>A new macro <code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_VA_COPY</span></code> copies the state of the variable argument
list.  It is equivalent to C99 <em>va_copy</em> but available on all Python platforms
(<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=2443">bpo-2443</a>).</p></li>
<li><p>A new C API function <code class="xref c c-func docutils literal notranslate"><span class="pre">PySys_SetArgvEx()</span></code> allows an embedded interpreter
to set <a class="reference internal" href="../library/sys.html#sys.argv" title="sys.argv"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.argv</span></code></a> without also modifying <a class="reference internal" href="../library/sys.html#sys.path" title="sys.path"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.path</span></code></a>
(<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5753">bpo-5753</a>).</p></li>
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">PyEval_CallObject()</span></code> is now only available in macro form.  The
function declaration, which was kept for backwards compatibility reasons, is
now removed -- the macro was introduced in 1997 (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8276">bpo-8276</a>).</p></li>
<li><p><a class="reference internal" href="../c-api/long.html#c.PyLong_AsLongAndOverflow" title="PyLong_AsLongAndOverflow"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyLong_AsLongAndOverflow()</span></code></a> の姉妹品の <a class="reference internal" href="../c-api/long.html#c.PyLong_AsLongLongAndOverflow" title="PyLong_AsLongLongAndOverflow"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyLong_AsLongLongAndOverflow()</span></code></a> 関数が追加されました。両方とも Python <a class="reference internal" href="../library/functions.html#int" title="int"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a> を C ネイティブの固定幅型に変換しますが、変換が幅に合わないことを検出します (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7767">bpo-7767</a>)。</p></li>
<li><p><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_CompareWithASCIIString" title="PyUnicode_CompareWithASCIIString"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_CompareWithASCIIString()</span></code></a> 関数が、Python 文字列が <em>NUL</em> 終端である場合に「 <em>等しくない</em> 」を返すようになりました。</p></li>
<li><p>新しい関数 <a class="reference internal" href="../c-api/exceptions.html#c.PyErr_NewExceptionWithDoc" title="PyErr_NewExceptionWithDoc"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_NewExceptionWithDoc()</span></code></a> は <a class="reference internal" href="../c-api/exceptions.html#c.PyErr_NewException" title="PyErr_NewException"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_NewException()</span></code></a> と似ていますが、ドキュメンテーション文字列を受け付けます。これは C 拡張に、対応するピュア Python と同じ自己文書化 (self-documenting) 能力を与えます (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=7033">bpo-7033</a>)。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--with-valgrind</span></code> オプションとともにコンパイル時、 Valgrind のもとでの実行時に自動的に pymalloc アロケータが無効になるようになりました。ほかの状況では pymalloc は有利ですが、Valgrind 配下での実行時のメモリリーク検出では無効化したほうが良い結果が得られます (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=2422">bpo-2422</a>)。</p></li>
<li><p><em>PyArg_Parse</em> 関数から書式文字列 <code class="docutils literal notranslate"><span class="pre">O?</span></code> が削除されました。これはもう使われていませんし、今まで一度も文書化されたことはありません (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8837">bpo-8837</a>)。</p></li>
</ul>
<p>There were a number of other small changes to the C-API.  See the
<a class="reference external" href="https://github.com/python/cpython/blob/v3.2.6/Misc/NEWS">Misc/NEWS</a>
file for a complete list.</p>
<p>Also, there were a number of updates to the Mac OS X build, see
<a class="reference external" href="https://github.com/python/cpython/blob/v3.2.6/Mac/BuildScript/README.txt">Mac/BuildScript/README.txt</a>
for details.  For users running a 32/64-bit
build, there is a known problem with the default Tcl/Tk on Mac OS X 10.6.
Accordingly, we recommend installing an updated alternative such as
<a class="reference external" href="https://web.archive.org/web/20101208191259/https://www.activestate.com/activetcl/downloads">ActiveState Tcl/Tk 8.5.9</a>.
See <a class="reference external" href="https://www.python.org/download/mac/tcltk/">https://www.python.org/download/mac/tcltk/</a> for additional details.</p>
</section>
<section id="porting-to-python-3-2">
<h2>Python 3.2 への移植<a class="headerlink" href="#porting-to-python-3-2" title="Link to this heading">¶</a></h2>
<p>このセクションでは前述の変更とバグフィックスにより必要となるかもしれないコードの変更を列挙します:</p>
<ul>
<li><p>The <a class="reference internal" href="../library/configparser.html#module-configparser" title="configparser: Configuration file parser."><code class="xref py py-mod docutils literal notranslate"><span class="pre">configparser</span></code></a> module has a number of clean-ups.  The major change is
to replace the old <code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigParser</span></code> class with long-standing preferred
alternative <code class="xref py py-class docutils literal notranslate"><span class="pre">SafeConfigParser</span></code>.  In addition there are a number of
smaller incompatibilities:</p>
<ul class="simple">
<li><p>補間 (interpolation) の構文は今では <a class="reference internal" href="../library/configparser.html#configparser.ConfigParser.get" title="configparser.ConfigParser.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a> と <a class="reference internal" href="../library/configparser.html#configparser.ConfigParser.set" title="configparser.ConfigParser.set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set()</span></code></a> の操作で検証されます。デフォルトの補間スキームでは、パーセント記号を使ったただ二つのトークンのみが正当です: <code class="docutils literal notranslate"><span class="pre">%(name)s</span></code> と <code class="docutils literal notranslate"><span class="pre">%%</span></code> 、後者はエスケープされたパーセント記号自身。</p></li>
<li><p><a class="reference internal" href="../library/configparser.html#configparser.ConfigParser.set" title="configparser.ConfigParser.set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set()</span></code></a> メソッドと <a class="reference internal" href="../library/configparser.html#configparser.ConfigParser.add_section" title="configparser.ConfigParser.add_section"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_section()</span></code></a> メソッドは今ではその値が実際に文字列かどうかを検証します。以前はサポートされない型が意図せず持ち込まれる可能性がありました。</p></li>
<li><p>単一ソースからのセクションまたはオプションの複製 (重複) に対し、今では <a class="reference internal" href="../library/configparser.html#configparser.DuplicateSectionError" title="configparser.DuplicateSectionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DuplicateSectionError</span></code></a> もしくは <a class="reference internal" href="../library/configparser.html#configparser.DuplicateOptionError" title="configparser.DuplicateOptionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DuplicateOptionError</span></code></a> を投げます。以前は重複は黙って以前のエントリを上書きしていました。</p></li>
<li><p>インラインコメントは今ではデフォルトで無効なので、 <strong>;</strong> 文字を安全に値のなかで使えます。</p></li>
<li><p>コメントを字下げ出来るようになっています。このことにより、値が継続行となる場合の後続行の字下げ開始位置に <strong>;</strong> または <strong>#</strong> を置くには、補間を使う必要があります。こうすればコメントのプレフィクス文字が値内に現れて誤ってコメントと解釈されるのを防げます。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> は今では合法な値なので、もはや自動的に空文字列に変換されることはありません。空文字列のためには行内で <code class="docutils literal notranslate"><span class="pre">&quot;option</span> <span class="pre">=&quot;</span></code> と書いてください。</p></li>
</ul>
</li>
<li><p>The <a class="reference internal" href="../library/nntplib.html#module-nntplib" title="nntplib: NNTP protocol client (requires sockets). (非推奨)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">nntplib</span></code></a> module was reworked extensively, meaning that its APIs
are often incompatible with the 3.1 APIs.</p></li>
<li><p><a class="reference internal" href="../library/stdtypes.html#bytearray" title="bytearray"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytearray</span></code></a> オブジェクトはもうファイル名には使えません。代わりに <a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> に変換しなければいけません。</p></li>
<li><p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">array.tostring()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">array.fromstring()</span></code> have been renamed to
<a class="reference internal" href="../library/array.html#array.array.tobytes" title="array.array.tobytes"><code class="xref py py-meth docutils literal notranslate"><span class="pre">array.tobytes()</span></code></a> and
<a class="reference internal" href="../library/array.html#array.array.frombytes" title="array.array.frombytes"><code class="xref py py-meth docutils literal notranslate"><span class="pre">array.frombytes()</span></code></a> for clarity.  The old names
have been deprecated. (See <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8990">bpo-8990</a>.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyArg_Parse*()</span></code> 系関数:</p>
<ul class="simple">
<li><p>書式文字列 &quot;t#&quot; の削除: 代わりに &quot;s#&quot; もしくは &quot;s*&quot; を使ってください。</p></li>
<li><p>書式文字列 &quot;w&quot; および &quot;w#&quot; の削除: 代わりに &quot;w*&quot; を使ってください。</p></li>
</ul>
</li>
<li><p>The <code class="xref c c-type docutils literal notranslate"><span class="pre">PyCObject</span></code> type, deprecated in 3.1, has been removed.  To wrap
opaque C pointers in Python objects, the <a class="reference internal" href="../c-api/capsule.html#c.PyCapsule" title="PyCapsule"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyCapsule</span></code></a> API should be used
instead; the new type has a well-defined interface for passing typing safety
information and a less complicated signature for calling a destructor.</p></li>
<li><p>The <code class="xref py py-func docutils literal notranslate"><span class="pre">sys.setfilesystemencoding()</span></code> function was removed because
it had a flawed design.</p></li>
<li><p><a class="reference internal" href="../library/random.html#random.seed" title="random.seed"><code class="xref py py-func docutils literal notranslate"><span class="pre">random.seed()</span></code></a> 関数とメソッドが、salt に文字列やバイト列を与えた場合に内部で sha512 ハッシュ関数を使うようになりました。Python 3.1 シーケンスを再現するのに以前のバージョンの <em>seed</em> が必要であれば、 <em>version</em> 引数を <em>1</em> にしてください。 <code class="docutils literal notranslate"><span class="pre">random.seed(s,</span> <span class="pre">version=1)</span></code> のように。</p></li>
<li><p>The previously deprecated <code class="xref py py-func docutils literal notranslate"><span class="pre">string.maketrans()</span></code> function has been removed
in favor of the static methods <a class="reference internal" href="../library/stdtypes.html#bytes.maketrans" title="bytes.maketrans"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bytes.maketrans()</span></code></a> and
<a class="reference internal" href="../library/stdtypes.html#bytearray.maketrans" title="bytearray.maketrans"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bytearray.maketrans()</span></code></a>.  This change solves the confusion around which
types were supported by the <a class="reference internal" href="../library/string.html#module-string" title="string: Common string operations."><code class="xref py py-mod docutils literal notranslate"><span class="pre">string</span></code></a> module.  Now, <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>,
<a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>, and <a class="reference internal" href="../library/stdtypes.html#bytearray" title="bytearray"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytearray</span></code></a> each have their own <strong>maketrans</strong> and
<strong>translate</strong> methods with intermediate translation tables of the appropriate
type.</p>
<p>(Contributed by Georg Brandl; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5675">bpo-5675</a>.)</p>
</li>
<li><p>The previously deprecated <code class="xref py py-func docutils literal notranslate"><span class="pre">contextlib.nested()</span></code> function has been removed
in favor of a plain <a class="reference internal" href="../reference/compound_stmts.html#with"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">with</span></code></a> statement which can accept multiple
context managers.  The latter technique is faster (because it is built-in),
and it does a better job finalizing multiple context managers when one of them
raises an exception:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;mylog.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;a.out&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;&lt;critical&gt;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p>(Georg Brandl と Mattias Brändström の貢献; <a class="reference external" href="https://codereview.appspot.com/53094">appspot issue 53094</a>.)</p>
</li>
<li><p><a class="reference internal" href="../library/struct.html#struct.pack" title="struct.pack"><code class="xref py py-func docutils literal notranslate"><span class="pre">struct.pack()</span></code></a> は、文字列パックコード <code class="docutils literal notranslate"><span class="pre">s</span></code> で bytes のみを許容するようになりました。以前はテキスト引数を受け取って暗黙に UTF-8 でエンコードして bytes に変換していました。特定のエンコーディングを前提にするのは間違っていますし、可変長のエンコーディングは構造体の固定長セグメントへの書き込みで失敗しうるので、これは問題でした。</p>
<p>例えば <code class="docutils literal notranslate"><span class="pre">struct.pack('&lt;6sHHBBB',</span> <span class="pre">'GIF87a',</span> <span class="pre">x,</span> <span class="pre">y)</span></code> としているならば、テキストではなく bytes を使うように <code class="docutils literal notranslate"><span class="pre">struct.pack('&lt;6sHHBBB',</span> <span class="pre">b'GIF87a',</span> <span class="pre">x,</span> <span class="pre">y)</span></code> と書き換えなければなりません。</p>
<p>(Discovered by David Beazley and fixed by Victor Stinner; <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10783">bpo-10783</a>.)</p>
</li>
<li><p>パース失敗時に <a class="reference internal" href="../library/xml.etree.elementtree.html#module-xml.etree.ElementTree" title="xml.etree.ElementTree: Implementation of the ElementTree API."><code class="xref py py-class docutils literal notranslate"><span class="pre">xml.etree.ElementTree</span></code></a> クラスが <a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.ParseError" title="xml.etree.ElementTree.ParseError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">xml.etree.ElementTree.ParseError</span></code></a> を投げるようになりました。以前は <a class="reference internal" href="../library/pyexpat.html#xml.parsers.expat.ExpatError" title="xml.parsers.expat.ExpatError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">xml.parsers.expat.ExpatError</span></code></a> を投げていました。</p></li>
<li><p>浮動小数点数と複素数に対する <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-func docutils literal notranslate"><span class="pre">str()</span></code></a> が以前より長い表現をするようになったことで、古いフォーマットに依存する doctest は壊れるかもしれません。</p></li>
<li><p><a class="reference internal" href="../library/subprocess.html#subprocess.Popen" title="subprocess.Popen"><code class="xref py py-class docutils literal notranslate"><span class="pre">subprocess.Popen</span></code></a> の <em>close_fds</em> のデフォルトが、Unix では <code class="docutils literal notranslate"><span class="pre">True</span></code> になりました。Windows では 3 つの標準ストリームに <code class="docutils literal notranslate"><span class="pre">None</span></code> がセットされている場合には <code class="docutils literal notranslate"><span class="pre">True</span></code> 、以外の場合は <code class="docutils literal notranslate"><span class="pre">False</span></code> になりました。以前は <em>close_fds</em> のデフォルトはいつでも <code class="docutils literal notranslate"><span class="pre">False</span></code> でした。これは開いているファイル記述子が子プロセスに漏れた場合に解決が難しいバグや競合状態を生み出していました。</p></li>
<li><p>レガシーな HTTP 0.9 のサポートが <a class="reference internal" href="../library/urllib.request.html#module-urllib.request" title="urllib.request: Extensible library for opening URLs."><code class="xref py py-mod docutils literal notranslate"><span class="pre">urllib.request</span></code></a> と <a class="reference internal" href="../library/http.client.html#module-http.client" title="http.client: HTTP and HTTPS protocol client (requires sockets)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">http.client</span></code></a> から削除されました。このサポートはサーバサイドではまだ健在です (<a class="reference internal" href="../library/http.server.html#module-http.server" title="http.server: HTTP server and request handlers."><code class="xref py py-mod docutils literal notranslate"><span class="pre">http.server</span></code></a> 内)。</p>
<p>(Contributed by Antoine Pitrou, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10711">bpo-10711</a>.)</p>
</li>
<li><p>タイムアウトモード時の SSL ソケットでタイムアウトした場合に、汎用の <a class="reference internal" href="../library/ssl.html#ssl.SSLError" title="ssl.SSLError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SSLError</span></code></a> ではなく <a class="reference internal" href="../library/socket.html#socket.timeout" title="socket.timeout"><code class="xref py py-exc docutils literal notranslate"><span class="pre">socket.timeout</span></code></a> を投げるようになりました。</p>
<p>(Contributed by Antoine Pitrou, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10272">bpo-10272</a>.)</p>
</li>
<li><p>The misleading functions <code class="xref c c-func docutils literal notranslate"><span class="pre">PyEval_AcquireLock()</span></code> and
<code class="xref c c-func docutils literal notranslate"><span class="pre">PyEval_ReleaseLock()</span></code> have been officially deprecated.  The
thread-state aware APIs (such as <a class="reference internal" href="../c-api/init.html#c.PyEval_SaveThread" title="PyEval_SaveThread"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyEval_SaveThread()</span></code></a>
and <a class="reference internal" href="../c-api/init.html#c.PyEval_RestoreThread" title="PyEval_RestoreThread"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyEval_RestoreThread()</span></code></a>) should be used instead.</p></li>
<li><p>Due to security risks, <code class="xref py py-func docutils literal notranslate"><span class="pre">asyncore.handle_accept()</span></code> has been deprecated, and
a new function, <code class="xref py py-func docutils literal notranslate"><span class="pre">asyncore.handle_accepted()</span></code>, was added to replace it.</p>
<p>(Contributed by Giampaolo Rodola in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=6706">bpo-6706</a>.)</p>
</li>
<li><p>Due to the new <a class="reference internal" href="../glossary.html#term-GIL"><span class="xref std std-term">GIL</span></a> implementation, <code class="xref c c-func docutils literal notranslate"><span class="pre">PyEval_InitThreads()</span></code>
cannot be called before <a class="reference internal" href="../c-api/init.html#c.Py_Initialize" title="Py_Initialize"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_Initialize()</span></code></a> anymore.</p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../contents.html">目次</a></h3>
    <ul>
<li><a class="reference internal" href="#">What's New In Python 3.2</a><ul>
<li><a class="reference internal" href="#pep-384-defining-a-stable-abi">PEP 384: 安定 ABI の定義</a></li>
<li><a class="reference internal" href="#pep-389-argparse-command-line-parsing-module">PEP 389: argparse コマンドライン解析モジュール</a></li>
<li><a class="reference internal" href="#pep-391-dictionary-based-configuration-for-logging">PEP 391:  logging の辞書ベースの設定</a></li>
<li><a class="reference internal" href="#pep-3148-the-concurrent-futures-module">PEP 3148:  <code class="docutils literal notranslate"><span class="pre">concurrent.futures</span></code> モジュール</a></li>
<li><a class="reference internal" href="#pep-3147-pyc-repository-directories">PEP 3147:  PYC リポジトリーディレクトリ</a></li>
<li><a class="reference internal" href="#pep-3149-abi-version-tagged-so-files">PEP 3149: ABI バージョンでタグ付けされた .so ファイル</a></li>
<li><a class="reference internal" href="#pep-3333-python-web-server-gateway-interface-v1-0-1">PEP 3333: Python Web Server Gateway Interface v1.0.1</a></li>
<li><a class="reference internal" href="#other-language-changes">その他の言語変更</a></li>
<li><a class="reference internal" href="#new-improved-and-deprecated-modules">新たなモジュール、改良されたモジュール、非推奨のモジュール</a><ul>
<li><a class="reference internal" href="#email">email</a></li>
<li><a class="reference internal" href="#elementtree">elementtree</a></li>
<li><a class="reference internal" href="#functools">functools</a></li>
<li><a class="reference internal" href="#itertools">itertools</a></li>
<li><a class="reference internal" href="#collections">collections</a></li>
<li><a class="reference internal" href="#threading">threading</a></li>
<li><a class="reference internal" href="#datetime-and-time">datetime と time</a></li>
<li><a class="reference internal" href="#math">math</a></li>
<li><a class="reference internal" href="#abc">abc</a></li>
<li><a class="reference internal" href="#io">io</a></li>
<li><a class="reference internal" href="#reprlib">reprlib</a></li>
<li><a class="reference internal" href="#logging">logging</a></li>
<li><a class="reference internal" href="#csv">csv</a></li>
<li><a class="reference internal" href="#contextlib">contextlib</a></li>
<li><a class="reference internal" href="#decimal-and-fractions">decimal と fractions</a></li>
<li><a class="reference internal" href="#ftp">ftp</a></li>
<li><a class="reference internal" href="#popen">popen</a></li>
<li><a class="reference internal" href="#select">select</a></li>
<li><a class="reference internal" href="#gzip-and-zipfile">gzip と zipfile</a></li>
<li><a class="reference internal" href="#tarfile">tarfile</a></li>
<li><a class="reference internal" href="#hashlib">hashlib</a></li>
<li><a class="reference internal" href="#ast">ast</a></li>
<li><a class="reference internal" href="#os">os</a></li>
<li><a class="reference internal" href="#shutil">shutil</a></li>
<li><a class="reference internal" href="#sqlite3">sqlite3</a></li>
<li><a class="reference internal" href="#html">html</a></li>
<li><a class="reference internal" href="#socket">socket</a></li>
<li><a class="reference internal" href="#ssl">ssl</a></li>
<li><a class="reference internal" href="#nntp">nntp</a></li>
<li><a class="reference internal" href="#certificates">certificates</a></li>
<li><a class="reference internal" href="#imaplib">imaplib</a></li>
<li><a class="reference internal" href="#http-client">http.client</a></li>
<li><a class="reference internal" href="#unittest">unittest</a></li>
<li><a class="reference internal" href="#random">random</a></li>
<li><a class="reference internal" href="#poplib">poplib</a></li>
<li><a class="reference internal" href="#asyncore">asyncore</a></li>
<li><a class="reference internal" href="#tempfile">tempfile</a></li>
<li><a class="reference internal" href="#inspect">inspect</a></li>
<li><a class="reference internal" href="#pydoc">pydoc</a></li>
<li><a class="reference internal" href="#dis">dis</a></li>
<li><a class="reference internal" href="#dbm">dbm</a></li>
<li><a class="reference internal" href="#ctypes">ctypes</a></li>
<li><a class="reference internal" href="#site">site</a></li>
<li><a class="reference internal" href="#sysconfig">sysconfig</a></li>
<li><a class="reference internal" href="#pdb">pdb</a></li>
<li><a class="reference internal" href="#configparser">configparser</a></li>
<li><a class="reference internal" href="#urllib-parse">urllib.parse</a></li>
<li><a class="reference internal" href="#mailbox">mailbox</a></li>
<li><a class="reference internal" href="#turtledemo">turtledemo</a></li>
</ul>
</li>
<li><a class="reference internal" href="#multi-threading">マルチスレッディング</a></li>
<li><a class="reference internal" href="#optimizations">最適化</a></li>
<li><a class="reference internal" href="#unicode">Unicode 文字列型</a></li>
<li><a class="reference internal" href="#codecs">Codecs</a></li>
<li><a class="reference internal" href="#documentation">ドキュメント</a></li>
<li><a class="reference internal" href="#idle">IDLE</a></li>
<li><a class="reference internal" href="#code-repository">コードリポジトリ</a></li>
<li><a class="reference internal" href="#build-and-c-api-changes">ビルドならびに C API の変更</a></li>
<li><a class="reference internal" href="#porting-to-python-3-2">Python 3.2 への移植</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>前のトピックへ</h4>
    <p class="topless"><a href="3.3.html"
                          title="前の章へ">What's New In Python 3.3</a></p>
  </div>
  <div>
    <h4>次のトピックへ</h4>
    <p class="topless"><a href="3.1.html"
                          title="次の章へ">What's New In Python 3.1</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">バグ報告</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/main/Doc/whatsnew/3.2.rst"
            rel="nofollow">ソースの表示
        </a>
      </li>
    </ul>
  </div>
        </div>
<div id="sidebarbutton" title="サイドバーをたたむ">
<span>«</span>
</div>

      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="3.1.html" title="What&#39;s New In Python 3.1"
             >次へ</a> |</li>
        <li class="right" >
          <a href="3.3.html" title="What&#39;s New In Python 3.3"
             >前へ</a> |</li>

          <li><img src="../_static/py.svg" alt="Python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
    <li id="cpython-language-and-version">
      <a href="../index.html">3.12.4 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" >What's New in Python</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">What's New In Python 3.2</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="クイック検索" aria-label="クイック検索" type="search" name="q" id="search-box" />
          <input type="submit" value="検索" />
        </form>
    </div>
                     |
                </li>
            <li class="right">
<label class="theme-selector-label">
    Theme
    <select class="theme-selector" oninput="activateTheme(this.value)">
        <option value="auto" selected>Auto</option>
        <option value="light">Light</option>
        <option value="dark">Dark</option>
    </select>
</label> |</li>
            
      </ul>
    </div>  
    <div class="footer">
    &copy; 
      <a href="../copyright.html">
    
    Copyright
    
      </a>
     2001-2024, Python Software Foundation.
    <br />
    This page is licensed under the Python Software Foundation License Version 2.
    <br />
    Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.
    <br />
    
      See <a href="/license.html">History and License</a> for more information.<br />
    
    
    <br />

    The Python Software Foundation is a non-profit corporation.
<a href="https://www.python.org/psf/donations/">Please donate.</a>
<br />
    <br />
      最終更新: Jun 11, 2024 (04:44 UTC)
    
      <a href="/bugs.html">Found a bug</a>?
    
    <br />

    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    </div>

    <script type="text/javascript" src="../_static/switchers.js"></script>
  </body>
</html>