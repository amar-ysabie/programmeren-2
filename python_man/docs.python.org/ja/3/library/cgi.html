<!DOCTYPE html>

<html lang="ja" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="cgi --- CGI (ゲートウェイインターフェース規格) のサポート" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://docs.python.org/3/library/cgi.html" />
<meta property="og:site_name" content="Python documentation" />
<meta property="og:description" content="ソースコード: Lib/cgi.py ゲートウェイインターフェース規格 (CGI) に準拠したスクリプトをサポートするためのモジュールです。 このモジュールでは、Python で CGI スクリプトを書く際に使える様々なユーティリティを定義しています。 The global variable maxlen can be set to an integer indicating the max..." />
<meta property="og:image" content="https://docs.python.org/3/_static/og-image.png" />
<meta property="og:image:alt" content="Python documentation" />
<meta name="description" content="ソースコード: Lib/cgi.py ゲートウェイインターフェース規格 (CGI) に準拠したスクリプトをサポートするためのモジュールです。 このモジュールでは、Python で CGI スクリプトを書く際に使える様々なユーティリティを定義しています。 The global variable maxlen can be set to an integer indicating the max..." />
<meta property="og:image:width" content="200" />
<meta property="og:image:height" content="200" />
<meta name="theme-color" content="#3776ab" />

    <title>cgi --- CGI (ゲートウェイインターフェース規格) のサポート &#8212; Python 3.12.4 ドキュメント</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css%3Fv=80d5e7a1.css" />
    <link rel="stylesheet" type="text/css" href="../_static/pydoctheme.css%3Fv=bb723527.css" />
    <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../_static/pygments_dark.css%3Fv=b20cc3f5.css" />
    
    <script src="../_static/documentation_options.js%3Fv=7e11ab17"></script>
    <script src="../_static/doctools.js%3Fv=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js%3Fv=dc90522c"></script>
    <script src="../_static/translations.js%3Fv=4dbe4bdc"></script>
    
    <script src="../_static/sidebar.js"></script>
    
    <link rel="search" type="application/opensearchdescription+xml"
          title="Python 3.12.4 ドキュメント 内を検索"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="このドキュメントについて" href="../about.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="cgitb --- CGI スクリプトのトレースバック管理機構" href="cgitb.html" />
    <link rel="prev" title="audioop --- 生の音声データを操作する" href="audioop.html" />
    
      <script defer data-domain="docs.python.org" src="https://plausible.io/js/script.js"></script>
    
    <link rel="canonical" href="../../../3/library/cgi.html" />
    
      
    

    
    <style>
      @media only screen {
        table.full-width-table {
            width: 100%;
        }
      }
    </style>
<link rel="stylesheet" href="../_static/pydoctheme_dark.css" media="(prefers-color-scheme: dark)" id="pydoctheme_dark_css">
    <link rel="shortcut icon" type="image/png" href="../_static/py.svg" />
            <script type="text/javascript" src="../_static/copybutton.js"></script>
            <script type="text/javascript" src="../_static/menu.js"></script>
            <script type="text/javascript" src="../_static/search-focus.js"></script>
            <script type="text/javascript" src="../_static/themetoggle.js"></script> 
<meta name="readthedocs-addons-api-version" content="1">
<script type="text/javascript">
 function onSwitch(event) {
     const option = event.target.selectedIndex;
     const item = event.target.options[option];
     window.location.href = item.dataset.url;
 }

 document.addEventListener("readthedocs-addons-data-ready", function(event) {
   const config = event.detail.data()

   // Add some mocked hardcoded versions pointing to the official
   // documentation while migrating to Read the Docs.
   // These are only for testing purposes.
   // TODO: remove them when managing all the versions on Read the Docs,
   // since all the "active, built and not hidden" versions will be shown automatically.
   let versions = config.versions.active.concat([
       {
           slug: "dev (3.13)",
           urls: {
               documentation: "https://docs.python.org/3.13/",
           }
       },
       {
           slug: "3.12",
           urls: {
               documentation: "https://docs.python.org/3.12/",
           }
       },
       {
           slug: "3.11",
           urls: {
               documentation: "https://docs.python.org/3.11/",
           }
       },
   ]);

   const versionSelect = `
   <select id="version_select">
   ${ versions.map(
       (version) => `
       <option
           value="${ version.slug }"
           ${ config.versions.current.slug === version.slug ? 'selected="selected"' : '' }
           data-url="${ version.urls.documentation }">
           ${ version.slug }
       </option>`
   ).join("\n") }
   </select>
   `;

   // Prepend the current language to the options on the selector
   let languages = config.projects.translations.concat(config.projects.current);
   languages = languages.sort((a, b) => a.language.name.localeCompare(b.language.name));

   const languageSelect = `
   <select id="language_select">
   ${ languages.map(
       (translation) => `
       <option
           value="${ translation.slug }"
           ${ config.projects.current.slug === translation.slug ? 'selected="selected"' : '' }
           data-url="${ translation.urls.documentation }">
           ${ translation.language.name }
       </option>`
   ).join("\n") }
   </select>
   `;

   // Query all the placeholders because there are different ones for Desktop/Mobile
   const versionPlaceholders = document.querySelectorAll(".version_switcher_placeholder");
   for (placeholder of versionPlaceholders) {
       placeholder.innerHTML = versionSelect;
       let selectElement = placeholder.querySelector("select");
       selectElement.addEventListener("change", onSwitch);
   }

   const languagePlaceholders = document.querySelectorAll(".language_switcher_placeholder");
   for (placeholder of languagePlaceholders) {
       placeholder.innerHTML = languageSelect;
       let selectElement = placeholder.querySelector("select");
       selectElement.addEventListener("change", onSwitch);
   }
 });
</script>

  </head>
<body>
<div class="mobile-nav">
    <input type="checkbox" id="menuToggler" class="toggler__input" aria-controls="navigation"
           aria-pressed="false" aria-expanded="false" role="button" aria-label="Menu" />
    <nav class="nav-content" role="navigation">
        <label for="menuToggler" class="toggler__label">
            <span></span>
        </label>
        <span class="nav-items-wrapper">
            <a href="https://www.python.org/" class="nav-logo">
                <img src="../_static/py.svg" alt="Python logo"/>
            </a>
            <span class="version_switcher_placeholder"></span>
            <form role="search" class="search" action="../search.html" method="get">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="search-icon">
                    <path fill-rule="nonzero" fill="currentColor" d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 001.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 00-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 005.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
                </svg>
                <input placeholder="クイック検索" aria-label="クイック検索" type="search" name="q" />
                <input type="submit" value="検索"/>
            </form>
        </span>
    </nav>
    <div class="menu-wrapper">
        <nav class="menu" role="navigation" aria-label="main navigation">
            <div class="language_switcher_placeholder"></div>
            
<label class="theme-selector-label">
    Theme
    <select class="theme-selector" oninput="activateTheme(this.value)">
        <option value="auto" selected>Auto</option>
        <option value="light">Light</option>
        <option value="dark">Dark</option>
    </select>
</label>
  <div>
    <h3><a href="../contents.html">目次</a></h3>
    <ul>
<li><a class="reference internal" href="cgi.html#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cgi</span></code> --- CGI (ゲートウェイインターフェース規格) のサポート</a><ul>
<li><a class="reference internal" href="cgi.html#introduction">はじめに</a></li>
<li><a class="reference internal" href="cgi.html#using-the-cgi-module">cgi モジュールを使う</a></li>
<li><a class="reference internal" href="cgi.html#higher-level-interface">高水準インターフェース</a></li>
<li><a class="reference internal" href="cgi.html#functions">関数</a></li>
<li><a class="reference internal" href="cgi.html#caring-about-security">セキュリティへの配慮</a></li>
<li><a class="reference internal" href="cgi.html#installing-your-cgi-script-on-a-unix-system">CGI スクリプトを Unix システムにインストールする</a></li>
<li><a class="reference internal" href="cgi.html#testing-your-cgi-script">CGI スクリプトをテストする</a></li>
<li><a class="reference internal" href="cgi.html#debugging-cgi-scripts">CGI スクリプトをデバッグする</a></li>
<li><a class="reference internal" href="cgi.html#common-problems-and-solutions">よくある問題と解決法</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>前のトピックへ</h4>
    <p class="topless"><a href="audioop.html"
                          title="前の章へ"><code class="xref py py-mod docutils literal notranslate"><span class="pre">audioop</span></code> --- 生の音声データを操作する</a></p>
  </div>
  <div>
    <h4>次のトピックへ</h4>
    <p class="topless"><a href="cgitb.html"
                          title="次の章へ"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cgitb</span></code> --- CGI スクリプトのトレースバック管理機構</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">バグ報告</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/main/Doc/library/cgi.rst"
            rel="nofollow">ソースの表示
        </a>
      </li>
    </ul>
  </div>
        </nav>
    </div>
</div>

  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="cgitb.html" title="cgitb --- CGI スクリプトのトレースバック管理機構"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="audioop.html" title="audioop --- 生の音声データを操作する"
             accesskey="P">前へ</a> |</li>

          <li><img src="../_static/py.svg" alt="Python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
    <li id="cpython-language-and-version">
      <a href="../index.html">3.12.4 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python 標準ライブラリ</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="superseded.html" accesskey="U">取って代わられたモジュール群</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="cgi.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cgi</span></code> --- CGI (ゲートウェイインターフェース規格) のサポート</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="クイック検索" aria-label="クイック検索" type="search" name="q" id="search-box" />
          <input type="submit" value="検索" />
        </form>
    </div>
                     |
                </li>
            <li class="right">
<label class="theme-selector-label">
    Theme
    <select class="theme-selector" oninput="activateTheme(this.value)">
        <option value="auto" selected>Auto</option>
        <option value="light">Light</option>
        <option value="dark">Dark</option>
    </select>
</label> |</li>
            
      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="module-cgi">
<span id="cgi-common-gateway-interface-support"></span><h1><a class="reference internal" href="cgi.html#module-cgi" title="cgi: Helpers for running Python scripts via the Common Gateway Interface. (非推奨)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cgi</span></code></a> --- CGI (ゲートウェイインターフェース規格) のサポート<a class="headerlink" href="cgi.html#module-cgi" title="Link to this heading">¶</a></h1>
<p><strong>ソースコード:</strong> <a class="reference external" href="https://github.com/python/cpython/tree/3.12/Lib/cgi.py">Lib/cgi.py</a></p>
<div class="deprecated-removed" id="index-0">
<p><span class="versionmodified">バージョン 3.11 で非推奨、バージョン 3.13 で削除予定: </span>The <a class="reference internal" href="cgi.html#module-cgi" title="cgi: Helpers for running Python scripts via the Common Gateway Interface. (非推奨)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cgi</span></code></a> module is deprecated
(see <span class="target" id="index-1"></span><a class="pep reference external" href="https://peps.python.org/pep-0594/#cgi"><strong>PEP 594</strong></a> for details and alternatives).</p>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">FieldStorage</span></code> class can typically be replaced with
<a class="reference internal" href="urllib.parse.html#urllib.parse.parse_qsl" title="urllib.parse.parse_qsl"><code class="xref py py-func docutils literal notranslate"><span class="pre">urllib.parse.parse_qsl()</span></code></a> for <code class="docutils literal notranslate"><span class="pre">GET</span></code> and <code class="docutils literal notranslate"><span class="pre">HEAD</span></code> requests,
and the <a class="reference internal" href="email.message.html#module-email.message" title="email.message: The base class representing email messages."><code class="xref py py-mod docutils literal notranslate"><span class="pre">email.message</span></code></a> module or
<a class="reference external" href="https://pypi.org/project/multipart/">multipart</a> for <code class="docutils literal notranslate"><span class="pre">POST</span></code> and <code class="docutils literal notranslate"><span class="pre">PUT</span></code>.
Most <a class="reference internal" href="cgi.html#functions-in-cgi-module"><span class="std std-ref">utility functions</span></a> have replacements.</p>
</div>
<hr class="docutils" />
<p>ゲートウェイインターフェース規格 (CGI) に準拠したスクリプトをサポートするためのモジュールです。</p>
<p>このモジュールでは、Python で CGI スクリプトを書く際に使える様々なユーティリティを定義しています。</p>
<p>The global variable <code class="docutils literal notranslate"><span class="pre">maxlen</span></code> can be set to an integer indicating the maximum
size of a POST request. POST requests larger than this size will result in a
<a class="reference internal" href="exceptions.html#ValueError" title="ValueError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a> being raised during parsing. The default value of this
variable is <code class="docutils literal notranslate"><span class="pre">0</span></code>, meaning the request size is unlimited.</p>
<div class="availability docutils container">
<p><a class="reference internal" href="intro.html#availability"><span class="std std-ref">利用可能性</span></a>: Emscripten でなく、WASI でもないこと。</p>
<p>このモジュールは WebAssembly プラットフォーム <code class="docutils literal notranslate"><span class="pre">wasm32-emscripten</span></code> と <code class="docutils literal notranslate"><span class="pre">wasm32-wasi</span></code> では動作しないか、利用不可です。詳しくは、<a class="reference internal" href="intro.html#wasm-availability"><span class="std std-ref">WebAssembly プラットフォーム</span></a> を見てください。</p>
</div>
<section id="introduction">
<h2>はじめに<a class="headerlink" href="cgi.html#introduction" title="Link to this heading">¶</a></h2>
<p id="cgi-intro">CGI スクリプトは、HTTP サーバによって起動され、通常は HTML の <code class="docutils literal notranslate"><span class="pre">&lt;FORM&gt;</span></code> または <code class="docutils literal notranslate"><span class="pre">&lt;ISINDEX&gt;</span></code> エレメントを通じてユーザが入力した内容を処理します。</p>
<p>ほとんどの場合、CGI スクリプトはサーバ上の特殊なディレクトリ <code class="file docutils literal notranslate"><span class="pre">cgi-bin</span></code> の下に置きます。HTTP サーバは、まずスクリプトを駆動するためのシェルの環境変数に、リクエストの全ての情報 (クライアントのホスト名、リクエストされている URL、クエリ文字列、その他諸々) を設定し、スクリプトを実行した後、スクリプトの出力をクライアントに送信します。</p>
<p>スクリプトの入力端もクライアントに接続されていて、この経路を通じてフォームデータを読み込むこともあります。それ以外の場合には、フォームデータは URL の一部分である「クエリ文字列」を介して渡されます。このモジュールでは、上記のケースの違いに注意しつつ、Python スクリプトに対しては単純なインターフェースを提供しています。このモジュールではまた、スクリプトをデバッグするためのユーティリティも多数提供しています。また、最近はフォームを経由したファイルのアップロードをサポートしています (ブラウザ側がサポートしていればです)。</p>
<p>CGI スクリプトの出力は 2 つのセクションからなり、空行で分割されています。最初のセクションは複数のヘッダからなり、後続するデータがどのようなものかをクライアントに通知します。最小のヘッダセクションを生成するための Python のコードは以下のようなものです:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Content-Type: text/html&quot;</span><span class="p">)</span>    <span class="c1"># HTML is following</span>
<span class="nb">print</span><span class="p">()</span>                             <span class="c1"># blank line, end of headers</span>
</pre></div>
</div>
<p>二つ目のセクションは通常、ヘッダやインラインイメージ等の付属したテキストをうまくフォーマットして表示できるようにした HTML です。以下に単純な HTML を出力する Python コードを示します:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&lt;TITLE&gt;CGI script output&lt;/TITLE&gt;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&lt;H1&gt;This is my first CGI script&lt;/H1&gt;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello, world!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="using-the-cgi-module">
<span id="id1"></span><h2>cgi モジュールを使う<a class="headerlink" href="cgi.html#using-the-cgi-module" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">cgi</span></code> と記述して開始します。</p>
<p>新たにスクリプトを書く際には、以下の行を付加するかどうか検討してください:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cgitb</span>
<span class="n">cgitb</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
</pre></div>
</div>
<p>これによって、特別な例外処理が有効にされ、エラーが発生した際に web ブラウザ上に詳細なレポートを出力するようになります。ユーザにスクリプトの内部を見せたくないのなら、以下のようにしてレポートをファイルに保存できます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cgitb</span>
<span class="n">cgitb</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">logdir</span><span class="o">=</span><span class="s2">&quot;/path/to/logdir&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>スクリプトを開発する際には、この機能はとても役に立ちます。 <a class="reference internal" href="cgitb.html#module-cgitb" title="cgitb: Configurable traceback handler for CGI scripts. (非推奨)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cgitb</span></code></a> が生成する報告はバグを追跡するためにかかる時間を大幅に減らせるような情報を提供してくれます。スクリプトをテストし終わり、正確に動作することを確認したら、いつでも <code class="docutils literal notranslate"><span class="pre">cgitb</span></code> の行を削除できます。</p>
<p>入力されたフォームデータを取得するには、 <code class="xref py py-class docutils literal notranslate"><span class="pre">FieldStorage</span></code> クラスを使います。フォームが非 ASCII 文字を含んでいる場合は、 <em>encoding</em> キーワードパラメータを使用してドキュメントに対して定義されたエンコーディングの値を設定してください。それは、通常 HTML ドキュメントの HEAD セクション中の META タグ、あるいは  <em class="mailheader">Content-Type</em> ヘッダーに含まれています。これは、標準入力または環境変数からフォームの内容を読み出します (どちらから読み出すかは、複数の環境変数の値が CGI 標準に従ってどのように設定されているかで決まります)。インスタンスが標準入力を使うかもしれないので、インスタンス生成を行うのは一度だけにしなければなりません。</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">FieldStorage</span></code> のインスタンスは Python の辞書型のように添え字アクセスが可能です。 <a class="reference internal" href="../reference/expressions.html#in"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">in</span></code></a> を使用することによって要素が含まれているかの判定も出来ますし、標準の辞書メソッド <a class="reference internal" href="stdtypes.html#dict.keys" title="dict.keys"><code class="xref py py-meth docutils literal notranslate"><span class="pre">keys()</span></code></a> 及び組み込み関数 <a class="reference internal" href="functions.html#len" title="len"><code class="xref py py-func docutils literal notranslate"><span class="pre">len()</span></code></a> もサポートしています。空の文字列を含むフォーム要素は無視され、辞書には現れません。そのような値を保持するには、<code class="xref py py-class docutils literal notranslate"><span class="pre">FieldStorage</span></code> のインスタンス作成の際にオプションのキーワードパラメータ <em>keep_blank_values</em> に true を指定してください。</p>
<p>例えば、以下のコード (<em class="mailheader">Content-Type</em> ヘッダと空行はすでに出力された後とします) は <code class="docutils literal notranslate"><span class="pre">name</span></code> および <code class="docutils literal notranslate"><span class="pre">addr</span></code> フィールドが両方とも空の文字列に設定されていないか調べます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">form</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">FieldStorage</span><span class="p">()</span>
<span class="k">if</span> <span class="s2">&quot;name&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">form</span> <span class="ow">or</span> <span class="s2">&quot;addr&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">form</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&lt;H1&gt;Error&lt;/H1&gt;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please fill in the name and addr fields.&quot;</span><span class="p">)</span>
    <span class="k">return</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&lt;p&gt;name:&quot;</span><span class="p">,</span> <span class="n">form</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&lt;p&gt;addr:&quot;</span><span class="p">,</span> <span class="n">form</span><span class="p">[</span><span class="s2">&quot;addr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="o">...</span><span class="n">further</span> <span class="n">form</span> <span class="n">processing</span> <span class="n">here</span><span class="o">...</span>
</pre></div>
</div>
<p>ここで、 <code class="docutils literal notranslate"><span class="pre">form[key]</span></code> で参照される各フィールドはそれ自体が <code class="xref py py-class docutils literal notranslate"><span class="pre">FieldStorage</span></code> (または <code class="xref py py-class docutils literal notranslate"><span class="pre">MiniFieldStorage</span></code> 。フォームのエンコードによって変わります) のインスタンスです。インスタンスの属性 <code class="xref py py-attr docutils literal notranslate"><span class="pre">value</span></code> の内容は対応するフィールドの値で、文字列になります。 <code class="xref py py-meth docutils literal notranslate"><span class="pre">getvalue()</span></code> メソッドはこの文字列値を直接返します。 <code class="xref py py-meth docutils literal notranslate"><span class="pre">getvalue()</span></code> の 2 つめの引数にオプションの値を与えると、リクエストされたキーが存在しない場合に返すデフォルトの値になります。</p>
<p>入力されたフォームデータに同じ名前のフィールドが二つ以上あれば、 <code class="docutils literal notranslate"><span class="pre">form[key]</span></code> で得られるオブジェクトは <code class="xref py py-class docutils literal notranslate"><span class="pre">FieldStorage</span></code> や <code class="xref py py-class docutils literal notranslate"><span class="pre">MiniFieldStorage</span></code> のインスタンスではなく、そうしたインスタンスのリストになります。この場合、 <code class="docutils literal notranslate"><span class="pre">form.getvalue(key)</span></code> も同様に、文字列からなるリストを返します。もしこうした状況が起きうると思うなら (HTML のフォームに同じ名前をもったフィールドが複数含まれているのなら) 、 <a class="reference internal" href="cgi.html#cgi.FieldStorage.getlist" title="cgi.FieldStorage.getlist"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getlist()</span></code></a> メソッドを使ってください。これは常に値のリストを返します (単一要素のケースを特別扱いする必要はありません)。例えば、以下のコードは任意の数のユーザ名フィールドを結合し、コンマで分割された文字列にします:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
<span class="n">usernames</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>フィールドがアップロードされたファイルを表している場合、 <code class="xref py py-attr docutils literal notranslate"><span class="pre">value</span></code> 属性や <code class="xref py py-meth docutils literal notranslate"><span class="pre">getvalue()</span></code> メソッドを使ってフィールドの値にアクセスすると、ファイルの内容をすべてメモリ上にバイト列として読み込みます。これは場合によっては望ましい動作ではないかもしれません。アップロードされたファイルがあるかどうかは <code class="xref py py-attr docutils literal notranslate"><span class="pre">filename</span></code> 属性および <code class="xref py py-attr docutils literal notranslate"><span class="pre">file</span></code> 属性のいずれかで調べられます。そして、 <code class="xref py py-class docutils literal notranslate"><span class="pre">FieldStorage</span></code> インスタンスのガベージコレクションの一部として自動的に閉じられるまでの間に、 <code class="xref py py-attr docutils literal notranslate"><span class="pre">file</span></code> 属性から以下のようにデータを読み込むことができます (<a class="reference internal" href="io.html#io.RawIOBase.read" title="io.RawIOBase.read"><code class="xref py py-func docutils literal notranslate"><span class="pre">read()</span></code></a> および <a class="reference internal" href="io.html#io.IOBase.readline" title="io.IOBase.readline"><code class="xref py py-func docutils literal notranslate"><span class="pre">readline()</span></code></a> メソッドはバイト列を返します):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">fileitem</span> <span class="o">=</span> <span class="n">form</span><span class="p">[</span><span class="s2">&quot;userfile&quot;</span><span class="p">]</span>
<span class="k">if</span> <span class="n">fileitem</span><span class="o">.</span><span class="n">file</span><span class="p">:</span>
    <span class="c1"># It&#39;s an uploaded file; count lines</span>
    <span class="n">linecount</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">fileitem</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span> <span class="k">break</span>
        <span class="n">linecount</span> <span class="o">=</span> <span class="n">linecount</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">FieldStorage</span></code> オブジェクトは <a class="reference internal" href="../reference/compound_stmts.html#with"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">with</span></code></a> 文での使用にも対応しています。 with 文を使用した場合、オブジェクトは終了時に自動的に閉じられます。</p>
<p>アップロードされたファイルの内容を取得している間にエラーが発生した場合 (例えば、ユーザーが戻るボタンやキャンセルボタンで submit を中断した場合)、そのフィールドのオブジェクトの <code class="xref py py-attr docutils literal notranslate"><span class="pre">done</span></code> 属性には -1 が設定されます。</p>
<p>現在ドラフトとなっているファイルアップロードの標準仕様では、一つのフィールドから (再帰的な <em class="mimetype">multipart/*</em> エンコーディングを使って) 複数のファイルがアップロードされる可能性を受け入れています。この場合、アイテムは辞書形式の <code class="xref py py-class docutils literal notranslate"><span class="pre">FieldStorage</span></code> アイテムとなります。複数ファイルかどうかは <code class="xref py py-attr docutils literal notranslate"><span class="pre">type</span></code> 属性が <em class="mimetype">multipart/form-data</em> (または <em class="mimetype">multipart/*</em> にマッチする他の MIME 型) になっているかどうかを調べれば判別できます。この場合、トップレベルのフォームオブジェクトと同様にして再帰的に個別処理できます。</p>
<p>フォームが「古い」形式で入力された場合 (クエリ文字列または単一の <em class="mimetype">application/x-www-form-urlencoded</em> データで入力された場合)、データ要素の実体は <code class="xref py py-class docutils literal notranslate"><span class="pre">MiniFieldStorage</span></code> クラスのインスタンスになります。この場合、 <code class="xref py py-attr docutils literal notranslate"><span class="pre">list</span></code> 、 <code class="xref py py-attr docutils literal notranslate"><span class="pre">file</span></code> 、および <code class="xref py py-attr docutils literal notranslate"><span class="pre">filename</span></code> 属性は常に <code class="docutils literal notranslate"><span class="pre">None</span></code> になります。</p>
<p>フォームがPOSTによって送信され、クエリー文字列も持っていた場合、 <code class="xref py py-class docutils literal notranslate"><span class="pre">FieldStorage</span></code> と <code class="xref py py-class docutils literal notranslate"><span class="pre">MiniFieldStorage</span></code> の両方が含まれます。</p>
<div class="versionchanged">
<p><span class="versionmodified changed">バージョン 3.4 で変更: </span><code class="xref py py-attr docutils literal notranslate"><span class="pre">file</span></code> 属性は、それを作成した <code class="xref py py-class docutils literal notranslate"><span class="pre">FieldStorage</span></code> インスタンスのガベージコレクションによって自動的に閉じられます。</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">バージョン 3.5 で変更: </span><code class="xref py py-class docutils literal notranslate"><span class="pre">FieldStorage</span></code> クラスにコンテキスト管理プロトコルのサポートが追加されました。</p>
</div>
</section>
<section id="higher-level-interface">
<h2>高水準インターフェース<a class="headerlink" href="cgi.html#higher-level-interface" title="Link to this heading">¶</a></h2>
<p>前節では CGI フォームデータを <code class="xref py py-class docutils literal notranslate"><span class="pre">FieldStorage</span></code> クラスを使って読み出す方法について解説しました。この節では、フォームデータを分かりやすく直感的な方法で読み出せるようにするために追加された、より高水準のインターフェースについて記述します。このインターフェースは前節で説明した技術を撤廃するものではありません --- 例えば、前節の技術は依然としてファイルのアップロードを効率的に行う上で便利です。</p>
<p>このインターフェースは 2 つの単純なメソッドからなります。このメソッドを使えば、一般的な方法でフォームデータを処理でき、ある名前のフィールドに入力された値が一つなのかそれ以上なのかを心配する必要がなくなります。</p>
<p>前節では、一つのフィールド名に対して二つ以上の値が入力されるかもしれない場合には、常に以下のようなコードを書くよう学びました:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">item</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(</span><span class="s2">&quot;item&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
    <span class="c1"># The user is requesting more than one item.</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># The user is requesting only one item.</span>
</pre></div>
</div>
<p>こういった状況は、例えば以下のように、同じ名前を持った複数のチェックボックスからなるグループがフォームに入っているような場合によく起きます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;checkbox&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;item&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;checkbox&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;item&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;2&quot;</span> <span class="o">/&gt;</span>
</pre></div>
</div>
<p>しかしながら、ほとんどの場合、あるフォーム中で特定の名前を持ったコントロールはただ一つしかないので、その名前に関連付けられた値はただ一つしかないはずだと考えるでしょう。そこで、スクリプトには例えば以下のようなコードを書くでしょう:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</pre></div>
</div>
<p>このコードの問題点は、クライアントがスクリプトにとって常に有効な入力を提供するとは期待できないところにあります。例えば、もし好奇心旺盛なユーザがもう一つの <code class="docutils literal notranslate"><span class="pre">user=foo</span></code> ペアをクエリ文字列に追加したら、 <code class="docutils literal notranslate"><span class="pre">getvalue(&quot;user&quot;)</span></code> メソッドは文字列ではなくリストを返すため、このスクリプトはクラッシュするでしょう。リストに対して <a class="reference internal" href="stdtypes.html#str.upper" title="str.upper"><code class="xref py py-meth docutils literal notranslate"><span class="pre">upper()</span></code></a> メソッドを呼び出すと、引数が有効でない (リスト型はその名前のメソッドを持っていない) ため、例外 <a class="reference internal" href="exceptions.html#AttributeError" title="AttributeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AttributeError</span></code></a> を送出します。</p>
<p>従って、フォームデータの値を読み出しには、得られた値が単一の値なのか値のリストなのかを常に調べるコードを使うのが適切でした。これでは煩わしく、より読みにくいスクリプトになってしまいます。</p>
<p>ここで述べる高水準のインターフェースで提供している <a class="reference internal" href="cgi.html#cgi.FieldStorage.getfirst" title="cgi.FieldStorage.getfirst"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getfirst()</span></code></a> や <a class="reference internal" href="cgi.html#cgi.FieldStorage.getlist" title="cgi.FieldStorage.getlist"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getlist()</span></code></a> メソッドを使うと、もっと便利にアプローチできます。</p>
<dl class="py method">
<dt class="sig sig-object py" id="cgi.FieldStorage.getfirst">
<span class="sig-prename descclassname"><span class="pre">FieldStorage.</span></span><span class="sig-name descname"><span class="pre">getfirst</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="cgi.html#cgi.FieldStorage.getfirst" title="Link to this definition">¶</a></dt>
<dd><p>フォームフィールド <em>name</em> に関連付けられた値をつねに一つだけ返す軽量メソッドです。同じ名前で 1 つ以上の値がポストされている場合、このメソッドは最初の値だけを返します。フォームから値を受信する際の値の並び順はブラウザ間で異なる可能性があり、特定の順番であるとは期待できないので注意してください。<a class="footnote-reference brackets" href="cgi.html#id3" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> 指定したフォームフィールドや値がない場合、このメソッドはオプションの引数 <em>default</em> を返します。このパラメタを指定しない場合、標準の値は <code class="docutils literal notranslate"><span class="pre">None</span></code> に設定されます。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cgi.FieldStorage.getlist">
<span class="sig-prename descclassname"><span class="pre">FieldStorage.</span></span><span class="sig-name descname"><span class="pre">getlist</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="cgi.html#cgi.FieldStorage.getlist" title="Link to this definition">¶</a></dt>
<dd><p>このメソッドはフォームフィールド <em>name</em> に関連付けられた値を常にリストにして返します。<em>name</em> に指定したフォームフィールドや値が存在しない場合、このメソッドは空のリストを返します。値が一つだけ存在する場合、要素を一つだけ含むリストを返します。</p>
</dd></dl>

<p>これらのメソッドを使うことで、以下のようにナイスでコンパクトにコードを書けます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cgi</span>
<span class="n">form</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">FieldStorage</span><span class="p">()</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>    <span class="c1"># This way it&#39;s safe.</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">form</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s2">&quot;item&quot;</span><span class="p">):</span>
    <span class="n">do_something</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="functions">
<span id="functions-in-cgi-module"></span><h2>関数<a class="headerlink" href="cgi.html#functions" title="Link to this heading">¶</a></h2>
<p>より細かく CGI をコントロールしたり、このモジュールで実装されているアルゴリズムを他の状況で利用したい場合には、以下の関数が便利です。</p>
<dl class="py function">
<dt class="sig sig-object py" id="cgi.parse">
<span class="sig-prename descclassname"><span class="pre">cgi.</span></span><span class="sig-name descname"><span class="pre">parse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">environ</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">os.environ</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep_blank_values</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strict_parsing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">separator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'&amp;'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="cgi.html#cgi.parse" title="Link to this definition">¶</a></dt>
<dd><p>環境変数、またはファイルからからクエリを解釈します (ファイルは標準で <code class="docutils literal notranslate"><span class="pre">sys.stdin</span></code> になります) <em>keep_blank_values</em>, <em>strict_parsing</em>, <em>separator</em> 引数はそのまま <a class="reference internal" href="urllib.parse.html#urllib.parse.parse_qs" title="urllib.parse.parse_qs"><code class="xref py py-func docutils literal notranslate"><span class="pre">urllib.parse.parse_qs()</span></code></a> に渡されます。</p>
<div class="deprecated-removed">
<p><span class="versionmodified">バージョン 3.11 で非推奨、バージョン 3.13 で削除予定: </span>This function, like the rest of the <a class="reference internal" href="cgi.html#module-cgi" title="cgi: Helpers for running Python scripts via the Common Gateway Interface. (非推奨)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cgi</span></code></a> module, is deprecated.
It can be replaced by calling <a class="reference internal" href="urllib.parse.html#urllib.parse.parse_qs" title="urllib.parse.parse_qs"><code class="xref py py-func docutils literal notranslate"><span class="pre">urllib.parse.parse_qs()</span></code></a> directly
on the desired query string (except for <code class="docutils literal notranslate"><span class="pre">multipart/form-data</span></code> input,
which can be handled as described for <a class="reference internal" href="cgi.html#cgi.parse_multipart" title="cgi.parse_multipart"><code class="xref py py-func docutils literal notranslate"><span class="pre">parse_multipart()</span></code></a>).</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cgi.parse_multipart">
<span class="sig-prename descclassname"><span class="pre">cgi.</span></span><span class="sig-name descname"><span class="pre">parse_multipart</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pdict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encoding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'utf-8'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">errors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'replace'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">separator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'&amp;'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="cgi.html#cgi.parse_multipart" title="Link to this definition">¶</a></dt>
<dd><p>Parse input of type <em class="mimetype">multipart/form-data</em> (for  file uploads).
Arguments are <em>fp</em> for the input file, <em>pdict</em> for a dictionary containing
other parameters in the <em class="mailheader">Content-Type</em> header, and <em>encoding</em>,
the request encoding.</p>
<p>Returns a dictionary just like <a class="reference internal" href="urllib.parse.html#urllib.parse.parse_qs" title="urllib.parse.parse_qs"><code class="xref py py-func docutils literal notranslate"><span class="pre">urllib.parse.parse_qs()</span></code></a>: keys are the
field names, each value is a list of values for that field. For non-file
fields, the value is a list of strings.</p>
<p>この関数は簡単に使えますが、数メガバイトのデータがアップロードされると考えられる場合にはあまり適していません --- その場合、より柔軟性のある <code class="xref py py-class docutils literal notranslate"><span class="pre">FieldStorage</span></code> を代りに使ってください。</p>
<div class="versionchanged">
<p><span class="versionmodified changed">バージョン 3.7 で変更: </span>Added the <em>encoding</em> and <em>errors</em> parameters.  For non-file fields, the
value is now a list of strings, not bytes.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">バージョン 3.10 で変更: </span>Added the <em>separator</em> parameter.</p>
</div>
<div class="deprecated-removed">
<p><span class="versionmodified">バージョン 3.11 で非推奨、バージョン 3.13 で削除予定: </span>This function, like the rest of the <a class="reference internal" href="cgi.html#module-cgi" title="cgi: Helpers for running Python scripts via the Common Gateway Interface. (非推奨)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cgi</span></code></a> module, is deprecated.
It can be replaced with the functionality in the <a class="reference internal" href="email.html#module-email" title="email: Package supporting the parsing, manipulating, and generating email messages."><code class="xref py py-mod docutils literal notranslate"><span class="pre">email</span></code></a> package
(e.g. <a class="reference internal" href="email.message.html#email.message.EmailMessage" title="email.message.EmailMessage"><code class="xref py py-class docutils literal notranslate"><span class="pre">email.message.EmailMessage</span></code></a>/<a class="reference internal" href="email.compat32-message.html#email.message.Message" title="email.message.Message"><code class="xref py py-class docutils literal notranslate"><span class="pre">email.message.Message</span></code></a>)
which implements the same MIME RFCs, or with the
<a class="reference external" href="https://pypi.org/project/multipart/">multipart</a> PyPI project.</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cgi.parse_header">
<span class="sig-prename descclassname"><span class="pre">cgi.</span></span><span class="sig-name descname"><span class="pre">parse_header</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">string</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="cgi.html#cgi.parse_header" title="Link to this definition">¶</a></dt>
<dd><p>(<em class="mailheader">Content-Type</em> のような) MIME ヘッダを解釈し、ヘッダの主要値と各パラメタからなる辞書にします。</p>
<div class="deprecated-removed">
<p><span class="versionmodified">バージョン 3.11 で非推奨、バージョン 3.13 で削除予定: </span>This function, like the rest of the <a class="reference internal" href="cgi.html#module-cgi" title="cgi: Helpers for running Python scripts via the Common Gateway Interface. (非推奨)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cgi</span></code></a> module, is deprecated.
It can be replaced with the functionality in the <a class="reference internal" href="email.html#module-email" title="email: Package supporting the parsing, manipulating, and generating email messages."><code class="xref py py-mod docutils literal notranslate"><span class="pre">email</span></code></a> package,
which implements the same MIME RFCs.</p>
<p>For example, with <a class="reference internal" href="email.message.html#email.message.EmailMessage" title="email.message.EmailMessage"><code class="xref py py-class docutils literal notranslate"><span class="pre">email.message.EmailMessage</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">email.message</span> <span class="kn">import</span> <span class="n">EmailMessage</span>
<span class="n">msg</span> <span class="o">=</span> <span class="n">EmailMessage</span><span class="p">()</span>
<span class="n">msg</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json; charset=&quot;utf8&quot;&#39;</span>
<span class="n">main</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">(),</span> <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">params</span>
</pre></div>
</div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cgi.test">
<span class="sig-prename descclassname"><span class="pre">cgi.</span></span><span class="sig-name descname"><span class="pre">test</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="cgi.html#cgi.test" title="Link to this definition">¶</a></dt>
<dd><p>メインプログラムから利用できる堅牢性テストを行う CGI スクリプトです。最小の HTTP ヘッダと、スクリプトで供給された全ての情報をHTML形式で書式化して出力します。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cgi.print_environ">
<span class="sig-prename descclassname"><span class="pre">cgi.</span></span><span class="sig-name descname"><span class="pre">print_environ</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="cgi.html#cgi.print_environ" title="Link to this definition">¶</a></dt>
<dd><p>シェル変数を HTML に書式化して出力します。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cgi.print_form">
<span class="sig-prename descclassname"><span class="pre">cgi.</span></span><span class="sig-name descname"><span class="pre">print_form</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">form</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="cgi.html#cgi.print_form" title="Link to this definition">¶</a></dt>
<dd><p>フォームを HTML に初期化して出力します。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cgi.print_directory">
<span class="sig-prename descclassname"><span class="pre">cgi.</span></span><span class="sig-name descname"><span class="pre">print_directory</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="cgi.html#cgi.print_directory" title="Link to this definition">¶</a></dt>
<dd><p>現在のディレクトリを HTML に書式化して出力します。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cgi.print_environ_usage">
<span class="sig-prename descclassname"><span class="pre">cgi.</span></span><span class="sig-name descname"><span class="pre">print_environ_usage</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="cgi.html#cgi.print_environ_usage" title="Link to this definition">¶</a></dt>
<dd><p>意味のある (CGI の使う) 環境変数を HTML で出力します。</p>
</dd></dl>

</section>
<section id="caring-about-security">
<span id="cgi-security"></span><h2>セキュリティへの配慮<a class="headerlink" href="cgi.html#caring-about-security" title="Link to this heading">¶</a></h2>
<p id="index-2">重要なルールが一つあります: (<a class="reference internal" href="os.html#os.system" title="os.system"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.system()</span></code></a>, <a class="reference internal" href="os.html#os.popen" title="os.popen"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.popen()</span></code></a> またはその他の同様の機能によって) 外部プログラムを呼び出すなら、クライアントから受信した任意の文字列をシェルに渡していないことをよく確かめてください。これはよく知られているセキュリティホールであり、これによって web のどこかにいる悪賢いハッカーが、だまされやすい CGI スクリプトに任意のシェルコマンドを実行させてしまえます。URL の一部やフィールド名でさえも信用してはいけません。CGI へのリクエストはあなたの作ったフォームから送信されるとは限らないからです！</p>
<p>安全な方法をとるために、フォームから入力された文字をシェルに渡す場合、文字列に入っているのが英数文字、ダッシュ、アンダースコア、およびピリオドだけかどうかを確認してください。</p>
</section>
<section id="installing-your-cgi-script-on-a-unix-system">
<h2>CGI スクリプトを Unix システムにインストールする<a class="headerlink" href="cgi.html#installing-your-cgi-script-on-a-unix-system" title="Link to this heading">¶</a></h2>
<p>あなたの使っている HTTP サーバのドキュメントを読んでください。そしてローカルシステムの管理者と一緒にどのディレクトリに CGI スクリプトをインストールすべきかを調べてください; 通常これはサーバのファイルシステムツリー内の <code class="file docutils literal notranslate"><span class="pre">cgi-bin</span></code> ディレクトリです。</p>
<p>あなたのスクリプトが &quot;others&quot; によって読み取り可能および実行可能であることを確認してください; Unix ファイルモードは 8 進表記で <code class="docutils literal notranslate"><span class="pre">0o755</span></code> です (<code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">0755</span> <span class="pre">filename</span></code> を使ってください)。スクリプトの最初の行の 1 カラム目が、<code class="docutils literal notranslate"><span class="pre">#!</span></code> で開始し、その後に Python インタプリタへのパス名が続いていることを確認してください。例えば:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/local/bin/python</span>
</pre></div>
</div>
<p>Python インタプリタが存在し、&quot;others&quot; によって実行可能であることを確かめてください。</p>
<p>あなたのスクリプトが読み書きしなければならないファイルが全て &quot;others&quot; によって読み出しや書き込み可能であることを確かめてください --- 読み出し可能のファイルモードは <code class="docutils literal notranslate"><span class="pre">0o644</span></code> で、書き込み可能のファイルモードは <code class="docutils literal notranslate"><span class="pre">0o666</span></code> になるはずです。これは、セキュリティ上の理由から、 HTTP サーバがあなたのスクリプトを特権を全く持たないユーザ &quot;nobody&quot; の権限で実行するからです。この権限下では、誰でもが読める (書ける、実行できる) ファイルしか読み出し (書き込み、実行) できません。スクリプト実行時のディレクトリや環境変数のセットもあなたがログインしたときの設定と異なります。特に、実行ファイルに対するシェルの検索パス (<span class="target" id="index-10"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code>) や Python のモジュール検索パス (<span class="target" id="index-11"></span><a class="reference internal" href="../using/cmdline.html#envvar-PYTHONPATH"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code></a>)が何らかの値に設定されていると期待してはいけません。</p>
<p>モジュールを Python の標準設定におけるモジュール検索パス上にないディレクトリからロードする必要がある場合、他のモジュールを取り込む前にスクリプト内で検索パスを変更できます。例えば:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;/usr/home/joe/lib/python&quot;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;/usr/local/lib/python&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>(この方法では、最後に挿入されたディレクトリが最初に検索されます！)</p>
<p>非 Unix システムにおける説明は変わるでしょう; あなたの使っている HTTP サーバのドキュメントを調べてください (普通は CGI スクリプトに関する節があります)。</p>
</section>
<section id="testing-your-cgi-script">
<h2>CGI スクリプトをテストする<a class="headerlink" href="cgi.html#testing-your-cgi-script" title="Link to this heading">¶</a></h2>
<p>残念ながら、CGI スクリプトは普通、コマンドラインから起動しようとしても動きません。また、コマンドラインから起動した場合には完璧に動作するスクリプトが、不思議なことにサーバからの起動では失敗することがあります。しかし、スクリプトをコマンドラインから実行してみなければならない理由が一つあります: もしスクリプトが文法エラーを含んでいれば、Python インタプリタはそのプログラムを全く実行しないため、HTTP サーバはほとんどの場合クライアントに謎めいたエラーを送信するからです。</p>
<p>スクリプトが構文エラーを含まないのにうまく動作しないなら、次の節に読み進むしかありません。</p>
</section>
<section id="debugging-cgi-scripts">
<h2>CGI スクリプトをデバッグする<a class="headerlink" href="cgi.html#debugging-cgi-scripts" title="Link to this heading">¶</a></h2>
<p id="index-5">何よりもまず、些細なインストール関連のエラーでないか確認してください --- 上の CGI スクリプトのインストールに関する節を注意深く読めば時間を大いに節約できます。もしインストールの手続きを正しく理解しているか不安なら、このモジュールのファイル (<code class="file docutils literal notranslate"><span class="pre">cgi.py</span></code>) をコピーして、CGI スクリプトとしてインストールしてみてください。このファイルはスクリプトとして呼び出すと、スクリプトの実行環境とフォームの内容を HTML 形式で出力します。ファイルに正しいモードを設定するなどして、リクエストを送ってみてください。標準的な <code class="file docutils literal notranslate"><span class="pre">cgi-bin</span></code> ディレクトリにインストールされていれば、以下のような URL をブラウザに入力してリクエストを送信できるはずです:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>http://yourhostname/cgi-bin/cgi.py?name=Joe+Blow&amp;addr=At+Home
</pre></div>
</div>
<p>もしタイプ 404 のエラーになるなら、サーバはスクリプトを発見できないでいます -- おそらくあなたはスクリプトを別のディレクトリに入れる必要があるのでしょう。他のエラーになるなら、先に進む前に解決しなければならないインストール上の問題があります。もし実行環境の情報とフォーム内容 (この例では、各フィールドはフィールド名 &quot;addr&quot; に対して値 &quot;At Home&quot;、およびフィールド名 &quot;name&quot; に対して &quot;Joe Blow&quot;) が綺麗にフォーマットされて表示されるなら、 <code class="file docutils literal notranslate"><span class="pre">cgi.py</span></code> スクリプトは正しくインストールされています。同じ操作をあなたの自作スクリプトに対して行えば、スクリプトをデバッグできるようになるはずです。</p>
<p>次のステップでは <a class="reference internal" href="cgi.html#module-cgi" title="cgi: Helpers for running Python scripts via the Common Gateway Interface. (非推奨)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cgi</span></code></a> モジュールの <a class="reference internal" href="test.html#module-test" title="test: Regression tests package containing the testing suite for Python."><code class="xref py py-func docutils literal notranslate"><span class="pre">test()</span></code></a> 関数を呼び出すことになります: メインプログラムコードを以下の 1 文と置き換えてください</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">cgi</span><span class="o">.</span><span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
<p>この操作で <code class="file docutils literal notranslate"><span class="pre">cgi.py</span></code> ファイル自体をインストールした時と同じ結果を出力するはずです。</p>
<p>通常の Python スクリプトが例外を処理しきれずに送出した場合 (様々な理由: モジュール名のタイプミス、ファイルが開けなかった、など)、Python インタプリタはナイスなトレースバックを出力して終了します。Python インタプリタはあなたの CGI スクリプトが例外を送出した場合にも同様に振舞うので、トレースバックは大抵HTTP サーバのいずれかのログファイルに残るかまったく無視されるかです。</p>
<p>幸運なことに、あなたが自作のスクリプトで <em>何らかの</em> コードを実行できるようになったら、 <a class="reference internal" href="cgitb.html#module-cgitb" title="cgitb: Configurable traceback handler for CGI scripts. (非推奨)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cgitb</span></code></a> モジュールを使って簡単にトレースバックを web ブラウザに送信できます。まだそうでないなら、以下の2行:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cgitb</span>
<span class="n">cgitb</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
</pre></div>
</div>
<p>をスクリプトの先頭に追加してください。そしてスクリプトを再度走らせます; 問題が発生すれば、クラッシュの原因を見出せるような詳細な報告を読めます。</p>
<p><a class="reference internal" href="cgitb.html#module-cgitb" title="cgitb: Configurable traceback handler for CGI scripts. (非推奨)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cgitb</span></code></a> モジュールのインポートに問題がありそうだと思うなら、(組み込みモジュールだけを使った) もっと堅牢なアプローチを取れます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Content-Type: text/plain&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="o">...</span><span class="n">your</span> <span class="n">code</span> <span class="n">here</span><span class="o">...</span>
</pre></div>
</div>
<p>このコードは Python インタプリタがトレースバックを出力することに依存しています。出力のコンテント型はプレーンテキストに設定されており、全ての HTML 処理を無効にしています。スクリプトがうまく動作する場合、生の HTML コードがクライアントに表示されます。スクリプトが例外を送出する場合、最初の 2 行が出力された後、トレースバックが表示されます。HTML の解釈は行われないので、トレースバックを読めるはずです。</p>
</section>
<section id="common-problems-and-solutions">
<h2>よくある問題と解決法<a class="headerlink" href="cgi.html#common-problems-and-solutions" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>ほとんどの HTTP サーバはスクリプトの実行が完了するまで CGI からの出力をバッファします。このことは、スクリプトの実行中にクライアントが進捗状況報告を表示できないことを意味します。</p></li>
<li><p>上のインストールに関する説明を調べましょう。</p></li>
<li><p>HTTP サーバのログファイルを調べましょう。(別のウィンドウで  <code class="docutils literal notranslate"><span class="pre">tail</span> <span class="pre">-f</span> <span class="pre">logfile</span></code> を実行すると便利かもしれません！)</p></li>
<li><p>常に <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">script.py</span></code> などとして、スクリプトが構文エラーでないか調べましょう。</p></li>
<li><p>スクリプトに構文エラーがないなら、<code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">cgitb;</span> <span class="pre">cgitb.enable()</span></code> をスクリプトの先頭に追加してみましょう。</p></li>
<li><p>外部プログラムを起動するときには、スクリプトがそのプログラムを見つけられるようにしましょう。これは通常、絶対パス名を使うことを意味します --- <span class="target" id="index-12"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code> は普通、あまり CGI スクリプトにとって便利でない値に設定されています。</p></li>
<li><p>外部のファイルを読み書きする際には、CGI スクリプトを動作させるときに使われる userid でファイルを読み書きできるようになっているか確認しましょう: userid は通常、Web サーバを動作させている userid か、Web サーバの <code class="docutils literal notranslate"><span class="pre">suexec</span></code> 機能で明示的に指定している userid になります。</p></li>
<li><p>CGI スクリプトを set-uid モードにしてはいけません。これはほとんどのシステムで動作せず、セキュリティ上の信頼性もありません。</p></li>
</ul>
<p class="rubric">脚注</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id3" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="cgi.html#id2">1</a><span class="fn-bracket">]</span></span>
<p>最近のバージョンの HTML 仕様ではフィールドの値を供給する順番を取り決めてはいますが、ある HTTP リクエストがその取り決めに準拠したブラウザから受信したものかどうか、そもそもブラウザから送信されたものかどうかの判別は退屈で間違いやすいので注意してください。</p>
</aside>
</aside>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../contents.html">目次</a></h3>
    <ul>
<li><a class="reference internal" href="cgi.html#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cgi</span></code> --- CGI (ゲートウェイインターフェース規格) のサポート</a><ul>
<li><a class="reference internal" href="cgi.html#introduction">はじめに</a></li>
<li><a class="reference internal" href="cgi.html#using-the-cgi-module">cgi モジュールを使う</a></li>
<li><a class="reference internal" href="cgi.html#higher-level-interface">高水準インターフェース</a></li>
<li><a class="reference internal" href="cgi.html#functions">関数</a></li>
<li><a class="reference internal" href="cgi.html#caring-about-security">セキュリティへの配慮</a></li>
<li><a class="reference internal" href="cgi.html#installing-your-cgi-script-on-a-unix-system">CGI スクリプトを Unix システムにインストールする</a></li>
<li><a class="reference internal" href="cgi.html#testing-your-cgi-script">CGI スクリプトをテストする</a></li>
<li><a class="reference internal" href="cgi.html#debugging-cgi-scripts">CGI スクリプトをデバッグする</a></li>
<li><a class="reference internal" href="cgi.html#common-problems-and-solutions">よくある問題と解決法</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>前のトピックへ</h4>
    <p class="topless"><a href="audioop.html"
                          title="前の章へ"><code class="xref py py-mod docutils literal notranslate"><span class="pre">audioop</span></code> --- 生の音声データを操作する</a></p>
  </div>
  <div>
    <h4>次のトピックへ</h4>
    <p class="topless"><a href="cgitb.html"
                          title="次の章へ"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cgitb</span></code> --- CGI スクリプトのトレースバック管理機構</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">バグ報告</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/main/Doc/library/cgi.rst"
            rel="nofollow">ソースの表示
        </a>
      </li>
    </ul>
  </div>
        </div>
<div id="sidebarbutton" title="サイドバーをたたむ">
<span>«</span>
</div>

      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="cgitb.html" title="cgitb --- CGI スクリプトのトレースバック管理機構"
             >次へ</a> |</li>
        <li class="right" >
          <a href="audioop.html" title="audioop --- 生の音声データを操作する"
             >前へ</a> |</li>

          <li><img src="../_static/py.svg" alt="Python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
    <li id="cpython-language-and-version">
      <a href="../index.html">3.12.4 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python 標準ライブラリ</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="superseded.html" >取って代わられたモジュール群</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="cgi.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cgi</span></code> --- CGI (ゲートウェイインターフェース規格) のサポート</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="クイック検索" aria-label="クイック検索" type="search" name="q" id="search-box" />
          <input type="submit" value="検索" />
        </form>
    </div>
                     |
                </li>
            <li class="right">
<label class="theme-selector-label">
    Theme
    <select class="theme-selector" oninput="activateTheme(this.value)">
        <option value="auto" selected>Auto</option>
        <option value="light">Light</option>
        <option value="dark">Dark</option>
    </select>
</label> |</li>
            
      </ul>
    </div>  
    <div class="footer">
    &copy; 
      <a href="../copyright.html">
    
    Copyright
    
      </a>
     2001-2024, Python Software Foundation.
    <br />
    This page is licensed under the Python Software Foundation License Version 2.
    <br />
    Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.
    <br />
    
      See <a href="../../../license.html">History and License</a> for more information.<br />
    
    
    <br />

    The Python Software Foundation is a non-profit corporation.
<a href="https://www.python.org/psf/donations/">Please donate.</a>
<br />
    <br />
      最終更新: Jun 11, 2024 (04:44 UTC)
    
      <a href="../../../bugs.html">Found a bug</a>?
    
    <br />

    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    </div>

    <script type="text/javascript" src="../_static/switchers.js"></script>
  </body>
</html>